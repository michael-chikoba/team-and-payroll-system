import{b as r,C as m,p as e,z as h,t as o,q as p,F as _,D as g,x as C,y as w,g as v,f as d}from"./vendor-CFHPe_rb.js";import{_ as D}from"./index-cgHGa_Rg.js";const A={name:"AttendanceMonitor",data(){return{attendanceData:[],teamOverview:null,loading:!1,error:null,retryCount:0,selectedDate:new Date().toISOString().split("T")[0],today:new Date().toISOString().split("T")[0],filterStatus:"all",modalVisible:!1,modalMessage:"",modalIsConfirm:!1,modalResolve:null,modalReject:null,currentEmployeeToMark:null,historyVisible:!1,loadingHistory:!1,formattedHistory:[],summary:{},employeeInfo:{},currentEmployee:null}},computed:{isToday(){return this.selectedDate===this.today},presentCount(){return this.attendanceData.filter(s=>["present","completed"].includes(s.status)).length},absentCount(){return this.attendanceData.filter(s=>["absent","on_leave"].includes(s.status)).length},lateCount(){return this.attendanceData.filter(s=>s.status==="late").length},filteredData(){return this.filterStatus==="all"?this.attendanceData:this.attendanceData.filter(s=>this.filterStatus==="present"?["present","completed"].includes(s.status):this.filterStatus==="absent"?["absent","on_leave"].includes(s.status):this.filterStatus==="late"?s.status==="late":s.status===this.filterStatus)}},mounted(){this.fetchAttendance()},methods:{showAlert(s){return this.modalMessage=s,this.modalIsConfirm=!1,this.modalVisible=!0,new Promise(t=>{this.modalResolve=t})},showConfirm(s){return this.modalMessage=s,this.modalIsConfirm=!0,this.modalVisible=!0,new Promise((t,i)=>{this.modalResolve=t,this.modalReject=i})},confirmAction(){this.modalVisible=!1,this.modalResolve&&this.modalResolve(),this.resetModal()},cancelAction(){this.modalVisible=!1,this.modalReject&&this.modalReject(),this.resetModal()},resetModal(){this.modalResolve=null,this.modalReject=null,this.modalMessage="",this.modalIsConfirm=!1,this.currentEmployeeToMark=null},openHistory(s,t,i,u){this.currentEmployee=s,this.formattedHistory=t.map(a=>({date:this.formatDate(a.date),status:a.status,clockIn:this.formatTime(a.clock_in),clockOut:this.formatTime(a.clock_out),hours:this.formatHours(a.total_hours||0)})),this.summary=i,this.employeeInfo=u,this.historyVisible=!0},closeHistory(){this.historyVisible=!1,this.formattedHistory=[],this.summary={},this.employeeInfo={},this.currentEmployee=null},async fetchAttendance(s=!1){this.loading=!0,this.error=null;try{const t=await v.get("/api/manager/attendance",{params:{date:this.selectedDate}}),u=(t.data.attendances||[]).filter(c=>c.date===this.selectedDate);this.attendanceData=u.map(c=>({id:c.employee.id,full_name:`${c.employee.first_name} ${c.employee.last_name}`.trim(),employee_id:c.employee.id,department:c.employee.department||"N/A",position:c.employee.position||"N/A",status:c.status,clock_in_time:c.checkIn,clock_out_time:c.checkOut,hours_worked:c.hoursWorked||0,date:c.date}));const l=(t.data.summary||{}).total_employees||0,f=this.attendanceData.filter(c=>["present","completed"].includes(c.status)).length,n=this.attendanceData.filter(c=>c.status==="late").length,y=this.attendanceData.filter(c=>["absent","on_leave"].includes(c.status)).length,b=f+n,k=l>0?Math.round(b/l*100):0;this.teamOverview={totalEmployees:l,presentCount:f,absentCount:y,lateCount:n,attendanceRate:k}}catch(t){this.handleApiError(t)}finally{this.loading=!1}},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchAttendance(!0):(this.error="Max retries exceeded. Please refresh the page.",this.retryCount=0)},handleApiError(s){var i;let t="Failed to load attendance data.";if(s.response)if(s.response.status===401)t="Session expired. Please log in again.";else if(s.response.status===403)t="Access denied. You must be a manager to view this data.";else if(s.response.status===404){t="No attendance data found for this date.",this.attendanceData=[],this.teamOverview={totalEmployees:0,presentCount:0,absentCount:0,lateCount:0,attendanceRate:0};return}else(i=s.response.data)!=null&&i.message&&(t=s.response.data.message);else s.request&&(t="Network error. Please check your connection.");this.error=t},async attemptMarkPresent(s){this.currentEmployeeToMark=s,await this.showConfirm(`Mark ${s.full_name} as present for ${this.formatDate(this.selectedDate)}? This will register a manual clock-in.`).catch(()=>!1)&&await this.markPresent(s)},async markPresent(s){var t,i;try{await v.post(`/api/manager/attendance/${s.id}/mark-present`,{date:this.selectedDate}),await this.showAlert("Employee successfully marked as present!"),await this.fetchAttendance()}catch(u){const a=((i=(t=u.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to mark employee as present.";await this.showAlert(a)}},async viewHistory(s){var t;this.loadingHistory=!0;try{const i=await v.get(`/api/manager/attendance/${s.id}/history`,{params:{month:new Date(this.selectedDate).getMonth()+1,year:new Date(this.selectedDate).getFullYear(),per_page:10}}),u=i.data.data||[],a=i.data.summary||{},l=i.data.employee||{};if(u.length===0){await this.showAlert(`No attendance history found for ${s.full_name}.`);return}this.openHistory(s,u,a,l)}catch(i){let u="Failed to fetch attendance history.";i.response?i.response.status===404?u=`No attendance history found for ${s.full_name}.`:i.response.status===403?u="You do not have permission to view this employee's history.":(t=i.response.data)!=null&&t.message&&(u=i.response.data.message):i.request&&(u="Network error. Please check your connection."),await this.showAlert(u)}finally{this.loadingHistory=!1}},getInitials(s){var a,l;if(!s)return"??";const t=s.split(" "),i=((a=t[0])==null?void 0:a[0])||"",u=t.length>1?(l=t[t.length-1])==null?void 0:l[0]:"";return(i+u).toUpperCase().substring(0,2)},formatDate(s){if(!s)return"N/A";try{return new Date(s.includes("T")?s:s+"T00:00:00").toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})}catch{return s}},formatTime(s){if(!s)return"N/A";if(s.match(/AM|PM/i))return s;try{let t;return s.includes("T")||s.includes("Z")?t=new Date(s):t=new Date(`2000-01-01T${s}:00`),isNaN(t)?s:t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return s}},formatHours(s){if(s==null||s===void 0)return"0h 0m";const t=Math.floor(s),i=Math.round((s-t)*60);return`${t}h ${i}m`},formatStatus(s){return{present:"Present",completed:"Completed",absent:"Absent",late:"Late",on_leave:"On Leave"}[s]||s},getStatusClass(s){return s==="completed"?"status-present":`status-${s}`}}},S={class:"attendance-monitor"},M={class:"simple-modal-content"},H={class:"modal-actions"},T={key:1,class:"simple-modal-overlay"},I={class:"history-modal-content"},R={class:"history-header"},N={class:"history-body"},O={class:"history-summary"},P={class:"summary-metrics"},E={class:"history-list"},V={key:0,class:"loading"},L={key:1,class:"empty-state"},x={class:"history-date"},F={class:"history-details"},j={class:"modal-actions"},U={class:"page-header"},q={class:"subtitle"},B={class:"header-actions"},Y=["max"],z=["disabled"],W={key:0},Z={key:1},G={key:2,class:"loading"},J={key:3,class:"error-message"},K={key:4},Q={key:0,class:"overview-section"},X={class:"overview-card"},$={class:"overview-metrics"},tt={class:"metric total"},et={class:"metric-value"},st={class:"metric present"},at={class:"metric-value"},nt={class:"metric absent"},lt={class:"metric-value"},ot={class:"metric late"},it={class:"metric-value"},rt={class:"metric rate"},dt={class:"metric-value"},ct={class:"employees-section"},ut={key:0,class:"filter-tabs"},mt={class:"employees-grid"},ht={class:"employee-header"},ft={class:"employee-avatar"},yt={class:"employee-info"},pt={class:"employee-id"},vt={class:"employee-position"},_t={class:"attendance-status"},gt={class:"attendance-details"},bt={class:"detail-row"},kt={class:"value"},Ct={class:"detail-row"},wt={class:"value"},Dt={class:"detail-row"},At={class:"value"},St={class:"detail-row"},Mt={class:"value"},Ht={class:"attendance-actions"},Tt=["onClick"],It=["onClick"],Rt={key:0,class:"empty-state"},Nt={key:0};function Ot(s,t,i,u,a,l){var f;return d(),r("div",S,[a.modalVisible?(d(),r("div",{key:0,class:h(["simple-modal-overlay",{"is-confirm":a.modalIsConfirm}])},[e("div",M,[e("h3",null,o(a.modalIsConfirm?"Confirmation":"Notification"),1),e("p",null,o(a.modalMessage),1),e("div",H,[a.modalIsConfirm?(d(),r("button",{key:0,onClick:t[0]||(t[0]=(...n)=>l.cancelAction&&l.cancelAction(...n)),class:"btn-cancel"},"Cancel")):m("",!0),e("button",{onClick:t[1]||(t[1]=(...n)=>l.confirmAction&&l.confirmAction(...n)),class:"btn-primary"},o(a.modalIsConfirm?"Confirm":"Close"),1)])])],2)):m("",!0),a.historyVisible?(d(),r("div",T,[e("div",I,[e("div",R,[t[12]||(t[12]=e("h3",null,"ðŸ“‹ Attendance History",-1)),e("button",{onClick:t[2]||(t[2]=(...n)=>l.closeHistory&&l.closeHistory(...n)),class:"btn-close"},"Ã—")]),e("div",N,[e("div",O,[e("h4",null,"Summary for "+o(((f=a.currentEmployee)==null?void 0:f.full_name)||"Employee"),1),e("p",null,[t[13]||(t[13]=e("strong",null,"Department:",-1)),p(" "+o(a.employeeInfo.department||"N/A"),1)]),e("p",null,[t[14]||(t[14]=e("strong",null,"Position:",-1)),p(" "+o(a.employeeInfo.position||"N/A"),1)]),e("div",P,[e("span",null,"Total Days: "+o(a.summary.total_records||0),1),e("span",null,"Present: "+o(a.summary.present_days||0),1),e("span",null,"Absent: "+o(a.summary.absent_days||0),1),e("span",null,"Late: "+o(a.summary.late_days||0),1)]),e("p",null,[t[15]||(t[15]=e("strong",null,"Total Hours:",-1)),p(" "+o(l.formatHours(a.summary.total_hours||0)),1)]),e("p",null,[t[16]||(t[16]=e("strong",null,"Avg Hours/Day:",-1)),p(" "+o(l.formatHours(a.summary.average_hours_per_day||0)),1)])]),e("div",E,[t[17]||(t[17]=e("h4",null,"Recent Records (Last 10)",-1)),a.loadingHistory?(d(),r("div",V,"Loading history...")):a.formattedHistory.length===0?(d(),r("div",L," No attendance history found. ")):(d(!0),r(_,{key:2},g(a.formattedHistory,(n,y)=>(d(),r("div",{key:y,class:"history-item"},[e("div",x,o(n.date),1),e("div",F,[e("span",{class:h(["status-badge",l.getStatusClass(n.status)])},o(l.formatStatus(n.status)),3),e("span",null,"Clock In: "+o(n.clockIn),1),e("span",null,"Clock Out: "+o(n.clockOut),1),e("span",null,"Hours: "+o(n.hours),1)])]))),128))])]),e("div",j,[e("button",{onClick:t[3]||(t[3]=(...n)=>l.closeHistory&&l.closeHistory(...n)),class:"btn-primary"},"Close")])])])):m("",!0),e("div",U,[e("div",null,[t[18]||(t[18]=e("h1",null,"Team Attendance Monitor",-1)),e("p",q,"Monitoring team attendance for "+o(l.formatDate(a.selectedDate)),1)]),e("div",B,[C(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=n=>a.selectedDate=n),onChange:t[5]||(t[5]=(...n)=>l.fetchAttendance&&l.fetchAttendance(...n)),max:a.today,class:"date-picker"},null,40,Y),[[w,a.selectedDate]]),e("button",{onClick:t[6]||(t[6]=(...n)=>l.fetchAttendance&&l.fetchAttendance(...n)),class:"btn-refresh",disabled:a.loading},[a.loading?(d(),r("span",W,"Loading...")):(d(),r("span",Z,"ðŸ”„ Refresh"))],8,z)])]),a.loading?(d(),r("div",G,[...t[19]||(t[19]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading attendance data...",-1)])])):a.error?(d(),r("div",J,[p(o(a.error)+" ",1),e("button",{onClick:t[7]||(t[7]=(...n)=>l.retryFetch&&l.retryFetch(...n)),class:"btn-primary"},"Retry")])):(d(),r("div",K,[a.teamOverview?(d(),r("div",Q,[e("div",X,[t[25]||(t[25]=e("h3",null,"ðŸ“Š Team Attendance Overview",-1)),e("div",$,[e("div",tt,[e("span",et,o(a.teamOverview.totalEmployees),1),t[20]||(t[20]=e("span",{class:"metric-label"},"Total Team Members",-1))]),e("div",st,[e("span",at,o(a.teamOverview.presentCount),1),t[21]||(t[21]=e("span",{class:"metric-label"},"Present",-1))]),e("div",nt,[e("span",lt,o(a.teamOverview.absentCount),1),t[22]||(t[22]=e("span",{class:"metric-label"},"Absent",-1))]),e("div",ot,[e("span",it,o(a.teamOverview.lateCount),1),t[23]||(t[23]=e("span",{class:"metric-label"},"Late",-1))]),e("div",rt,[e("span",dt,o(a.teamOverview.attendanceRate)+"%",1),t[24]||(t[24]=e("span",{class:"metric-label"},"Attendance Rate",-1))])])])])):m("",!0),e("div",ct,[e("h2",null,"Team Members ("+o(a.attendanceData.length)+")",1),a.attendanceData.length>0?(d(),r("div",ut,[e("button",{onClick:t[8]||(t[8]=n=>a.filterStatus="all"),class:h([{active:a.filterStatus==="all"},"tab-btn"])}," All ("+o(a.attendanceData.length)+") ",3),e("button",{onClick:t[9]||(t[9]=n=>a.filterStatus="present"),class:h([{active:a.filterStatus==="present"},"tab-btn"])}," Present ("+o(l.presentCount)+") ",3),e("button",{onClick:t[10]||(t[10]=n=>a.filterStatus="absent"),class:h([{active:a.filterStatus==="absent"},"tab-btn"])}," Absent ("+o(l.absentCount)+") ",3),e("button",{onClick:t[11]||(t[11]=n=>a.filterStatus="late"),class:h([{active:a.filterStatus==="late"},"tab-btn"])}," Late ("+o(l.lateCount)+") ",3)])):m("",!0),e("div",mt,[(d(!0),r(_,null,g(l.filteredData,n=>(d(),r("div",{key:n.id,class:"employee-card"},[e("div",ht,[e("div",ft,o(l.getInitials(n.full_name)),1),e("div",yt,[e("h3",null,o(n.full_name),1),e("p",pt,o(n.employee_id)+" â€¢ "+o(n.department),1),e("p",vt,o(n.position),1)]),e("div",_t,[e("span",{class:h(["status-badge",l.getStatusClass(n.status)])},o(l.formatStatus(n.status)),3)])]),e("div",gt,[e("div",bt,[t[26]||(t[26]=e("span",{class:"label"},"ðŸ• Clock In:",-1)),e("span",kt,o(l.formatTime(n.clock_in_time)),1)]),e("div",Ct,[t[27]||(t[27]=e("span",{class:"label"},"ðŸ• Clock Out:",-1)),e("span",wt,o(l.formatTime(n.clock_out_time)),1)]),e("div",Dt,[t[28]||(t[28]=e("span",{class:"label"},"â±ï¸ Hours Worked:",-1)),e("span",At,o(l.formatHours(n.hours_worked)),1)]),e("div",St,[t[29]||(t[29]=e("span",{class:"label"},"ðŸ“… Date:",-1)),e("span",Mt,o(l.formatDate(n.date)),1)])]),e("div",Ht,[e("button",{onClick:y=>l.viewHistory(n),class:"btn-view"}," ðŸ“‹ View History ",8,Tt),n.status==="absent"&&l.isToday?(d(),r("button",{key:0,onClick:y=>l.attemptMarkPresent(n),class:"btn-mark"}," âœ“ Mark Present ",8,It)):m("",!0)])]))),128)),l.filteredData.length===0?(d(),r("div",Rt,[t[30]||(t[30]=e("div",{class:"empty-icon"},"ðŸ“­",-1)),e("p",null,"No "+o(a.filterStatus==="all"?"":l.formatStatus(a.filterStatus).toLowerCase())+" employees found",1),a.filterStatus!=="all"?(d(),r("p",Nt,"Try changing the filter or date")):m("",!0)])):m("",!0)])])]))])}const Vt=D(A,[["render",Ot],["__scopeId","data-v-f14487f0"]]);export{Vt as default};
