import{g as m,G as j,w as k,K as C,f as c,b as p,C as u,v as K,p as e,t as i,z as h,a as b,q as P,x as v,y as w,F as H,D as X,e as $,B as ss,E as es}from"./vendor-CFHPe_rb.js";import{_ as Z}from"./index-BxkOZnhC.js";const ls={name:"PayslipDetailModal",props:{visible:{type:Boolean,required:!0},employeeId:{type:Number,required:!1},payrollPeriod:{type:String,required:!1}},data(){return{payslip:null,loading:!1,error:null,isPreview:!1}},watch:{visible(l){l&&this.employeeId&&this.payrollPeriod&&this.fetchPayslipDetails()}},methods:{async fetchPayslipDetails(){var l,s;this.loading=!0,this.error=null;try{const r=await m.get(`/api/admin/payroll/employee/${this.employeeId}/payslip`,{params:{payroll_period:this.payrollPeriod}});this.payslip=r.data.data,this.isPreview=r.data.is_preview||!1}catch(r){console.error("Failed to load payslip:",r),this.error=((s=(l=r.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to load payslip details"}finally{this.loading=!1}},retry(){this.fetchPayslipDetails()},close(){this.$emit("close"),setTimeout(()=>{this.payslip=null,this.error=null,this.isPreview=!1},300)},downloadPdf(){var l;(l=this.payslip)!=null&&l.id&&window.open(`/api/payslips/${this.payslip.id}/download`,"_blank")},formatCurrency(l){return new Intl.NumberFormat("en-ZM",{style:"currency",currency:"ZMW",minimumFractionDigits:2}).format(l||0)},formatDate(l){return l?new Date(l).toLocaleDateString("en-ZM",{year:"numeric",month:"long",day:"numeric"}):"â€”"},formatPeriod(l){if(!l)return"â€”";const[s,r]=l.split("-");return`${["January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(r)-1]} ${s}`},getStatusIcon(l){return{pending:"â³",paid:"âœ“",draft:"ðŸ“",generated:"ðŸ“„"}[l]||"â€¢"},getStatusText(l){return l?l.charAt(0).toUpperCase()+l.slice(1):"Unknown"}}},ts={class:"modal-container"},as={class:"modal-header"},os={key:0,class:"modal-loading"},ns={key:1,class:"modal-error"},rs={key:2,class:"modal-body"},is={key:0,class:"preview-badge"},ds={class:"section employee-section"},cs={class:"info-grid"},ps={class:"info-item"},us={class:"value"},ys={class:"info-item"},ms={class:"value"},gs={class:"info-item"},hs={class:"value"},fs={class:"info-item"},_s={class:"value"},vs={class:"section period-section"},bs={class:"info-grid"},Ps={class:"info-item"},ws={class:"value"},ks={class:"info-item"},Cs={class:"value"},Ds={class:"info-item"},Es={class:"value"},Ss={class:"info-item"},Ms={class:"value"},As={class:"section earnings-section"},Ns={class:"calculation-table"},Is={class:"calc-row"},xs={class:"calc-value"},Ts={class:"calc-row indent"},Fs={class:"calc-value"},Bs={class:"calc-row indent"},Us={class:"calc-value"},Vs={class:"calc-row indent"},Ls={class:"calc-value"},Rs={key:0,class:"calc-row subsection"},qs={key:1,class:"calc-row indent"},Ys={class:"calc-label"},Qs={class:"calc-value"},zs={key:2,class:"calc-row"},Gs={class:"calc-value"},Os={class:"calc-row total"},Ws={class:"calc-value"},Js={class:"section deductions-section"},Zs={class:"calculation-table"},js={class:"calc-row"},Ks={class:"calc-value negative"},Hs={class:"calc-row"},Xs={class:"calc-value negative"},$s={class:"calc-row"},se={class:"calc-value negative"},ee={key:0,class:"calc-row"},le={class:"calc-value negative"},te={class:"calc-row total"},ae={class:"calc-value negative"},oe={class:"section summary-section"},ne={class:"net-pay-card"},re={class:"summary-row"},ie={class:"summary-value"},de={class:"summary-row"},ce={class:"summary-value negative"},pe={class:"summary-row net-pay-row"},ue={class:"summary-value net-pay"},ye={class:"section status-section"},me={class:"status-icon"},ge={class:"status-text"},he={class:"modal-footer"};function fe(l,s,r,o,t,a){return c(),j(C,{name:"modal-fade"},{default:k(()=>{var d,n,y,f,_,D,E,S,M,A,N,I,x,T,F,B,U,V,L,R,q,Y,Q,z,G,O,W,J;return[r.visible?(c(),p("div",{key:0,class:"modal-overlay",onClick:s[4]||(s[4]=K((...g)=>a.close&&a.close(...g),["self"]))},[e("div",ts,[e("div",as,[e("h2",null,i(t.isPreview?"Payslip Preview":"Payslip Details"),1),e("button",{onClick:s[0]||(s[0]=(...g)=>a.close&&a.close(...g)),class:"close-btn"},"Ã—")]),t.loading?(c(),p("div",os,[...s[5]||(s[5]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading payslip details...",-1)])])):t.error?(c(),p("div",ns,[e("p",null,i(t.error),1),e("button",{onClick:s[1]||(s[1]=(...g)=>a.retry&&a.retry(...g)),class:"retry-btn"},"Retry")])):t.payslip?(c(),p("div",rs,[t.isPreview?(c(),p("div",is," âš ï¸ This is a preview. Process payroll to finalize. ")):u("",!0),e("section",ds,[s[10]||(s[10]=e("h3",null,"Employee Information",-1)),e("div",cs,[e("div",ps,[s[6]||(s[6]=e("span",{class:"label"},"Name:",-1)),e("span",us,i((d=t.payslip.employee)==null?void 0:d.name),1)]),e("div",ys,[s[7]||(s[7]=e("span",{class:"label"},"ID:",-1)),e("span",ms,i((n=t.payslip.employee)==null?void 0:n.employee_id),1)]),e("div",gs,[s[8]||(s[8]=e("span",{class:"label"},"Department:",-1)),e("span",hs,i((y=t.payslip.employee)==null?void 0:y.department),1)]),e("div",fs,[s[9]||(s[9]=e("span",{class:"label"},"Position:",-1)),e("span",_s,i((f=t.payslip.employee)==null?void 0:f.position),1)])])]),e("section",vs,[s[15]||(s[15]=e("h3",null,"Pay Period",-1)),e("div",bs,[e("div",Ps,[s[11]||(s[11]=e("span",{class:"label"},"Period:",-1)),e("span",ws,i(a.formatPeriod((_=t.payslip.period)==null?void 0:_.payroll_period)),1)]),e("div",ks,[s[12]||(s[12]=e("span",{class:"label"},"Start Date:",-1)),e("span",Cs,i(a.formatDate((D=t.payslip.period)==null?void 0:D.start_date)),1)]),e("div",Ds,[s[13]||(s[13]=e("span",{class:"label"},"End Date:",-1)),e("span",Es,i(a.formatDate((E=t.payslip.period)==null?void 0:E.end_date)),1)]),e("div",Ss,[s[14]||(s[14]=e("span",{class:"label"},"Payment Date:",-1)),e("span",Ms,i(a.formatDate((S=t.payslip.period)==null?void 0:S.payment_date)),1)])])]),e("section",As,[s[24]||(s[24]=e("h3",null,"Earnings Breakdown",-1)),e("div",Ns,[e("div",Is,[s[16]||(s[16]=e("span",{class:"calc-label"},"Basic Salary",-1)),e("span",xs,i(a.formatCurrency((M=t.payslip.earnings)==null?void 0:M.basic_salary)),1)]),s[23]||(s[23]=e("div",{class:"calc-row subsection"},[e("span",{class:"calc-label"},"Allowances:"),e("span",{class:"calc-value"})],-1)),e("div",Ts,[s[17]||(s[17]=e("span",{class:"calc-label"},"Housing Allowance (25%)",-1)),e("span",Fs,i(a.formatCurrency((A=t.payslip.earnings)==null?void 0:A.house_allowance)),1)]),e("div",Bs,[s[18]||(s[18]=e("span",{class:"calc-label"},"Transport Allowance",-1)),e("span",Us,i(a.formatCurrency((N=t.payslip.earnings)==null?void 0:N.transport_allowance)),1)]),e("div",Vs,[s[19]||(s[19]=e("span",{class:"calc-label"},"Lunch Allowance",-1)),e("span",Ls,i(a.formatCurrency((I=t.payslip.earnings)==null?void 0:I.lunch_allowance)),1)]),((x=t.payslip.earnings)==null?void 0:x.overtime_hours)>0?(c(),p("div",Rs,[...s[20]||(s[20]=[e("span",{class:"calc-label"},"Overtime:",-1),e("span",{class:"calc-value"},null,-1)])])):u("",!0),((T=t.payslip.earnings)==null?void 0:T.overtime_hours)>0?(c(),p("div",qs,[e("span",Ys,i(t.payslip.earnings.overtime_hours)+"hrs @ "+i(a.formatCurrency(t.payslip.earnings.overtime_rate))+"/hr",1),e("span",Qs,i(a.formatCurrency((F=t.payslip.earnings)==null?void 0:F.overtime_pay)),1)])):u("",!0),((B=t.payslip.earnings)==null?void 0:B.bonuses)>0?(c(),p("div",zs,[s[21]||(s[21]=e("span",{class:"calc-label"},"Bonuses",-1)),e("span",Gs,i(a.formatCurrency((U=t.payslip.earnings)==null?void 0:U.bonuses)),1)])):u("",!0),e("div",Os,[s[22]||(s[22]=e("span",{class:"calc-label"},"Gross Salary",-1)),e("span",Ws,i(a.formatCurrency((V=t.payslip.earnings)==null?void 0:V.gross_salary)),1)])])]),e("section",Js,[s[30]||(s[30]=e("h3",null,"Deductions Breakdown",-1)),e("div",Zs,[e("div",js,[s[25]||(s[25]=e("span",{class:"calc-label"},"PAYE (on Basic Salary)",-1)),e("span",Ks,"-"+i(a.formatCurrency((L=t.payslip.deductions)==null?void 0:L.paye)),1)]),e("div",Hs,[s[26]||(s[26]=e("span",{class:"calc-label"},"NAPSA (10% of Gross, capped)",-1)),e("span",Xs,"-"+i(a.formatCurrency((R=t.payslip.deductions)==null?void 0:R.napsa)),1)]),e("div",$s,[s[27]||(s[27]=e("span",{class:"calc-label"},"NHIMA (1% of Gross)",-1)),e("span",se,"-"+i(a.formatCurrency((q=t.payslip.deductions)==null?void 0:q.nhima)),1)]),((Y=t.payslip.deductions)==null?void 0:Y.other_deductions)>0?(c(),p("div",ee,[s[28]||(s[28]=e("span",{class:"calc-label"},"Other Deductions",-1)),e("span",le,"-"+i(a.formatCurrency((Q=t.payslip.deductions)==null?void 0:Q.other_deductions)),1)])):u("",!0),e("div",te,[s[29]||(s[29]=e("span",{class:"calc-label"},"Total Deductions",-1)),e("span",ae,"-"+i(a.formatCurrency((z=t.payslip.deductions)==null?void 0:z.total_deductions)),1)])])]),e("section",oe,[e("div",ne,[e("div",re,[s[31]||(s[31]=e("span",{class:"summary-label"},"Gross Pay:",-1)),e("span",ie,i(a.formatCurrency((G=t.payslip.summary)==null?void 0:G.gross_pay)),1)]),e("div",de,[s[32]||(s[32]=e("span",{class:"summary-label"},"Total Deductions:",-1)),e("span",ce,"-"+i(a.formatCurrency((O=t.payslip.summary)==null?void 0:O.total_deductions)),1)]),s[34]||(s[34]=e("div",{class:"summary-divider"},null,-1)),e("div",pe,[s[33]||(s[33]=e("span",{class:"summary-label"},"Net Pay:",-1)),e("span",ue,i(a.formatCurrency((W=t.payslip.summary)==null?void 0:W.net_pay)),1)])])]),e("section",ye,[e("div",{class:h(["status-badge",t.payslip.status])},[e("span",me,i(a.getStatusIcon(t.payslip.status)),1),e("span",ge,i(a.getStatusText(t.payslip.status)),1)],2)])])):u("",!0),e("div",he,[e("button",{onClick:s[2]||(s[2]=(...g)=>a.close&&a.close(...g)),class:"btn-secondary"},"Close"),!t.isPreview&&((J=t.payslip)!=null&&J.pdf_available)?(c(),p("button",{key:0,onClick:s[3]||(s[3]=(...g)=>a.downloadPdf&&a.downloadPdf(...g)),class:"btn-primary"}," ðŸ“„ Download PDF ")):u("",!0)])])])):u("",!0)]}),_:1})}const _e=Z(ls,[["render",fe],["__scopeId","data-v-66ae654a"]]),ve={name:"PayrollProcessing",components:{PayslipDetailModal:_e},data(){return{pageName:"Payroll Processing Dashboard",employees:[],processing:!1,loading:!0,error:null,successMessage:null,taxConfigWarning:null,searchQuery:"",filterStatus:"all",payrollPeriod:"",startDate:"",endDate:"",showModal:!1,selectedEmployeeId:null}},computed:{pendingCount(){return this.employees.filter(l=>l.payroll_status==="pending").length},paidCount(){return this.employees.filter(l=>l.payroll_status==="paid").length},totalPayroll(){return this.employees.filter(l=>l.payroll_status==="pending").reduce((l,s)=>l+(s.net_pay||0),0)},filteredEmployees(){let l=this.employees;if(this.filterStatus!=="all"&&(l=l.filter(s=>s.payroll_status===this.filterStatus)),this.searchQuery){const s=this.searchQuery.toLowerCase();l=l.filter(r=>r.name.toLowerCase().includes(s)||r.position.toLowerCase().includes(s)||r.id.toString().includes(s)||r.email&&r.email.toLowerCase().includes(s))}return l},selectedCount(){return this.employees.filter(l=>l.selected).length},allSelected(){return this.filteredEmployees.length>0&&this.filteredEmployees.every(l=>l.selected)}},async mounted(){console.log("ðŸš€ PayrollProcessing component mounted"),await this.initializePayrollPeriod(),await this.fetchEmployees()},methods:{updateDateRange(){if(console.log("ðŸ“… Date range updated - payrollPeriod:",this.payrollPeriod),this.payrollPeriod){const[l,s]=this.payrollPeriod.split("-");this.startDate=`${l}-${s}-01`;const r=new Date(l,parseInt(s),0);this.endDate=`${l}-${s}-${r.getDate().toString().padStart(2,"0")}`,console.log("ðŸ“… Calculated date range:",{startDate:this.startDate,endDate:this.endDate})}},async refreshPayrollData(){console.log("ðŸ”„ Manually refreshing payroll data..."),await this.fetchEmployees()},initializePayrollPeriod(){const l=new Date,s=l.getFullYear(),o=(l.getMonth()+1).toString().padStart(2,"0");this.payrollPeriod=`${s}-${o}`,console.log("ðŸ“… Initialized payroll period:",this.payrollPeriod),this.updateDateRange()},async fetchEmployees(){var l,s,r;this.loading=!0,this.error=null;try{const o={payroll_period:this.payrollPeriod,start_date:this.startDate,end_date:this.endDate,per_page:1e3};console.log("ðŸ“¡ Fetching payroll summary data with params:",o);const t=await m.get("/api/admin/payroll/employees-summary",{params:o});console.log("âœ… Payroll Employees Summary API Response:",t.data),this.employees=t.data.data.map(d=>({id:d.id,name:d.name,email:d.email,position:d.position||d.department||"Unassigned",base_salary:d.base_salary||0,gross_salary:d.gross_salary||0,net_pay:d.net_pay||0,payroll_status:d.payroll_status||"pending",payPeriod:d.pay_period||this.payrollPeriod,employee_record:d,selected:!1,payslip_data:d.payslip_data})),console.log(`âœ… Final payroll data loaded: ${this.employees.length} employees`),console.log("ðŸ“Š Final employees array:",this.employees.map(d=>({id:d.id,name:d.name,base_salary:d.base_salary,gross_salary:d.gross_salary,net_pay:d.net_pay,status:d.payroll_status,hasPayslip:!!d.payslip_data})));const a={total:this.employees.length,pending:this.employees.filter(d=>d.payroll_status==="pending").length,paid:this.employees.filter(d=>d.payroll_status==="paid").length,withPayslipData:this.employees.filter(d=>d.payslip_data).length,totalPayroll:this.employees.filter(d=>d.payroll_status==="pending").reduce((d,n)=>d+(n.net_pay||0),0)};console.log("ðŸ“ˆ Summary Statistics:",a)}catch(o){console.error("âŒ Failed to load payroll data:",o),console.error("Error details:",{message:o.message,response:(l=o.response)==null?void 0:l.data,status:(s=o.response)==null?void 0:s.status,headers:(r=o.response)==null?void 0:r.headers}),this.handleError(o)}finally{this.loading=!1,console.log("ðŸ fetchEmployees completed")}},getPayrollDates(){const l={payroll_period:this.payrollPeriod,start_date:this.startDate,end_date:this.endDate};return console.log("ðŸ“… getPayrollDates returning:",l),l},preparePayrollPayload(l){const r={employee_ids:l.map(o=>parseInt(o)).filter(o=>!isNaN(o)),...this.getPayrollDates()};return console.log("ðŸ“¦ Prepared payroll payload:",r),r},async processPayroll(){var s;const l=this.employees.filter(r=>r.payroll_status==="pending");if(console.log("ðŸš€ Processing payroll for pending employees:",l.map(r=>({id:r.id,name:r.name,net_pay:r.net_pay}))),l.length===0){this.showError("No pending payroll to process.");return}if(!confirm(`Process payroll for ${l.length} pending employee(s)?`)){console.log("âŒ User cancelled payroll processing");return}this.processing=!0;try{const r=l.map(a=>a.id),o=this.preparePayrollPayload(r);console.log("ðŸ“¤ Sending payroll process request with payload:",o);const t=await m.post("/api/admin/payroll/process",o);console.log("âœ… Payroll process response:",t.data),await this.fetchEmployees(),this.showSuccess("Payroll processed successfully!")}catch(r){console.error("âŒ Payroll processing error:",r),console.error("Error response:",(s=r.response)==null?void 0:s.data),this.handlePayrollError(r)}finally{this.processing=!1}},async bulkMarkPaid(){var r;const l=this.employees.filter(o=>o.selected&&o.payroll_status),s=l.map(o=>o.id);if(console.log("ðŸ”„ Bulk marking as paid:",l.map(o=>({id:o.id,name:o.name,current_status:o.payroll_status}))),s.length===0){this.showError("No employees with payroll status selected.");return}if(!confirm(`Mark ${s.length} employee(s) as paid?`)){console.log("âŒ User cancelled bulk mark paid");return}try{const o=this.preparePayrollPayload(s);console.log("ðŸ“¤ Sending bulk mark paid request with payload:",o);const t=await m.post("/api/admin/payroll/process",o);console.log("âœ… Bulk mark paid response:",t.data),await this.fetchEmployees(),this.showSuccess(`${s.length} employee(s) marked as paid.`)}catch(o){console.error("âŒ Bulk mark paid error:",o),console.error("Error response:",(r=o.response)==null?void 0:r.data),this.handlePayrollError(o)}},async bulkMarkPending(){var r;const l=this.employees.filter(o=>o.selected&&o.payroll_status),s=l.map(o=>o.id);if(console.log("ðŸ”„ Bulk marking as pending:",l.map(o=>({id:o.id,name:o.name,current_status:o.payroll_status}))),s.length===0){this.showError("No employees with payroll status selected.");return}if(!confirm(`Mark ${s.length} employee(s) as pending?`)){console.log("âŒ User cancelled bulk mark pending");return}try{const o={employee_ids:s,status:"pending",...this.getPayrollDates()};console.log("ðŸ“¤ Sending bulk mark pending request with payload:",o);const t=await m.post("/api/admin/payroll/update-status",o);console.log("âœ… Bulk mark pending response:",t.data),await this.fetchEmployees(),this.showSuccess(`${s.length} employee(s) marked as pending.`)}catch(o){console.error("âŒ Bulk mark pending error:",o),console.error("Error response:",(r=o.response)==null?void 0:r.data),this.handlePayrollError(o)}},async toggleStatus(l){var t;const s=this.employees.find(a=>a.id===l);if(console.log("ðŸ”„ Toggling status for employee:",{id:l,name:s==null?void 0:s.name,current_status:s==null?void 0:s.payroll_status}),!s||!s.payroll_status){this.showError("Cannot toggle status for employee without payroll status");return}const r=s.payroll_status,o=r==="pending"?"paid":"pending";console.log(`ðŸ”„ Changing status from ${r} to ${o}`);try{let a;o==="paid"?(a=this.preparePayrollPayload([l]),console.log("ðŸ“¤ Marking as paid with payload:",a),await m.post("/api/admin/payroll/process",a)):(a={employee_ids:[l],status:o,...this.getPayrollDates()},console.log("ðŸ“¤ Marking as pending with payload:",a),await m.post("/api/admin/payroll/update-status",a)),await this.fetchEmployees(),this.showSuccess(`Employee marked as ${o}.`)}catch(a){console.error("âŒ Toggle status error:",a),console.error("Error response:",(t=a.response)==null?void 0:t.data),this.handlePayrollError(a)}},async setInitialStatus(l){var o;const s=this.employees.find(t=>t.id===l);if(console.log("âš™ï¸ Setting initial status for employee:",{id:l,name:s==null?void 0:s.name}),!s)return;const r=confirm(`Set initial status as Pending?

Click OK for Pending, Cancel for Paid`)?"pending":"paid";console.log(`âš™ï¸ Setting initial status to: ${r}`);try{let t;r==="paid"?(t=this.preparePayrollPayload([l]),console.log("ðŸ“¤ Setting as paid with payload:",t),await m.post("/api/admin/payroll/process",t)):(t={employee_ids:[l],status:r,...this.getPayrollDates()},console.log("ðŸ“¤ Setting as pending with payload:",t),await m.post("/api/admin/payroll/update-status",t)),await this.fetchEmployees(),this.showSuccess(`Employee status set to ${r}.`)}catch(t){console.error("âŒ Set initial status error:",t),console.error("Error response:",(o=t.response)==null?void 0:o.data),this.handlePayrollError(t)}},handlePayrollError(l){var s;if(console.error("ðŸ’¥ Payroll error handler triggered:",l),((s=l.response)==null?void 0:s.status)===422){const r=l.response.data;let o="Validation failed: ";if(r.errors){const t=r.errors,a=[];for(const[d,n]of Object.entries(t))a.push(`${d}: ${Array.isArray(n)?n.join(", "):n}`);o+=a.join("; ")}else r.message?o=r.message:o+="Please check the data and try again.";console.error("âŒ Validation error:",o),this.showError(o)}else this.handleError(l)},getInitials(l){return!l||l==="â€”"||l==="Unknown Employee"?"??":l.split(" ").map(s=>s[0]).join("").toUpperCase().substring(0,2)},getAvatarColor(l){const s=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #30cfd0 0%, #330867 100%)"],r=l.split("").reduce((o,t)=>o+t.charCodeAt(0),0)%s.length;return s[r]},addEmployee(){console.log("âž• Navigating to add employee page"),this.$router.push({name:"admin.employees.create"})},toggleSelectAll(){const l=!this.allSelected;console.log(`ðŸ”˜ Toggle select all: ${l?"selecting":"deselecting"} all ${this.filteredEmployees.length} employees`),this.filteredEmployees.forEach(s=>{s.selected=l})},clearSelection(){console.log("ðŸ”˜ Clearing selection"),this.employees.forEach(l=>{l.selected=!1})},viewDetails(l){const s=this.employees.find(r=>r.id===l);console.log("ðŸ‘ï¸ Viewing details for employee:",{id:s==null?void 0:s.id,name:s==null?void 0:s.name,base_salary:s==null?void 0:s.base_salary,gross_salary:s==null?void 0:s.gross_salary,net_pay:s==null?void 0:s.net_pay,status:s==null?void 0:s.payroll_status}),console.log("ðŸ“„ Payslip data available:",s==null?void 0:s.payslip_data),this.selectedEmployeeId=l,this.showModal=!0},async deleteEmployee(l){const s=this.employees.find(r=>r.id===l);if(console.log("ðŸ—‘ï¸ Attempting to delete employee:",{id:l,name:s==null?void 0:s.name}),!confirm(`Delete ${(s==null?void 0:s.name)||"this employee"}? This cannot be undone.`)){console.log("âŒ User cancelled employee deletion");return}try{await m.delete(`/api/admin/employees/${l}`),this.employees=this.employees.filter(r=>r.id!==l),console.log("âœ… Employee deleted successfully"),this.showSuccess("Employee removed successfully.")}catch(r){console.error("âŒ Delete employee error:",r),this.handleError(r)}},clearSearch(){console.log("ðŸ” Clearing search query"),this.searchQuery=""},dismissError(){console.log("âŒ Dismissing error banner"),this.error=null},showSuccess(l){console.log("âœ… Showing success message:",l),this.successMessage=l,setTimeout(()=>{this.successMessage=null},5e3)},showError(l){console.log("âŒ Showing error message:",l),this.error=l,setTimeout(()=>{this.error=null},5e3)},formatCurrency(l){return new Intl.NumberFormat("en-ZM",{style:"currency",currency:"ZMW",minimumFractionDigits:2}).format(l)},formatDate(l){if(!l)return"â€”";if(l.match(/^\d{4}-\d{2}$/)){const[r,o]=l.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o)-1]} ${r}`}const s=new Date(l);return isNaN(s.getTime())?"â€”":s.toLocaleDateString("en-ZM",{year:"numeric",month:"short",day:"numeric"})},handleError(l){var r,o,t,a,d,n,y,f,_;console.error("ðŸ’¥ Global error handler triggered:",l);let s="An unexpected error occurred.";if(((r=l.response)==null?void 0:r.status)===401){s="Your session has expired. Please log in again.",console.warn("ðŸ” Authentication error - redirecting to login"),(t=(o=this.$store)==null?void 0:o.auth)!=null&&t.clearAuth&&this.$store.auth.clearAuth(),this.$router.push({name:"login"});return}else if(((a=l.response)==null?void 0:a.status)===403)s="You do not have permission to perform this action.";else{if(((d=l.response)==null?void 0:d.status)===422)return;(y=(n=l.response)==null?void 0:n.data)!=null&&y.message?s=l.response.data.message:l.message?s=l.message:l.code==="ERR_NETWORK"&&(s="Network error. Please check your connection.")}this.error=s,console.error("API Error details:",{message:l.message,response:(f=l.response)==null?void 0:f.data,status:(_=l.response)==null?void 0:_.status})}}},be={class:"payroll-view"},Pe={class:"header"},we={class:"title"},ke={class:"header-actions"},Ce=["disabled"],De={key:0,class:"spinner-small"},Ee={class:"date-selection-section"},Se={class:"date-inputs"},Me={class:"form-group"},Ae={class:"form-group"},Ne={class:"form-group"},Ie={key:0,class:"warning-banner"},xe={key:0,class:"error-banner"},Te={key:0,class:"success-banner"},Fe={class:"summary-cards"},Be={class:"card"},Ue={class:"value"},Ve={class:"card"},Le={class:"value pending"},Re={class:"card"},qe={class:"value"},Ye={class:"card"},Qe={class:"value success"},ze={class:"filters-section"},Ge={class:"search-box"},Oe={class:"filter-buttons"},We={class:"content"},Je={key:0,class:"loading-state"},Ze={key:1,class:"empty-state"},je={key:2,class:"empty-state"},Ke={key:3,class:"table-container"},He={class:"payroll-table"},Xe=["checked"],$e=["onUpdate:modelValue"],sl={class:"employee-name"},el={class:"employee-info"},ll={class:"name"},tl={class:"email"},al={class:"position-badge"},ol={class:"salary"},nl={class:"gross-salary"},rl={class:"net-pay"},il={key:1,class:"status unknown"},dl={class:"action-buttons"},cl=["onClick"],pl=["onClick","title"],ul=["onClick"],yl=["onClick"],ml={key:0,class:"bulk-actions"},gl={class:"selected-count"};function hl(l,s,r,o,t,a){const d=$("PayslipDetailModal");return c(),p("div",be,[e("header",Pe,[e("h1",we,i(t.pageName),1),e("div",ke,[e("button",{onClick:s[0]||(s[0]=(...n)=>a.addEmployee&&a.addEmployee(...n)),class:"add-btn"},[...s[21]||(s[21]=[e("span",{class:"btn-icon"},"+",-1),P(" Add Employee ",-1)])]),e("button",{onClick:s[1]||(s[1]=(...n)=>a.processPayroll&&a.processPayroll(...n)),class:"process-btn",disabled:t.processing||a.pendingCount===0},[t.processing?(c(),p("span",De)):u("",!0),P(" "+i(t.processing?"Processing...":"Process Payroll"),1)],8,Ce)])]),e("div",Ee,[e("div",Se,[e("div",Me,[s[22]||(s[22]=e("label",{class:"form-label"},"Payroll Period (YYYY-MM)",-1)),v(e("input",{type:"month","onUpdate:modelValue":s[2]||(s[2]=n=>t.payrollPeriod=n),onChange:s[3]||(s[3]=(...n)=>a.updateDateRange&&a.updateDateRange(...n)),class:"date-input"},null,544),[[w,t.payrollPeriod]])]),e("div",Ae,[s[23]||(s[23]=e("label",{class:"form-label"},"Start Date",-1)),v(e("input",{type:"date","onUpdate:modelValue":s[4]||(s[4]=n=>t.startDate=n),class:"date-input"},null,512),[[w,t.startDate]])]),e("div",Ne,[s[24]||(s[24]=e("label",{class:"form-label"},"End Date",-1)),v(e("input",{type:"date","onUpdate:modelValue":s[5]||(s[5]=n=>t.endDate=n),class:"date-input"},null,512),[[w,t.endDate]])]),e("button",{onClick:s[6]||(s[6]=(...n)=>a.refreshPayrollData&&a.refreshPayrollData(...n)),class:"refresh-btn"}," ðŸ”„ Refresh ")])]),b(C,{name:"fade"},{default:k(()=>[t.taxConfigWarning?(c(),p("div",Ie,[e("span",null,"âš ï¸ "+i(t.taxConfigWarning),1),e("button",{onClick:s[7]||(s[7]=n=>t.taxConfigWarning=null),class:"dismiss-btn"},"Ã—")])):u("",!0)]),_:1}),b(C,{name:"fade"},{default:k(()=>[t.error?(c(),p("div",xe,[e("span",null,i(t.error),1),e("button",{onClick:s[8]||(s[8]=(...n)=>a.dismissError&&a.dismissError(...n)),class:"dismiss-btn"},"Ã—")])):u("",!0)]),_:1}),b(C,{name:"fade"},{default:k(()=>[t.successMessage?(c(),p("div",Te,[e("span",null,i(t.successMessage),1),e("button",{onClick:s[9]||(s[9]=n=>t.successMessage=null),class:"dismiss-btn"},"Ã—")])):u("",!0)]),_:1}),e("div",Fe,[e("div",Be,[s[25]||(s[25]=e("div",{class:"card-icon employees"},"ðŸ‘¥",-1)),s[26]||(s[26]=e("h3",null,"Total Employees",-1)),e("p",Ue,i(t.employees.length),1)]),e("div",Ve,[s[27]||(s[27]=e("div",{class:"card-icon pending"},"â³",-1)),s[28]||(s[28]=e("h3",null,"Pending Payroll",-1)),e("p",Le,i(a.pendingCount),1)]),e("div",Re,[s[29]||(s[29]=e("div",{class:"card-icon amount"},"ðŸ’°",-1)),s[30]||(s[30]=e("h3",null,"Total Payroll Amount",-1)),e("p",qe,i(a.formatCurrency(a.totalPayroll)),1)]),e("div",Ye,[s[31]||(s[31]=e("div",{class:"card-icon paid"},"âœ“",-1)),s[32]||(s[32]=e("h3",null,"Paid This Period",-1)),e("p",Qe,i(a.paidCount),1)])]),e("div",ze,[e("div",Ge,[v(e("input",{"onUpdate:modelValue":s[10]||(s[10]=n=>t.searchQuery=n),type:"text",placeholder:"Search by name, position, or ID...",class:"search-input"},null,512),[[w,t.searchQuery]])]),e("div",Oe,[e("button",{onClick:s[11]||(s[11]=n=>t.filterStatus="all"),class:h(["filter-btn",{active:t.filterStatus==="all"}])}," All ("+i(t.employees.length)+") ",3),e("button",{onClick:s[12]||(s[12]=n=>t.filterStatus="pending"),class:h(["filter-btn",{active:t.filterStatus==="pending"}])}," Pending ("+i(a.pendingCount)+") ",3),e("button",{onClick:s[13]||(s[13]=n=>t.filterStatus="paid"),class:h(["filter-btn",{active:t.filterStatus==="paid"}])}," Paid ("+i(a.paidCount)+") ",3)])]),e("div",We,[t.loading?(c(),p("div",Je,[...s[33]||(s[33]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading payroll data...",-1)])])):a.filteredEmployees.length===0&&!t.searchQuery?(c(),p("div",Ze,[s[34]||(s[34]=e("div",{class:"empty-icon"},"ðŸ“‹",-1)),s[35]||(s[35]=e("h2",null,"No Employees Found",-1)),s[36]||(s[36]=e("p",null,"Add employees to start processing payroll.",-1)),e("button",{onClick:s[14]||(s[14]=(...n)=>a.addEmployee&&a.addEmployee(...n)),class:"btn-primary"},"Add Your First Employee")])):a.filteredEmployees.length===0&&t.searchQuery?(c(),p("div",je,[s[37]||(s[37]=e("div",{class:"empty-icon"},"ðŸ”",-1)),s[38]||(s[38]=e("h2",null,"No Results Found",-1)),s[39]||(s[39]=e("p",null,"Try adjusting your search criteria.",-1)),e("button",{onClick:s[15]||(s[15]=(...n)=>a.clearSearch&&a.clearSearch(...n)),class:"btn-secondary"},"Clear Search")])):(c(),p("div",Ke,[e("table",He,[e("thead",null,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",onChange:s[16]||(s[16]=(...n)=>a.toggleSelectAll&&a.toggleSelectAll(...n)),checked:a.allSelected,class:"checkbox"},null,40,Xe)]),s[40]||(s[40]=e("th",null,"ID",-1)),s[41]||(s[41]=e("th",null,"Employee",-1)),s[42]||(s[42]=e("th",null,"Position",-1)),s[43]||(s[43]=e("th",null,"Base Salary",-1)),s[44]||(s[44]=e("th",null,"Gross Salary",-1)),s[45]||(s[45]=e("th",null,"Net Pay",-1)),s[46]||(s[46]=e("th",null,"Status",-1)),s[47]||(s[47]=e("th",null,"Pay Period",-1)),s[48]||(s[48]=e("th",null,"Actions",-1))])]),e("tbody",null,[(c(!0),p(H,null,X(a.filteredEmployees,n=>(c(),p("tr",{key:n.id,class:h({selected:n.selected})},[e("td",null,[v(e("input",{type:"checkbox","onUpdate:modelValue":y=>n.selected=y,class:"checkbox"},null,8,$e),[[ss,n.selected]])]),e("td",null,[e("strong",null,"#"+i(n.id),1)]),e("td",null,[e("div",sl,[e("div",{class:"employee-avatar",style:es({background:a.getAvatarColor(n.name)})},i(a.getInitials(n.name)),5),e("div",el,[e("div",ll,i(n.name),1),e("div",tl,i(n.email||"â€”"),1)])])]),e("td",null,[e("span",al,i(n.position),1)]),e("td",ol,i(a.formatCurrency(n.base_salary)),1),e("td",nl,i(a.formatCurrency(n.gross_salary)),1),e("td",rl,i(a.formatCurrency(n.net_pay)),1),e("td",null,[n.payroll_status?(c(),p("span",{key:0,class:h(["status",n.payroll_status.toLowerCase()])},[s[49]||(s[49]=e("span",{class:"status-dot"},null,-1)),P(" "+i(n.payroll_status.charAt(0).toUpperCase()+n.payroll_status.slice(1)),1)],2)):(c(),p("span",il,[...s[50]||(s[50]=[e("span",{class:"status-dot"},null,-1),P(" Not Set ",-1)])]))]),e("td",null,i(a.formatDate(n.payPeriod)),1),e("td",null,[e("div",dl,[e("button",{onClick:y=>a.viewDetails(n.id),class:"action-btn view",title:"View Details"}," ðŸ‘ï¸ ",8,cl),n.payroll_status?(c(),p("button",{key:0,onClick:y=>a.toggleStatus(n.id),class:h(["action-btn",n.payroll_status.toLowerCase()]),title:n.payroll_status==="pending"?"Mark as Paid":"Mark as Pending"},i(n.payroll_status==="pending"?"âœ“":"â†»"),11,pl)):(c(),p("button",{key:1,onClick:y=>a.setInitialStatus(n.id),class:"action-btn unknown",title:"Set Status"}," âš™ï¸ ",8,ul)),e("button",{onClick:y=>a.deleteEmployee(n.id),class:"action-btn delete",title:"Delete Employee"}," ðŸ—‘ï¸ ",8,yl)])])],2))),128))])]),a.selectedCount>0?(c(),p("div",ml,[e("span",gl,i(a.selectedCount)+" employee(s) selected",1),e("button",{onClick:s[17]||(s[17]=(...n)=>a.bulkMarkPaid&&a.bulkMarkPaid(...n)),class:"bulk-btn paid"},"Mark Selected as Paid"),e("button",{onClick:s[18]||(s[18]=(...n)=>a.bulkMarkPending&&a.bulkMarkPending(...n)),class:"bulk-btn pending"},"Mark Selected as Pending"),e("button",{onClick:s[19]||(s[19]=(...n)=>a.clearSelection&&a.clearSelection(...n)),class:"bulk-btn clear"},"Clear Selection")])):u("",!0)]))]),b(d,{visible:t.showModal,"employee-id":t.selectedEmployeeId,"payroll-period":t.payrollPeriod,onClose:s[20]||(s[20]=n=>t.showModal=!1)},null,8,["visible","employee-id","payroll-period"])])}const vl=Z(ve,[["render",hl],["__scopeId","data-v-adb731f9"]]);export{vl as default};
