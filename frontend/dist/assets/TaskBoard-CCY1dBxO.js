import{r as b,g as F,c as I,b as r,f as d,C as $,p as e,z as L,t as v,v as R,F as j,D as O,q as se,x as U,y as N,H as A,I as W,G,o as Q,J as X,A as z,a as K}from"./vendor-CFHPe_rb.js";import{_ as H,u as ae}from"./index-BxkOZnhC.js";function oe(){const t=b([]),E=b([]),i=b(!1),h=b(null);return{tasks:t,employees:E,loading:i,error:h,fetchTasks:async()=>{var g,y;i.value=!0,h.value=null;try{const c=await F.get("/api/tasks");return t.value=c.data.tasks,c.data}catch(c){throw h.value=((y=(g=c.response)==null?void 0:g.data)==null?void 0:y.message)||"Failed to fetch tasks",c}finally{i.value=!1}},createTask:async g=>{var y,c;i.value=!0,h.value=null;try{const p=await F.post("/api/tasks",g);return t.value.push(p.data.task),p.data}catch(p){throw h.value=((c=(y=p.response)==null?void 0:y.data)==null?void 0:c.message)||"Failed to create task",p}finally{i.value=!1}},updateTask:async(g,y)=>{var c,p;i.value=!0,h.value=null;try{const l=await F.put(`/api/tasks/${g}`,y),a=t.value.findIndex(o=>o.id===g);return a!==-1&&(t.value[a]=l.data.task),l.data}catch(l){throw h.value=((p=(c=l.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to update task",l}finally{i.value=!1}},updateTaskStatus:async(g,y)=>{var c,p;try{const l=await F.patch(`/api/tasks/${g}/status`,{status:y}),a=t.value.findIndex(o=>o.id===g);return a!==-1&&(t.value[a]=l.data.task),l.data}catch(l){throw h.value=((p=(c=l.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to update status",l}},deleteTask:async g=>{var y,c;i.value=!0,h.value=null;try{await F.delete(`/api/tasks/${g}`),t.value=t.value.filter(p=>p.id!==g)}catch(p){throw h.value=((c=(y=p.response)==null?void 0:y.data)==null?void 0:c.message)||"Failed to delete task",p}finally{i.value=!1}},fetchEmployees:async()=>{var g,y;try{const c=await F.get("/api/employees");return E.value=c.data.employees,c.data}catch(c){throw h.value=((y=(g=c.response)==null?void 0:g.data)==null?void 0:y.message)||"Failed to fetch employees",c}},addComment:async(g,y)=>{var c,p;try{const l=await F.post(`/api/tasks/${g}/comments`,{comment:y}),a=t.value.find(o=>o.id===g);return a&&(a.comments=a.comments||[],a.comments.unshift(l.data.comment)),l.data}catch(l){throw h.value=((p=(c=l.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to add comment",l}},deleteComment:async(g,y)=>{var c,p;try{await F.delete(`/api/comments/${g}`);const l=t.value.find(a=>a.id===y);l&&l.comments&&(l.comments=l.comments.filter(a=>a.id!==g))}catch(l){throw h.value=((p=(c=l.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to delete comment",l}}}}const ne=["aria-label"],le={key:0,class:"loading-overlay"},ie={class:"card-header"},de={class:"status-indicators"},re={key:0,class:"overdue-badge"},ue=["disabled"],ce=["disabled"],me={class:"task-title"},ve=["title"],ke={key:2,class:"task-tags"},fe={key:0,class:"tag-more"},ye={class:"card-footer"},pe={class:"assigned-to"},ge={class:"avatar"},he={class:"name"},$e={class:"footer-right"},be=["disabled"],we={key:0,class:"comment-count"},_e={key:3,class:"comments-section"},Te={class:"add-comment-form"},Ce=["disabled"],De=["disabled"],Se={key:0},Ee={key:1},xe={key:0,class:"comments-list"},Fe={class:"flex items-start space-x-3"},Ue={class:"flex-shrink-0"},Ve={class:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-medium text-sm"},Ae={class:"flex-1 min-w-0"},Me={class:"flex items-center justify-between mb-1"},Pe={class:"text-sm font-medium text-gray-900"},Ie={class:"text-xs text-gray-500"},Re={class:"text-sm text-gray-700 mb-2"},Ne={key:0,class:"flex justify-end"},Le=["onClick","disabled"],Be={key:0},je={key:1},Oe={key:1,class:"no-comments"},He={key:4,class:"comment-indicator"},qe={__name:"TaskCard",props:{task:{type:Object,required:!0,validator:t=>t&&t.title&&t.priority&&t.assigned_to},userRole:{type:String,required:!0,validator:t=>["manager","employee"].includes(t)},loading:{type:Boolean,default:!1}},emits:["update-status","edit","delete","view"],setup(t,{emit:E}){const i=t,h=ae(),u=b(!1),k=b(""),m=b(!1),w=b(null),D=I(()=>`priority-border-${i.task.priority}`),S=I(()=>i.task.deadline?new Date(i.task.deadline)<new Date&&i.task.status!=="completed":!1),V=I(()=>{const o=`Task: ${i.task.title}. Priority: ${i.task.priority}.`,n=`Assigned to: ${i.task.assigned_to.name}.`,s=i.task.deadline?`Due: ${l(i.task.deadline)}.`:"No deadline.",C=S.value?"This task is overdue.":"",f=i.task.comments&&i.task.comments.length>0?`Has ${i.task.comments.length} comments.`:"";return`${o} ${n} ${s} ${C} ${f}`}),x=o=>{if(i.loading||u.value){o.preventDefault();return}o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("taskId",i.task.id.toString())},g=()=>{u.value=!u.value},y=async()=>{if(k.value.trim()){m.value=!0;try{const o=await F.post(`/api/tasks/${i.task.id}/comments`,{comment:k.value});i.task.comments.unshift(o.data.comment),k.value=""}catch(o){console.error("Failed to add comment:",o),alert("Failed to add comment. Please try again.")}finally{m.value=!1}}},c=async o=>{if(confirm("Are you sure you want to delete this comment?")){w.value=o.id;try{await F.delete(`/api/comments/${o.id}`),i.task.comments=i.task.comments.filter(n=>n.id!==o.id)}catch(n){console.error("Failed to delete comment:",n),alert("Failed to delete comment. Please try again.")}finally{w.value=null}}},p=o=>o?o.split(" ").map(n=>n[0]).join("").toUpperCase().substring(0,2):"??",l=o=>{if(!o)return"No date";const n=new Date(o),s=new Date,C=new Date(s);return C.setDate(C.getDate()+1),s.setHours(0,0,0,0),C.setHours(0,0,0,0),n.setHours(0,0,0,0),n.getTime()===s.getTime()?"Today":n.getTime()===C.getTime()?"Tomorrow":n.toLocaleDateString("en-US",{month:"short",day:"numeric"})},a=(o,n)=>o?o.length<=n?o:o.substring(0,n)+"...":"";return(o,n)=>(d(),r("div",{class:L(["task-card",[D.value,{loading:t.loading,expanded:u.value}]]),draggable:"true",onDragstart:x,onClick:n[4]||(n[4]=s=>!t.loading&&!u.value&&o.$emit("view")),role:"button",tabindex:"0",onKeydown:[n[5]||(n[5]=W(s=>!t.loading&&!u.value&&o.$emit("view"),["enter"])),n[6]||(n[6]=W(s=>!t.loading&&!u.value&&o.$emit("view"),["space"]))],"aria-label":V.value},[t.loading?(d(),r("div",le,[...n[7]||(n[7]=[e("div",{class:"loading-spinner"},null,-1)])])):$("",!0),e("div",ie,[e("div",de,[e("span",{class:L(["priority-badge",`priority-${t.task.priority}`])},v(t.task.priority),3),S.value?(d(),r("span",re,"OVERDUE")):$("",!0)]),e("div",{class:"card-actions",onClick:n[2]||(n[2]=R(()=>{},["stop"]))},[t.userRole==="manager"?(d(),r("button",{key:0,onClick:n[0]||(n[0]=s=>!t.loading&&o.$emit("edit")),class:"action-btn",title:"Edit task",disabled:t.loading}," âœï¸ ",8,ue)):$("",!0),t.userRole==="manager"?(d(),r("button",{key:1,onClick:n[1]||(n[1]=s=>!t.loading&&o.$emit("delete")),class:"action-btn",title:"Delete task",disabled:t.loading}," ðŸ—‘ï¸ ",8,ce)):$("",!0)])]),e("h4",me,v(t.task.title),1),t.task.description?(d(),r("p",{key:1,class:"task-description",title:t.task.description.length>100?t.task.description:""},v(a(t.task.description,100)),9,ve)):$("",!0),t.task.tags&&t.task.tags.length?(d(),r("div",ke,[(d(!0),r(j,null,O(t.task.tags.slice(0,2),s=>(d(),r("span",{key:s,class:"tag"},v(s),1))),128)),t.task.tags.length>2?(d(),r("span",fe," +"+v(t.task.tags.length-2),1)):$("",!0)])):$("",!0),e("div",ye,[e("div",pe,[e("span",ge,v(p(t.task.assigned_to.name)),1),e("span",he,v(t.task.assigned_to.name),1)]),e("div",$e,[t.task.deadline?(d(),r("div",{key:0,class:L(["deadline",{overdue:S.value}])}," ðŸ“… "+v(l(t.task.deadline)),3)):$("",!0),e("button",{onClick:R(g,["stop"]),class:"comment-btn",disabled:t.loading},[se(" ðŸ’¬ "+v(u.value?"Hide Comments":"Add/View Comment")+" ",1),!u.value&&t.task.comments&&t.task.comments.length>0?(d(),r("span",we,"("+v(t.task.comments.length)+")",1)):$("",!0)],8,be)])]),u.value?(d(),r("div",_e,[e("div",Te,[e("form",{onSubmit:R(y,["prevent"])},[U(e("textarea",{"onUpdate:modelValue":n[3]||(n[3]=s=>k.value=s),rows:"2",placeholder:"Add a comment...",class:"comment-textarea",disabled:m.value,required:""},null,8,Ce),[[N,k.value]]),e("button",{type:"submit",disabled:m.value||!k.value.trim(),class:"add-comment-btn"},[m.value?(d(),r("span",Se,"Adding...")):(d(),r("span",Ee,"Add Comment"))],8,De)],32)]),t.task.comments&&t.task.comments.length>0?(d(),r("div",xe,[(d(!0),r(j,null,O(t.task.comments,s=>{var C,f,M;return d(),r("div",{key:s.id,class:"comment-item"},[e("div",Fe,[e("div",Ue,[e("div",Ve,v(p((C=s.user)==null?void 0:C.name)),1)]),e("div",Ae,[e("div",Me,[e("h5",Pe,v((f=s.user)==null?void 0:f.name),1),e("span",Ie,v(l(s.created_at)),1)]),e("p",Re,v(s.comment),1),s.user_id===((M=A(h).user)==null?void 0:M.id)?(d(),r("div",Ne,[e("button",{onClick:B=>c(s),class:"text-xs text-red-600 hover:text-red-800 font-medium",disabled:w.value===s.id},[w.value===s.id?(d(),r("span",Be,"Deleting...")):(d(),r("span",je,"Delete"))],8,Le)])):$("",!0)])])])}),128))])):u.value?(d(),r("div",Oe,[...n[8]||(n[8]=[e("p",{class:"text-gray-500 text-sm text-center py-4"},"No comments yet. Add one above!",-1)])])):$("",!0)])):$("",!0),t.task.comments&&t.task.comments.length>0?(d(),r("div",He," ðŸ’¬ "+v(t.task.comments.length),1)):$("",!0)],42,ne))}},Ke=H(qe,[["__scopeId","data-v-6f854908"]]),Ye={class:"task-column"},ze={class:"column-header"},Ge={class:"task-count"},Je={key:0,class:"empty-column"},We={__name:"TaskColumn",props:{title:String,status:String,tasks:Array,userRole:String},emits:["update-status","edit-task","delete-task","view-task"],setup(t,{emit:E}){const i=t,h=E,u=k=>{k.preventDefault();const m=k.dataTransfer.getData("taskId");m&&h("update-status",parseInt(m),i.status)};return(k,m)=>(d(),r("div",Ye,[e("div",ze,[e("h3",null,v(t.title),1),e("span",Ge,v(t.tasks.length),1)]),e("div",{class:"column-content",onDragover:m[0]||(m[0]=R(()=>{},["prevent"])),onDrop:u},[(d(!0),r(j,null,O(t.tasks,w=>(d(),G(Ke,{key:w.id,task:w,"user-role":t.userRole,onUpdateStatus:D=>k.$emit("update-status",w.id,D),onEdit:D=>k.$emit("edit-task",w),onDelete:D=>k.$emit("delete-task",w.id),onView:D=>k.$emit("view-task",w)},null,8,["task","user-role","onUpdateStatus","onEdit","onDelete","onView"]))),128)),t.tasks.length===0?(d(),r("div",Je," No tasks ")):$("",!0)],32)]))}},Y=H(We,[["__scopeId","data-v-1b31f94f"]]),Qe={class:"modal-content"},Xe={class:"modal-header"},Ze={class:"form-group"},et=["disabled"],tt={class:"form-group"},st=["disabled"],at={class:"form-row"},ot={class:"form-group"},nt=["disabled"],lt={class:"form-group"},it=["disabled"],dt=["value"],rt={key:0,class:"loading-text"},ut={key:1,class:"error-text"},ct={key:2,class:"error-text"},mt={class:"form-group"},vt=["disabled"],kt={class:"modal-footer"},ft=["disabled"],yt=["disabled"],pt={key:0},gt={key:1},ht={__name:"TaskModal",props:{task:Object,employees:{type:Array,default:()=>[]},loadingEmployees:{type:Boolean,default:!1}},emits:["close","save"],setup(t,{emit:E}){const i=t,h=E,u=b({title:"",description:"",priority:"moderate",assigned_to:"",deadline:""}),k=b(!1),m=b(""),w=b([]),D=b(!1),S=I(()=>{const a=(i.employees&&i.employees.length>0?i.employees:w.value).filter(o=>o.user_id);return console.log("Valid employees with user_id:",a),a}),V=I(()=>i.loadingEmployees||D.value),x=V;Q(()=>{var l,a;i.task&&(u.value={title:i.task.title,description:i.task.description||"",priority:i.task.priority,assigned_to:((l=i.task.assigned_to)==null?void 0:l.id)||((a=i.task.assigned_to)==null?void 0:a.user_id)||"",deadline:i.task.deadline?y(i.task.deadline):""}),g()}),X(()=>i.employees,l=>{l&&l.length>0&&(console.log("Received employees from props:",l),w.value=l.map(a=>({...a,user_id:a.user_id||a.id})))},{immediate:!0});const g=async()=>{var l,a;D.value=!0,m.value="";try{const n=(await F.get("/api/tasks/employees/simple")).data.employees||[];console.log("Fetched employees from simple endpoint:",n),w.value=n.map(s=>({id:s.id,user_id:s.id,name:s.full_name||`${s.first_name} ${s.last_name}`,first_name:s.first_name,last_name:s.last_name,email:s.email,position:s.position,department:s.department,employee_id:s.employee_id})),console.log("Transformed employees:",w.value),w.value.length===0&&(m.value="No team members available for task assignment.")}catch(o){console.error("Failed to fetch employees:",o),m.value="Failed to load team members. Please try again.",((l=o.response)==null?void 0:l.status)===401?m.value="Your session has expired. Please log in again.":((a=o.response)==null?void 0:a.status)===403?m.value="You do not have permission to access team members.":o.code==="ERR_NETWORK"&&(m.value="Network error. Please check your connection.")}finally{D.value=!1}},y=l=>{if(!l)return"";const a=new Date(l),o=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${o}-${n}-${s}`},c=l=>l.name?l.name:l.first_name&&l.last_name?`${l.first_name} ${l.last_name}`:l.email?l.email:"Unknown Employee",p=async()=>{if(V.value){alert("Please wait while team members are loading...");return}if(!u.value.assigned_to){alert("Please select a team member to assign this task to.");return}if(!u.value.title.trim()){alert("Please enter a task title.");return}const l=S.value.find(a=>a.user_id===u.value.assigned_to);if(!l){alert("Invalid employee selection. Please select again.");return}k.value=!0;try{const a={title:u.value.title.trim(),description:u.value.description.trim(),priority:u.value.priority,assigned_to:u.value.assigned_to,...u.value.deadline&&{deadline:new Date(u.value.deadline).toISOString()}};console.log("Submitting task data:",a),console.log("Selected employee:",l),h("save",a)}catch(a){console.error("Error preparing task data:",a),alert("Error preparing task data. Please try again.")}finally{k.value=!1}};return(l,a)=>(d(),r("div",{class:"modal-overlay",onClick:a[7]||(a[7]=R(o=>l.$emit("close"),["self"]))},[e("div",Qe,[e("div",Xe,[e("h2",null,v(t.task?"Edit Task":"Create New Task"),1),e("button",{onClick:a[0]||(a[0]=o=>l.$emit("close")),class:"close-btn"},"Ã—")]),e("form",{onSubmit:R(p,["prevent"]),class:"modal-body"},[e("div",Ze,[a[8]||(a[8]=e("label",{for:"title"},"Title *",-1)),U(e("input",{id:"title","onUpdate:modelValue":a[1]||(a[1]=o=>u.value.title=o),type:"text",required:"",placeholder:"Enter task title",class:"form-control",disabled:k.value},null,8,et),[[N,u.value.title]])]),e("div",tt,[a[9]||(a[9]=e("label",{for:"description"},"Description",-1)),U(e("textarea",{id:"description","onUpdate:modelValue":a[2]||(a[2]=o=>u.value.description=o),rows:"4",placeholder:"Enter task description",class:"form-control",disabled:k.value},null,8,st),[[N,u.value.description]])]),e("div",at,[e("div",ot,[a[11]||(a[11]=e("label",{for:"priority"},"Priority *",-1)),U(e("select",{id:"priority","onUpdate:modelValue":a[3]||(a[3]=o=>u.value.priority=o),required:"",class:"form-control",disabled:k.value},[...a[10]||(a[10]=[e("option",{value:"low"},"Low",-1),e("option",{value:"moderate"},"Moderate",-1),e("option",{value:"high"},"High",-1),e("option",{value:"critical"},"Critical",-1)])],8,nt),[[z,u.value.priority]])]),e("div",lt,[a[13]||(a[13]=e("label",{for:"assigned_to"},"Assign To *",-1)),U(e("select",{id:"assigned_to","onUpdate:modelValue":a[4]||(a[4]=o=>u.value.assigned_to=o),required:"",class:"form-control",disabled:k.value||A(x)},[a[12]||(a[12]=e("option",{value:""},"Select employee",-1)),(d(!0),r(j,null,O(S.value,o=>(d(),r("option",{key:o.user_id||o.id,value:o.user_id},v(c(o))+" - "+v(o.position)+" ("+v(o.department)+") ",9,dt))),128))],8,it),[[z,u.value.assigned_to]]),A(x)?(d(),r("div",rt," Loading team members... ")):$("",!0),m.value?(d(),r("div",ut,v(m.value),1)):$("",!0),!A(x)&&S.value.length===0?(d(),r("div",ct," No team members available for assignment. ")):$("",!0)])]),e("div",mt,[a[14]||(a[14]=e("label",{for:"deadline"},"Deadline",-1)),U(e("input",{id:"deadline","onUpdate:modelValue":a[5]||(a[5]=o=>u.value.deadline=o),type:"date",class:"form-control",disabled:k.value},null,8,vt),[[N,u.value.deadline]])]),e("div",kt,[e("button",{type:"button",onClick:a[6]||(a[6]=o=>l.$emit("close")),class:"btn-secondary",disabled:k.value}," Cancel ",8,ft),e("button",{type:"submit",class:"btn-primary",disabled:k.value||A(x)},[k.value?(d(),r("span",pt,"Processing...")):(d(),r("span",gt,v(t.task?"Update":"Create")+" Task",1))],8,yt)])],32)])]))}},$t=H(ht,[["__scopeId","data-v-b08f79eb"]]),bt={class:"modal-content"},wt={class:"modal-header"},_t={class:"header-actions"},Tt={class:"modal-body"},Ct={class:"task-details"},Dt={key:0,class:"edit-form"},St={class:"form-group"},Et={class:"form-group"},xt={class:"form-group"},Ft={class:"form-group"},Ut={class:"form-actions"},Vt=["disabled"],At={key:1,class:"view-details"},Mt={class:"detail-row"},Pt={class:"detail-row"},It={class:"user-info"},Rt={class:"avatar"},Nt={class:"detail-row"},Lt={key:0,class:"detail-row"},Bt={key:1,class:"detail-row description"},jt={class:"comments-section"},Ot={class:"comment-form"},Ht=["disabled"],qt={class:"comments-list"},Kt={class:"comment-header"},Yt={class:"user-info"},zt={class:"avatar small"},Gt={class:"name"},Jt={class:"date"},Wt=["onClick"],Qt={class:"comment-text"},Xt={key:0,class:"no-comments"},Zt={__name:"TaskDetailModal",props:{task:Object,userRole:String},emits:["close","add-comment","delete-comment","update-task"],setup(t,{emit:E}){const i=t,h=E,u=b(""),k=b(!1),m=b({}),w=I(()=>i.userRole==="manager");X(()=>i.task,n=>{n&&(m.value={priority:n.priority,status:n.status,deadline:n.deadline?n.deadline.split("T")[0]:"",description:n.description||""})},{immediate:!0});const D=I(()=>m.value.priority&&m.value.status),S=I(()=>i.task.deadline?new Date(i.task.deadline)<new Date&&i.task.status!=="completed":!1),V=()=>{k.value=!k.value,k.value||(m.value={})},x=()=>{k.value=!1,m.value={}},g=async()=>{if(D.value){const n={...m.value};n.deadline&&(n.deadline=new Date(n.deadline).toISOString()),h("update-task",i.task.id,n),k.value=!1}},y=()=>{u.value.trim()&&(h("add-comment",i.task.id,u.value),u.value="")},c=n=>{confirm("Are you sure you want to delete this comment?")&&h("delete-comment",n,i.task.id)},p=n=>n.split(" ").map(s=>s[0]).join("").toUpperCase().substring(0,2),l=n=>n.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase()),a=n=>new Date(n).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),o=n=>{const s=new Date,C=new Date(n),f=Math.floor((s-C)/1e3);return f<60?"just now":f<3600?`${Math.floor(f/60)}m ago`:f<86400?`${Math.floor(f/3600)}h ago`:f<604800?`${Math.floor(f/86400)}d ago`:C.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return(n,s)=>{var C;return d(),r("div",{class:"modal-overlay",onClick:s[6]||(s[6]=R(f=>n.$emit("close"),["self"]))},[e("div",bt,[e("div",wt,[e("div",null,[e("h2",null,v(t.task.title),1),e("span",{class:L(["priority-badge",`priority-${t.task.priority}`])},v(t.task.priority),3)]),e("div",_t,[w.value&&!k.value?(d(),r("button",{key:0,onClick:V,class:"edit-btn",title:"Edit task"}," âœï¸ Edit ")):$("",!0),e("button",{onClick:s[0]||(s[0]=f=>n.$emit("close")),class:"close-btn"},"Ã—")])]),e("div",Tt,[e("div",Ct,[k.value?(d(),r("div",Dt,[e("div",St,[s[8]||(s[8]=e("label",{for:"priority"},"Priority:",-1)),U(e("select",{"onUpdate:modelValue":s[1]||(s[1]=f=>m.value.priority=f),id:"priority",class:"form-control"},[...s[7]||(s[7]=[e("option",{value:"low"},"Low",-1),e("option",{value:"moderate"},"Moderate",-1),e("option",{value:"high"},"High",-1),e("option",{value:"critical"},"Critical",-1)])],512),[[z,m.value.priority]])]),e("div",Et,[s[10]||(s[10]=e("label",{for:"status"},"Status:",-1)),U(e("select",{"onUpdate:modelValue":s[2]||(s[2]=f=>m.value.status=f),id:"status",class:"form-control"},[...s[9]||(s[9]=[e("option",{value:"todo"},"To Do",-1),e("option",{value:"in_progress"},"In Progress",-1),e("option",{value:"under_review"},"Under Review",-1),e("option",{value:"completed"},"Completed",-1)])],512),[[z,m.value.status]])]),e("div",xt,[s[11]||(s[11]=e("label",{for:"deadline"},"Deadline:",-1)),U(e("input",{"onUpdate:modelValue":s[3]||(s[3]=f=>m.value.deadline=f),type:"date",id:"deadline",class:"form-control"},null,512),[[N,m.value.deadline]])]),e("div",Ft,[s[12]||(s[12]=e("label",{for:"description"},"Description:",-1)),U(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=f=>m.value.description=f),id:"description",rows:"4",class:"form-control",placeholder:"Enter description..."},null,512),[[N,m.value.description]])]),e("div",Ut,[e("button",{onClick:x,class:"btn-secondary"},"Cancel"),e("button",{onClick:g,disabled:!D.value,class:"btn-primary"}," Save Changes ",8,Vt)])])):(d(),r("div",At,[e("div",Mt,[s[13]||(s[13]=e("span",{class:"label"},"Status:",-1)),e("span",{class:L(["status-badge",`status-${t.task.status}`])},v(l(t.task.status)),3)]),e("div",Pt,[s[14]||(s[14]=e("span",{class:"label"},"Assigned To:",-1)),e("div",It,[e("span",Rt,v(p(t.task.assigned_to.name)),1),e("span",null,v(t.task.assigned_to.name),1)])]),e("div",Nt,[s[15]||(s[15]=e("span",{class:"label"},"Created By:",-1)),e("span",null,v(t.task.created_by.name),1)]),t.task.deadline?(d(),r("div",Lt,[s[16]||(s[16]=e("span",{class:"label"},"Deadline:",-1)),e("span",{class:L({overdue:S.value})},v(a(t.task.deadline)),3)])):$("",!0),t.task.description?(d(),r("div",Bt,[s[17]||(s[17]=e("span",{class:"label"},"Description:",-1)),e("p",null,v(t.task.description),1)])):$("",!0)]))]),e("div",jt,[e("h3",null,"Comments ("+v(((C=t.task.comments)==null?void 0:C.length)||0)+")",1),e("div",Ot,[U(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=f=>u.value=f),placeholder:"Add a comment...",rows:"3",class:"form-control"},null,512),[[N,u.value]]),e("button",{onClick:y,disabled:!u.value.trim(),class:"btn-primary"}," Add Comment ",8,Ht)]),e("div",qt,[(d(!0),r(j,null,O(t.task.comments,f=>(d(),r("div",{key:f.id,class:"comment-item"},[e("div",Kt,[e("div",Yt,[e("span",zt,v(p(f.user.name)),1),e("span",Gt,v(f.user.name),1),e("span",Jt,v(o(f.created_at)),1)]),(d(),r("button",{key:0,onClick:M=>c(f.id),class:"delete-comment-btn",title:"Delete comment"}," ðŸ—‘ï¸ ",8,Wt))]),e("p",Qt,v(f.comment),1)]))),128)),!t.task.comments||t.task.comments.length===0?(d(),r("div",Xt," No comments yet. Be the first to comment! ")):$("",!0)])])])])])}}},es=H(Zt,[["__scopeId","data-v-2339ec84"]]),ts={class:"task-board"},ss={class:"board-header"},as={key:0,class:"loading"},os={key:1,class:"error"},ns={key:2,class:"board-columns"},ls={__name:"TaskBoard",setup(t){const{tasks:E,employees:i,loading:h,error:u,fetchTasks:k,createTask:m,updateTask:w,updateTaskStatus:D,deleteTask:S,fetchEmployees:V,addComment:x,deleteComment:g}=oe(),y=b(""),c=b(!1),p=b(!1),l=b(!1),a=b(null),o=b(null),n=b(!1);Q(async()=>{const _=await k();y.value=_.user_role});const s=_=>E.value.filter(T=>T.status===_),C=async()=>{if(y.value==="manager"){n.value=!0;try{await V(),c.value=!0}catch(_){console.error("Failed to fetch employees:",_),alert("Failed to load team members. Please try again.")}finally{n.value=!1}}else c.value=!0},f=async(_,T)=>{try{await D(_,T)}catch(P){console.error("Failed to update status:",P)}},M=async _=>{if(y.value==="manager"){n.value=!0;try{await V(),a.value={..._},p.value=!0}catch(T){console.error("Failed to fetch employees:",T),alert("Failed to load team members. Please try again.")}finally{n.value=!1}}else a.value={..._},p.value=!0},B=async _=>{if(confirm("Are you sure you want to delete this task?"))try{await S(_)}catch(T){console.error("Failed to delete task:",T)}},q=_=>{o.value=_,l.value=!0},Z=async _=>{var T;try{(T=a.value)!=null&&T.id?await w(a.value.id,_):await m(_),J()}catch(P){console.error("Failed to save task:",P)}},J=()=>{c.value=!1,p.value=!1,a.value=null},ee=async(_,T)=>{try{await x(_,T)}catch(P){console.error("Failed to add comment:",P)}},te=async(_,T)=>{try{await g(_,T)}catch(P){console.error("Failed to delete comment:",P)}};return(_,T)=>(d(),r("div",ts,[e("div",ss,[T[1]||(T[1]=e("h1",null,"Task Board",-1)),y.value==="manager"?(d(),r("button",{key:0,onClick:C,class:"btn-primary"}," + Create Task ")):$("",!0)]),A(h)?(d(),r("div",as,"Loading tasks...")):A(u)?(d(),r("div",os,v(A(u)),1)):(d(),r("div",ns,[K(Y,{title:"To Do",status:"todo",tasks:s("todo"),"user-role":y.value,onUpdateStatus:f,onEditTask:M,onDeleteTask:B,onViewTask:q},null,8,["tasks","user-role"]),K(Y,{title:"In Progress",status:"in_progress",tasks:s("in_progress"),"user-role":y.value,onUpdateStatus:f,onEditTask:M,onDeleteTask:B,onViewTask:q},null,8,["tasks","user-role"]),K(Y,{title:"Under Review",status:"under_review",tasks:s("under_review"),"user-role":y.value,onUpdateStatus:f,onEditTask:M,onDeleteTask:B,onViewTask:q},null,8,["tasks","user-role"]),K(Y,{title:"Completed",status:"completed",tasks:s("completed"),"user-role":y.value,onUpdateStatus:f,onEditTask:M,onDeleteTask:B,onViewTask:q},null,8,["tasks","user-role"])])),c.value||p.value?(d(),G($t,{key:3,task:a.value,employees:A(i),"loading-employees":n.value,onClose:J,onSave:Z},null,8,["task","employees","loading-employees"])):$("",!0),l.value?(d(),G(es,{key:4,task:o.value,"user-role":y.value,onClose:T[0]||(T[0]=P=>l.value=!1),onAddComment:ee,onDeleteComment:te},null,8,["task","user-role"])):$("",!0)]))}},rs=H(ls,[["__scopeId","data-v-89f67aae"]]);export{rs as T};
