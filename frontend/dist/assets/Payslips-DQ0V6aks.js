import{_,u as D}from"./index-BxkOZnhC.js";import{b as a,p as s,C as m,t as i,x as f,A as v,F as h,D as P,q as p,v as C,z as y,g,f as r}from"./vendor-CFHPe_rb.js";const k={name:"EmployeePayslips",setup(){return{authStore:D()}},data(){return{pageName:"My Payslips",payslips:[],filterYear:new Date().getFullYear(),filterMonth:"",filterStatus:"",availableYears:[],months:[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}],loading:!1,downloading:{},error:null,selectedPayslip:null,toast:{show:!1,message:"",type:"success"}}},computed:{totalEarnings(){return this.payslips.reduce((o,e)=>o+(e.netPay||0),0)},latestPayslipPeriod(){return this.payslips.length===0?"N/A":this.payslips[0].period||"N/A"}},mounted(){this.fetchPayslips()},methods:{async fetchPayslips(){this.loading=!0,this.error=null;try{const o={year:this.filterYear,...this.filterMonth&&{month:this.filterMonth},...this.filterStatus&&{status:this.filterStatus}},e=await g.get("/api/employee/payslips",{params:o});if(this.payslips=e.data.data||e.data||[],this.payslips.length>0){const u=[...new Set(this.payslips.map(d=>{const l=d.pay_period_start||d.period_start||d.created_at;return new Date(l).getFullYear()}))].sort((d,l)=>l-d);this.availableYears=u}else this.availableYears=[new Date().getFullYear()]}catch(o){console.error("Payslips fetch error:",o),this.handleApiError(o)}finally{this.loading=!1}},async downloadPayslip(o){var e,u,d;this.$set(this.downloading,o.id,!0);try{const l=await g.get(`/api/employee/payslips/${o.id}/download`,{responseType:"blob",headers:{Accept:"application/pdf"}});if(l.data.type==="application/pdf"){const n=window.URL.createObjectURL(new Blob([l.data],{type:"application/pdf"})),t=document.createElement("a");t.href=n,t.setAttribute("download",`payslip-${((e=o.period)==null?void 0:e.replace(/ /g,"-"))||o.id}.pdf`),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(n),this.showToast("Payslip downloaded successfully!","success")}else throw new Error("Invalid file type received")}catch(l){console.error("Download error:",l),((u=l.response)==null?void 0:u.status)===404?this.showToast("Payslip PDF not found. Please contact HR.","error"):((d=l.response)==null?void 0:d.status)===403?this.showToast("You do not have permission to download this payslip.","error"):this.showToast("Failed to download payslip. Please try again.","error"),this.handleApiError(l)}finally{this.$set(this.downloading,o.id,!1)}},async viewPayslip(o){try{const e=await g.get(`/api/employee/payslips/${o.id}`);this.selectedPayslip=e.data.data||e.data}catch(e){console.error("Error fetching payslip details:",e),this.showToast("Failed to load payslip details.","error"),this.selectedPayslip=o}},resetFilters(){this.filterYear=new Date().getFullYear(),this.filterMonth="",this.filterStatus="",this.fetchPayslips()},showToast(o,e="success"){this.toast={show:!0,message:o,type:e},setTimeout(()=>{this.toast.show=!1},3e3)},handleApiError(o){var u,d,l,n,t,c,w,b;let e="An unexpected error occurred.";o.code==="ERR_NETWORK"||o.message.includes("Network Error")?e="Network error. Please check your connection.":((u=o.response)==null?void 0:u.status)===401?(e="Session expired. Redirecting to login...",this.authStore.clearAuth(),this.$router.push({name:"login"})):((d=o.response)==null?void 0:d.status)===403?e="Access denied.":((l=o.response)==null?void 0:l.status)===404?e="Payslip not found. Please contact HR.":((n=o.response)==null?void 0:n.status)===500?e="Server error. Please try again later.":e=((c=(t=o.response)==null?void 0:t.data)==null?void 0:c.message)||((b=(w=o.response)==null?void 0:w.data)==null?void 0:b.error)||e,this.error=e},formatCurrency(o){return o==null?"ZMW 0.00":new Intl.NumberFormat("en-ZM",{style:"currency",currency:"ZMW",minimumFractionDigits:2}).format(o)},formatStatus(o){return{generated:"Generated",paid:"Paid",draft:"Draft",processing:"Processing"}[o]||o},formatDate(o){return o?new Date(o).toLocaleDateString("en-ZM",{year:"numeric",month:"short",day:"numeric"}):"N/A"}}},A={class:"payslips-view"},S={class:"header"},M={class:"header-left"},F={class:"title"},N={class:"filters"},E={class:"filter-group"},Y=["value"],T={class:"filter-group"},R=["value"],x={class:"filter-group"},L={class:"content"},Z={key:0,class:"summary-cards"},V={class:"card"},O={class:"value"},U={class:"card"},W={class:"value"},B={class:"card"},H={class:"value"},I={key:1,class:"loading"},G={key:2,class:"error-message"},J={key:3,class:"empty-state"},j={key:4,class:"table-container"},z={class:"payslips-table"},q={class:"deduction"},K={class:"net-pay"},Q={class:"action-buttons"},X=["onClick"],$=["onClick","disabled"],ss={key:0},es={key:1},ls={class:"modal-card"},ts={class:"modal-header"},ns={class:"modal-body"},os={class:"detail-section"},is={class:"detail-grid"},as={class:"detail-section"},rs={class:"amount-grid"},ds={class:"amount-row"},us={class:"amount-row"},ps={class:"amount-row"},cs={class:"amount-row"},ys={class:"amount-row"},ms={class:"amount-row total"},fs={class:"detail-section"},vs={class:"amount-grid"},hs={class:"amount-row"},Ps={class:"amount-row"},gs={class:"amount-row"},ws={class:"amount-row"},bs={class:"amount-row total deduction"},Cs={class:"net-pay-section"},_s={class:"net-pay-amount"},Ds={class:"modal-footer"},ks=["disabled"];function As(o,e,u,d,l,n){return r(),a("div",A,[s("header",S,[s("div",M,[s("h1",F,i(l.pageName),1),e[12]||(e[12]=s("p",{class:"subtitle"},"Castle Holding Zambia - Manage and download your payslips",-1))])]),s("div",N,[s("div",E,[e[13]||(e[13]=s("label",null,"Year:",-1)),f(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>l.filterYear=t),onChange:e[1]||(e[1]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t))},[(r(!0),a(h,null,P(l.availableYears,t=>(r(),a("option",{key:t,value:t},i(t),9,Y))),128))],544),[[v,l.filterYear]])]),s("div",T,[e[15]||(e[15]=s("label",null,"Month:",-1)),f(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.filterMonth=t),onChange:e[3]||(e[3]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t))},[e[14]||(e[14]=s("option",{value:""},"All Months",-1)),(r(!0),a(h,null,P(l.months,t=>(r(),a("option",{key:t.value,value:t.value},i(t.label),9,R))),128))],544),[[v,l.filterMonth]])]),s("div",x,[e[17]||(e[17]=s("label",null,"Status:",-1)),f(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.filterStatus=t),onChange:e[5]||(e[5]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t))},[...e[16]||(e[16]=[s("option",{value:""},"All",-1),s("option",{value:"generated"},"Generated",-1),s("option",{value:"paid"},"Paid",-1)])],544),[[v,l.filterStatus]])])]),s("div",L,[!l.loading&&l.payslips.length>0?(r(),a("div",Z,[s("div",V,[e[18]||(e[18]=s("div",{class:"card-icon"},[s("i",{class:"icon icon-file"})],-1)),e[19]||(e[19]=s("h3",null,"Total Payslips",-1)),s("p",O,i(l.payslips.length),1)]),s("div",U,[e[20]||(e[20]=s("div",{class:"card-icon"},[s("i",{class:"icon icon-money"})],-1)),e[21]||(e[21]=s("h3",null,"Total Earnings (ZMW)",-1)),s("p",W,i(n.formatCurrency(n.totalEarnings)),1)]),s("div",B,[e[22]||(e[22]=s("div",{class:"card-icon"},[s("i",{class:"icon icon-calendar"})],-1)),e[23]||(e[23]=s("h3",null,"Latest Payslip",-1)),s("p",H,i(n.latestPayslipPeriod),1)])])):m("",!0),l.loading?(r(),a("div",I,[...e[24]||(e[24]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading payslips...",-1)])])):l.error?(r(),a("div",G,[p(i(l.error)+" ",1),s("button",{onClick:e[6]||(e[6]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t)),class:"btn-primary"},"Retry")])):l.payslips.length===0?(r(),a("div",J,[e[25]||(e[25]=s("i",{class:"icon icon-empty"},null,-1)),e[26]||(e[26]=s("p",null,"No payslips found for the selected filters.",-1)),s("button",{onClick:e[7]||(e[7]=(...t)=>n.resetFilters&&n.resetFilters(...t)),class:"btn-primary"},"Reset Filters")])):(r(),a("div",j,[s("table",z,[e[30]||(e[30]=s("thead",null,[s("tr",null,[s("th",null,"Period"),s("th",null,"Gross Pay (ZMW)"),s("th",null,"Deductions (ZMW)"),s("th",null,"Net Pay (ZMW)"),s("th",null,"Status"),s("th",null,"Payment Date"),s("th",null,"Actions")])],-1)),s("tbody",null,[(r(!0),a(h,null,P(l.payslips,t=>(r(),a("tr",{key:t.id},[s("td",null,[s("strong",null,i(t.period),1)]),s("td",null,i(n.formatCurrency(t.grossPay)),1),s("td",q,i(n.formatCurrency(t.deductions)),1),s("td",K,[s("strong",null,i(n.formatCurrency(t.netPay)),1)]),s("td",null,[s("span",{class:y(["status-badge",t.status.toLowerCase()])},i(n.formatStatus(t.status)),3)]),s("td",null,i(n.formatDate(t.payment_date)),1),s("td",null,[s("div",Q,[s("button",{onClick:c=>n.viewPayslip(t),class:"action-btn view",title:"View Details"},[...e[27]||(e[27]=[s("i",{class:"icon icon-eye"},null,-1),p(" View ",-1)])],8,X),s("button",{onClick:C(c=>n.downloadPayslip(t),["prevent"]),class:y(["action-btn download",{downloading:l.downloading[t.id]}]),disabled:l.downloading[t.id],title:"Download PDF"},[l.downloading[t.id]?(r(),a("span",ss,[...e[28]||(e[28]=[s("i",{class:"icon icon-spinner"},null,-1),p(" Downloading... ",-1)])])):(r(),a("span",es,[...e[29]||(e[29]=[s("i",{class:"icon icon-download"},null,-1),p(" Download ",-1)])]))],10,$)])])]))),128))])])]))]),l.selectedPayslip?(r(),a("div",{key:0,class:"modal-overlay",onClick:e[11]||(e[11]=C(t=>l.selectedPayslip=null,["self"]))},[s("div",ls,[s("div",ts,[s("h2",null,"Payslip Details - "+i(l.selectedPayslip.period),1),s("button",{onClick:e[8]||(e[8]=t=>l.selectedPayslip=null),class:"close-btn"},"✕")]),s("div",ns,[s("div",os,[e[35]||(e[35]=s("div",{class:"card-header"},[s("h3",null,"Period Information"),s("i",{class:"icon icon-info"})],-1)),s("div",is,[s("div",null,[e[31]||(e[31]=s("strong",null,"Period:",-1)),p(" "+i(l.selectedPayslip.period),1)]),s("div",null,[e[32]||(e[32]=s("strong",null,"Payment Date:",-1)),p(" "+i(n.formatDate(l.selectedPayslip.payment_date)),1)]),s("div",null,[e[33]||(e[33]=s("strong",null,"Status:",-1)),e[34]||(e[34]=p()),s("span",{class:y(["status-badge",l.selectedPayslip.status])},i(n.formatStatus(l.selectedPayslip.status)),3)])])]),s("div",as,[e[41]||(e[41]=s("div",{class:"card-header"},[s("h3",null,"Earnings"),s("i",{class:"icon icon-money"})],-1)),s("div",rs,[s("div",ds,[e[36]||(e[36]=s("span",null,"Basic Salary:",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.basic_salary)),1)]),s("div",us,[e[37]||(e[37]=s("span",null,"House Allowance:",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.house_allowance)),1)]),s("div",ps,[e[38]||(e[38]=s("span",null,"Transport Allowance:",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.transport_allowance)),1)]),s("div",cs,[e[39]||(e[39]=s("span",null,"Other Allowances:",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.other_allowances)),1)]),s("div",ys,[s("span",null,"Overtime Pay ("+i(l.selectedPayslip.overtime_hours)+"h):",1),s("span",null,i(n.formatCurrency(l.selectedPayslip.overtime_pay)),1)]),s("div",ms,[e[40]||(e[40]=s("span",null,[s("strong",null,"Gross Pay:")],-1)),s("span",null,[s("strong",null,i(n.formatCurrency(l.selectedPayslip.grossPay)),1)])])])]),s("div",fs,[e[47]||(e[47]=s("div",{class:"card-header"},[s("h3",null,"Deductions"),s("i",{class:"icon icon-minus"})],-1)),s("div",vs,[s("div",hs,[e[42]||(e[42]=s("span",null,"NAPSA (5%):",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.napsa)),1)]),s("div",Ps,[e[43]||(e[43]=s("span",null,"PAYE Tax:",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.paye)),1)]),s("div",gs,[e[44]||(e[44]=s("span",null,"NHIMA (1%):",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.nhima)),1)]),s("div",ws,[e[45]||(e[45]=s("span",null,"Other Deductions:",-1)),s("span",null,i(n.formatCurrency(l.selectedPayslip.other_deductions)),1)]),s("div",bs,[e[46]||(e[46]=s("span",null,[s("strong",null,"Total Deductions:")],-1)),s("span",null,[s("strong",null,i(n.formatCurrency(l.selectedPayslip.deductions)),1)])])])]),s("div",Cs,[e[48]||(e[48]=s("div",{class:"net-pay-label"},"NET PAY",-1)),s("div",_s,i(n.formatCurrency(l.selectedPayslip.netPay)),1)])]),s("div",Ds,[s("button",{onClick:e[9]||(e[9]=t=>n.downloadPayslip(l.selectedPayslip)),class:"btn-primary",disabled:l.downloading[l.selectedPayslip.id]},i(l.downloading[l.selectedPayslip.id]?"⏳ Downloading...":"⬇️ Download PDF"),9,ks),s("button",{onClick:e[10]||(e[10]=t=>l.selectedPayslip=null),class:"btn-secondary"},"Close")])])])):m("",!0),l.toast.show?(r(),a("div",{key:1,class:y(["toast",l.toast.type])},i(l.toast.message),3)):m("",!0)])}const Fs=_(k,[["render",As],["__scopeId","data-v-2972391a"]]);export{Fs as default};
