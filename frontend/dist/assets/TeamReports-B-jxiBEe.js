import{_ as g,u as y}from"./index-C1X9tsoG.js";import{b as l,p as t,q as m,t as i,C as _,F as h,D as R,g as c,f as d,z as f}from"./vendor-Dn_KV7fh.js";const w={name:"TeamReports",setup(){return{authStore:y()}},data(){return{loading:!1,generatingReport:!1,error:null,managedEmployees:[],teamStats:{},teamReport:null,productivityReport:null,pendingLeavesCount:0,attendanceIssuesCount:0,retryCount:0}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(!this.authStore.isAuthenticated){this.error="Please log in to access team reports.";return}if(!this.authStore.isManager){this.error="You do not have permission to access this page.";return}this.fetchManagerData()},async fetchManagerData(){this.loading=!0,this.error=null;try{console.log("Fetching manager team data...");const[s,e,o]=await Promise.all([c.get("/api/manager/employees"),c.get("/api/manager/leaves/pending"),c.get("/api/manager/attendance")]);console.log("Managed employees response:",s.data),console.log("Pending leaves response:",e.data),console.log("Attendance response:",o.data),this.managedEmployees=this.processEmployeesData(s.data),this.pendingLeavesCount=this.processLeavesData(e.data);const p=this.processAttendanceData(o.data);this.calculateTeamStats(p),await this.generateReportsFromData()}catch(s){console.error("Fetch error:",s),this.handleApiError(s)}finally{this.loading=!1}},processEmployeesData(s){return(s.data||s||[]).map(o=>({id:o.id,name:`${o.first_name||""} ${o.last_name||""}`.trim()||"Unknown Employee",position:o.position||o.job_title||"Employee",department:o.department||"General",email:o.email,status:"present"}))},processLeavesData(s){return Array.isArray(s)?s.length:s.data&&Array.isArray(s.data)?s.data.length:typeof s=="object"&&s.pending_leaves!==void 0?s.pending_leaves:0},processAttendanceData(s){const e=new Date().toISOString().split("T")[0];let o=[];return Array.isArray(s)?o=s:s.data&&Array.isArray(s.data)?o=s.data:s.attendances&&(o=s.attendances),{todayAttendances:o.filter(a=>new Date(a.date||a.created_at).toISOString().split("T")[0]===e),totalAttendances:o,summary:s.summary||{}}},calculateTeamStats(s){const{todayAttendances:e,summary:o}=s,p=e.filter(r=>r.status==="present"||r.status==="completed").length,a=e.filter(r=>r.status==="late").length;this.managedEmployees.forEach(r=>{const n=e.find(u=>{var v;return u.employee_id===r.id||((v=u.employee)==null?void 0:v.id)===r.id});r.status=n?n.status:"absent"}),this.attendanceIssuesCount=this.managedEmployees.filter(r=>["absent","late"].includes(r.status)).length,this.teamStats={team_size:this.managedEmployees.length,present_today:p+a,pending_leaves:this.pendingLeavesCount,avg_productivity:o.avg_productivity||Math.round(p/this.managedEmployees.length*100)||0}},async generateReportsFromData(){const s=new Date().toISOString().split("T")[0],e=this.managedEmployees.filter(o=>["present","completed","late"].includes(o.status)).length;this.teamReport={period_start:s,period_end:s,total_employees:this.managedEmployees.length,active_employees:e,on_leave:this.pendingLeavesCount,attendance_rate:Math.round(e/this.managedEmployees.length*100)||0};try{const o=await c.get("/api/manager/reports/productivity");this.productivityReport=this.processProductivityData(o.data)}catch(o){console.log("Using calculated productivity data:",o),this.productivityReport={generated_at:new Date().toISOString(),avg_productivity:this.teamStats.avg_productivity,total_tasks_completed:0,avg_attendance_rate:this.teamReport.attendance_rate}}},processProductivityData(s){return{generated_at:s.generated_at||new Date().toISOString(),avg_productivity:s.avg_productivity||s.average_productivity||0,total_tasks_completed:s.total_tasks_completed||s.completed_tasks||0,avg_attendance_rate:s.avg_attendance_rate||s.average_attendance||0}},async generateTeamReport(){this.generatingReport=!0;try{const s=await c.get("/api/manager/reports/team");this.teamReport=this.processTeamReportData(s.data),this.$notify({type:"success",title:"Success",text:"Team report generated successfully!"})}catch(s){console.error("Error generating team report:",s),this.$notify({type:"error",title:"Error",text:"Failed to generate team report. Using current data."}),await this.generateReportsFromData()}finally{this.generatingReport=!1}},async generateProductivityReport(){this.generatingReport=!0;try{const s=await c.get("/api/manager/reports/productivity");this.productivityReport=this.processProductivityData(s.data),this.$notify({type:"success",title:"Success",text:"Productivity report generated successfully!"})}catch(s){console.error("Error generating productivity report:",s),this.$notify({type:"error",title:"Error",text:"Failed to generate productivity report. Using current data."}),await this.generateReportsFromData()}finally{this.generatingReport=!1}},processTeamReportData(s){return{period_start:s.period_start||s.start_date,period_end:s.period_end||s.end_date,total_employees:s.total_employees||s.team_size,active_employees:s.active_employees||s.present_employees,on_leave:s.on_leave||s.leave_count,attendance_rate:s.attendance_rate||s.attendance_percentage}},getInitials(s){return s?s.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"??"},getEmployeeStatus(s){return s.status||"absent"},getEmployeeStatusText(s){const e=this.getEmployeeStatus(s);return{present:"Present",completed:"Present",absent:"Absent",late:"Late",on_leave:"On Leave"}[e]||"Unknown"},viewAllTeamMembers(){this.$router.push({name:"manager-team"})},viewTeamReport(){this.teamReport&&this.$router.push({name:"report-details",query:{type:"team",manager:!0}})},viewProductivityReport(){this.productivityReport&&this.$router.push({name:"report-details",query:{type:"productivity",manager:!0}})},viewPendingLeaves(){this.$router.push({name:"manager-leaves"})},viewAttendanceIssues(){this.$router.push({name:"manager-attendance"})},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchManagerData():this.error="Max retries exceeded. Check your network or server."},handleApiError(s){var o,p,a,r,n;let e="An unexpected error occurred.";s.code==="ERR_NETWORK"||s.message.includes("Network Error")?e="Network error: Please check your connection and try again.":((o=s.response)==null?void 0:o.status)===401?(e="Your session has expired. Please log in again.",this.authStore.clearAuth(),this.$router.push({name:"login"})):((p=s.response)==null?void 0:p.status)===403?e="You do not have permission to perform this action.":((a=s.response)==null?void 0:a.status)===404?e="Manager endpoints not found. Please check the API routes.":e=((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.message)||e,this.error=e},formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}}},b={class:"reports-management"},A={class:"page-header"},k={class:"header-actions"},T=["disabled"],E=["disabled"],S={key:0,class:"error-message"},P={key:1,class:"error-message"},D={key:2,class:"loading"},C={key:3,class:"error-message"},M={key:4,class:"reports-dashboard"},L={class:"stats-grid"},x={class:"stat-card"},I={class:"stat-content"},F={class:"stat-value"},N={class:"stat-card"},O={class:"stat-content"},z={class:"stat-value"},G={class:"stat-card"},U={class:"stat-content"},V={class:"stat-value"},Y={class:"stat-card"},j={class:"stat-content"},q={class:"stat-value"},B={class:"team-members-section"},K={class:"section-header"},W={key:0,class:"empty-state"},H={key:1,class:"team-members-grid"},J={class:"member-avatar"},Q={class:"member-info"},X={class:"member-position"},Z={class:"member-department"},$={class:"member-status"},ee={class:"status-text"},te={key:0,class:"more-members"},se={class:"report-sections"},re={class:"report-section"},ae={class:"section-header"},ne={key:0,class:"report-preview"},oe={class:"preview-content"},ie={class:"preview-stats"},le={class:"preview-stat"},de={class:"preview-stat"},pe={class:"preview-stat"},ce={class:"preview-stat"},me={key:1,class:"empty-preview"},ue={class:"report-section"},ve={class:"section-header"},ge={key:0,class:"report-preview"},ye={class:"preview-content"},_e={class:"preview-stats"},he={class:"preview-stat"},Re={class:"preview-stat"},fe={class:"preview-stat"},we={key:1,class:"empty-preview"},be={class:"pending-actions"},Ae={class:"actions-grid"},ke={class:"action-card"},Te={class:"action-content"},Ee={class:"action-count"},Se={class:"action-card"},Pe={class:"action-content"},De={class:"action-count"};function Ce(s,e,o,p,a,r){return d(),l("div",b,[t("div",A,[e[12]||(e[12]=t("h1",null,"My Team Reports",-1)),t("div",k,[t("button",{onClick:e[0]||(e[0]=(...n)=>r.generateTeamReport&&r.generateTeamReport(...n)),class:"btn-primary",disabled:a.generatingReport},[e[10]||(e[10]=t("span",null,"ðŸ“Š",-1)),m(" "+i(a.generatingReport?"Generating...":"Generate Team Report"),1)],8,T),t("button",{onClick:e[1]||(e[1]=(...n)=>r.generateProductivityReport&&r.generateProductivityReport(...n)),class:"btn-secondary",disabled:a.generatingReport},[e[11]||(e[11]=t("span",null,"ðŸ“ˆ",-1)),m(" "+i(a.generatingReport?"Generating...":"Productivity Report"),1)],8,E)])]),p.authStore.isAuthenticated?p.authStore.isManager?a.loading?(d(),l("div",D,[...e[13]||(e[13]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading team reports...",-1)])])):a.error?(d(),l("div",C,[m(i(a.error)+" ",1),t("button",{onClick:e[2]||(e[2]=(...n)=>r.retryFetch&&r.retryFetch(...n)),class:"btn-primary",style:{"margin-top":"1rem"}},"Retry")])):(d(),l("div",M,[e[38]||(e[38]=t("div",{class:"manager-info"},[t("h2",null,"ðŸ‘¨â€ðŸ’¼ Managing Team"),t("p",{class:"manager-subtitle"},"Team overview and performance metrics for your direct reports")],-1)),t("div",L,[t("div",x,[e[16]||(e[16]=t("div",{class:"stat-icon"},"ðŸ‘¥",-1)),t("div",I,[e[14]||(e[14]=t("h3",null,"Team Size",-1)),t("p",F,i(a.teamStats.team_size||0),1),e[15]||(e[15]=t("p",{class:"stat-label"},"Direct Reports",-1))])]),t("div",N,[e[19]||(e[19]=t("div",{class:"stat-icon"},"âœ…",-1)),t("div",O,[e[17]||(e[17]=t("h3",null,"Present Today",-1)),t("p",z,i(a.teamStats.present_today||0),1),e[18]||(e[18]=t("p",{class:"stat-label"},"Employees Present",-1))])]),t("div",G,[e[22]||(e[22]=t("div",{class:"stat-icon"},"ðŸ“…",-1)),t("div",U,[e[20]||(e[20]=t("h3",null,"Pending Leaves",-1)),t("p",V,i(a.teamStats.pending_leaves||0),1),e[21]||(e[21]=t("p",{class:"stat-label"},"Awaiting Approval",-1))])]),t("div",Y,[e[25]||(e[25]=t("div",{class:"stat-icon"},"ðŸ“Š",-1)),t("div",j,[e[23]||(e[23]=t("h3",null,"Avg. Productivity",-1)),t("p",q,i(a.teamStats.avg_productivity||0)+"%",1),e[24]||(e[24]=t("p",{class:"stat-label"},"This Month",-1))])])]),t("div",B,[t("div",K,[t("h2",null,"Team Members ("+i(a.managedEmployees.length)+")",1),t("button",{onClick:e[3]||(e[3]=(...n)=>r.viewAllTeamMembers&&r.viewAllTeamMembers(...n)),class:"btn-view"},"View All")]),a.managedEmployees.length===0?(d(),l("div",W,[...e[26]||(e[26]=[t("p",null,"No team members assigned to you yet.",-1)])])):(d(),l("div",H,[(d(!0),l(h,null,R(a.managedEmployees.slice(0,6),n=>(d(),l("div",{key:n.id,class:"team-member-card"},[t("div",J,i(r.getInitials(n.name)),1),t("div",Q,[t("h4",null,i(n.name),1),t("p",X,i(n.position||n.job_title||"Employee"),1),t("p",Z,i(n.department||"General"),1)]),t("div",$,[t("span",{class:f(["status-dot",r.getEmployeeStatus(n)])},null,2),t("span",ee,i(r.getEmployeeStatusText(n)),1)])]))),128)),a.managedEmployees.length>6?(d(),l("div",te,[t("p",null,"+"+i(a.managedEmployees.length-6)+" more team members",1)])):_("",!0)]))]),t("div",se,[t("div",re,[t("div",ae,[e[27]||(e[27]=t("h2",null,"Team Performance Report",-1)),t("button",{onClick:e[4]||(e[4]=(...n)=>r.viewTeamReport&&r.viewTeamReport(...n)),class:"btn-view"},"View Full Report")]),a.teamReport?(d(),l("div",ne,[t("div",oe,[e[28]||(e[28]=t("h4",null,"Your Team Overview",-1)),t("p",null,"Period: "+i(r.formatDate(a.teamReport.period_start))+" - "+i(r.formatDate(a.teamReport.period_end)),1),t("div",ie,[t("span",le,"Team Members: "+i(a.teamReport.total_employees),1),t("span",de,"Active Today: "+i(a.teamReport.active_employees),1),t("span",pe,"On Leave: "+i(a.teamReport.on_leave),1),t("span",ce,"Attendance Rate: "+i(a.teamReport.attendance_rate)+"%",1)])])])):(d(),l("div",me,[e[29]||(e[29]=t("p",null,"No team report generated yet.",-1)),t("button",{onClick:e[5]||(e[5]=(...n)=>r.generateTeamReport&&r.generateTeamReport(...n)),class:"btn-primary"},"Generate Report")]))]),t("div",ue,[t("div",ve,[e[30]||(e[30]=t("h2",null,"Team Productivity",-1)),t("button",{onClick:e[6]||(e[6]=(...n)=>r.viewProductivityReport&&r.viewProductivityReport(...n)),class:"btn-view"},"View Full Report")]),a.productivityReport?(d(),l("div",ge,[t("div",ye,[e[31]||(e[31]=t("h4",null,"Performance Metrics",-1)),t("p",null,"Generated: "+i(r.formatDate(a.productivityReport.generated_at)),1),t("div",_e,[t("span",he,"Avg. Productivity: "+i(a.productivityReport.avg_productivity)+"%",1),t("span",Re,"Tasks Completed: "+i(a.productivityReport.total_tasks_completed),1),t("span",fe,"Team Attendance: "+i(a.productivityReport.avg_attendance_rate)+"%",1)])])])):(d(),l("div",we,[e[32]||(e[32]=t("p",null,"No productivity report generated yet.",-1)),t("button",{onClick:e[7]||(e[7]=(...n)=>r.generateProductivityReport&&r.generateProductivityReport(...n)),class:"btn-primary"},"Generate Report")]))])]),t("div",be,[e[37]||(e[37]=t("h2",null,"Pending Actions",-1)),t("div",Ae,[t("div",ke,[e[34]||(e[34]=t("div",{class:"action-icon"},"ðŸ“‹",-1)),t("div",Te,[e[33]||(e[33]=t("h3",null,"Leave Requests",-1)),t("p",Ee,i(a.pendingLeavesCount)+" pending",1),t("button",{onClick:e[8]||(e[8]=(...n)=>r.viewPendingLeaves&&r.viewPendingLeaves(...n)),class:"btn-action"},"Review")])]),t("div",Se,[e[36]||(e[36]=t("div",{class:"action-icon"},"â°",-1)),t("div",Pe,[e[35]||(e[35]=t("h3",null,"Attendance Issues",-1)),t("p",De,i(a.attendanceIssuesCount)+" to review",1),t("button",{onClick:e[9]||(e[9]=(...n)=>r.viewAttendanceIssues&&r.viewAttendanceIssues(...n)),class:"btn-action"},"Check")])])])])])):(d(),l("div",P," You don't have permission to access this page. ")):(d(),l("div",S," Please log in to access team reports. "))])}const xe=g(w,[["render",Ce],["__scopeId","data-v-d65d04e6"]]);export{xe as default};
