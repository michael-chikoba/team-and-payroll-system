import{_,u as k}from"./index-cgHGa_Rg.js";import{b as i,p as s,C as y,t as a,x as P,A as v,F as f,D as m,q as c,v as C,z as g,g as h,f as r}from"./vendor-CFHPe_rb.js";const D={name:"EmployeePayslips",setup(){return{authStore:k()}},data(){return{pageName:"My Payslips",payslips:[],filterYear:new Date().getFullYear(),filterMonth:"",filterStatus:"",availableYears:[],months:[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}],loading:!1,downloading:{},error:null,selectedPayslip:null,toast:{show:!1,message:"",type:"success"},currentPage:1,perPage:10}},computed:{totalEarnings(){return this.payslips.reduce((o,e)=>o+(e.netPay||0),0)},latestPayslipPeriod(){return this.payslips.length===0?"N/A":this.payslips[0].period||"N/A"},paginatedPayslips(){const o=(this.currentPage-1)*this.perPage,e=o+this.perPage;return this.payslips.slice(o,e)},totalPages(){return Math.ceil(this.payslips.length/this.perPage)}},mounted(){this.fetchPayslips()},methods:{async fetchPayslips(){this.loading=!0,this.error=null;try{const o={year:this.filterYear,...this.filterMonth&&{month:this.filterMonth},...this.filterStatus&&{status:this.filterStatus}},e=await h.get("/api/employee/payslips",{params:o});if(this.payslips=e.data.data||e.data||[],this.currentPage=1,this.payslips.length>0){const u=[...new Set(this.payslips.map(d=>{const t=d.pay_period_start||d.period_start||d.created_at;return new Date(t).getFullYear()}))].sort((d,t)=>t-d);this.availableYears=u}else this.availableYears=[new Date().getFullYear()]}catch(o){console.error("Payslips fetch error:",o),this.handleApiError(o)}finally{this.loading=!1}},async downloadPayslip(o){var e,u,d;this.downloading={...this.downloading,[o.id]:!0};try{const t=await h.get(`/api/employee/payslips/${o.id}/download`,{responseType:"blob",headers:{Accept:"application/pdf"}});if(t.data.type==="application/pdf"){const n=window.URL.createObjectURL(new Blob([t.data],{type:"application/pdf"})),l=document.createElement("a");l.href=n,l.setAttribute("download",`payslip-${((e=o.period)==null?void 0:e.replace(/ /g,"-"))||o.id}.pdf`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(n),this.showToast("Payslip downloaded successfully!","success")}else throw new Error("Invalid file type received")}catch(t){console.error("Download error:",t),((u=t.response)==null?void 0:u.status)===404?this.showToast("Payslip PDF not found. Please contact HR.","error"):((d=t.response)==null?void 0:d.status)===403?this.showToast("You do not have permission to download this payslip.","error"):this.showToast("Failed to download payslip. Please try again.","error"),this.handleApiError(t)}finally{this.downloading={...this.downloading,[o.id]:!1}}},async viewPayslip(o){try{const e=await h.get(`/api/employee/payslips/${o.id}`);this.selectedPayslip=e.data.data||e.data}catch(e){console.error("Error fetching payslip details:",e),this.showToast("Failed to load payslip details.","error"),this.selectedPayslip=o}},resetFilters(){this.filterYear=new Date().getFullYear(),this.filterMonth="",this.filterStatus="",this.fetchPayslips()},showToast(o,e="success"){this.toast={show:!0,message:o,type:e},setTimeout(()=>{this.toast.show=!1},3e3)},handleApiError(o){var u,d,t,n,l,p,w,b;let e="An unexpected error occurred.";o.code==="ERR_NETWORK"||o.message.includes("Network Error")?e="Network error. Please check your connection.":((u=o.response)==null?void 0:u.status)===401?(e="Session expired. Redirecting to login...",this.authStore.clearAuth(),this.$router.push({name:"login"})):((d=o.response)==null?void 0:d.status)===403?e="Access denied.":((t=o.response)==null?void 0:t.status)===404?e="Payslip not found. Please contact HR.":((n=o.response)==null?void 0:n.status)===500?e="Server error. Please try again later.":e=((p=(l=o.response)==null?void 0:l.data)==null?void 0:p.message)||((b=(w=o.response)==null?void 0:w.data)==null?void 0:b.error)||e,this.error=e},formatCurrency(o){return o==null?"ZMW 0.00":new Intl.NumberFormat("en-ZM",{style:"currency",currency:"ZMW",minimumFractionDigits:2}).format(o)},formatStatus(o){return{generated:"Generated",paid:"Paid",draft:"Draft",processing:"Processing"}[o]||o},formatDate(o){return o?new Date(o).toLocaleDateString("en-ZM",{year:"numeric",month:"short",day:"numeric"}):"N/A"},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++}}},A={class:"payslips-view"},S={class:"header"},M={class:"header-left"},N={class:"title"},F={class:"filters"},E={class:"filter-group"},Y=["value"],T={class:"filter-group"},x=["value"],R={class:"filter-group"},L={class:"content"},Z={key:0,class:"summary-cards"},V={class:"card"},O={class:"value"},U={class:"card"},W={class:"value"},B={class:"card"},H={class:"value"},I={key:1,class:"loading"},G={key:2,class:"error-message"},J={key:3,class:"empty-state"},j={key:4,class:"table-container"},z={class:"payslips-table"},q={class:"deduction"},K={class:"net-pay"},Q={class:"action-buttons"},X=["onClick"],$=["onClick","disabled"],ss={key:0},es={key:1},ts={key:0,class:"pagination"},ls=["disabled"],ns=["disabled"],os={class:"modal-card"},as={class:"modal-header"},is={class:"modal-body"},rs={class:"detail-section"},ds={class:"detail-grid"},us={class:"detail-section"},cs={class:"amount-grid"},ps={class:"amount-row"},ys={class:"amount-row"},gs={class:"amount-row"},Ps={class:"amount-row"},vs={class:"amount-row"},fs={class:"amount-row total"},ms={class:"detail-section"},hs={class:"amount-grid"},ws={class:"amount-row"},bs={class:"amount-row"},Cs={class:"amount-row"},_s={class:"amount-row"},ks={class:"amount-row total deduction"},Ds={class:"net-pay-section"},As={class:"net-pay-amount"},Ss={class:"modal-footer"},Ms=["disabled"];function Ns(o,e,u,d,t,n){return r(),i("div",A,[s("header",S,[s("div",M,[s("h1",N,a(t.pageName),1),e[14]||(e[14]=s("p",{class:"subtitle"},"Castle Holding Zambia - Manage and download your payslips",-1))])]),s("div",F,[s("div",E,[e[15]||(e[15]=s("label",null,"Year:",-1)),P(s("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.filterYear=l),onChange:e[1]||(e[1]=(...l)=>n.fetchPayslips&&n.fetchPayslips(...l))},[(r(!0),i(f,null,m(t.availableYears,l=>(r(),i("option",{key:l,value:l},a(l),9,Y))),128))],544),[[v,t.filterYear]])]),s("div",T,[e[17]||(e[17]=s("label",null,"Month:",-1)),P(s("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.filterMonth=l),onChange:e[3]||(e[3]=(...l)=>n.fetchPayslips&&n.fetchPayslips(...l))},[e[16]||(e[16]=s("option",{value:""},"All Months",-1)),(r(!0),i(f,null,m(t.months,l=>(r(),i("option",{key:l.value,value:l.value},a(l.label),9,x))),128))],544),[[v,t.filterMonth]])]),s("div",R,[e[19]||(e[19]=s("label",null,"Status:",-1)),P(s("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.filterStatus=l),onChange:e[5]||(e[5]=(...l)=>n.fetchPayslips&&n.fetchPayslips(...l))},[...e[18]||(e[18]=[s("option",{value:""},"All",-1),s("option",{value:"generated"},"Generated",-1),s("option",{value:"paid"},"Paid",-1)])],544),[[v,t.filterStatus]])])]),s("div",L,[!t.loading&&t.payslips.length>0?(r(),i("div",Z,[s("div",V,[e[20]||(e[20]=s("div",{class:"card-icon"},[s("i",{class:"icon icon-file"})],-1)),e[21]||(e[21]=s("h3",null,"Total Payslips",-1)),s("p",O,a(t.payslips.length),1)]),s("div",U,[e[22]||(e[22]=s("div",{class:"card-icon"},[s("i",{class:"icon icon-money"})],-1)),e[23]||(e[23]=s("h3",null,"Total Earnings (ZMW)",-1)),s("p",W,a(n.formatCurrency(n.totalEarnings)),1)]),s("div",B,[e[24]||(e[24]=s("div",{class:"card-icon"},[s("i",{class:"icon icon-calendar"})],-1)),e[25]||(e[25]=s("h3",null,"Latest Payslip",-1)),s("p",H,a(n.latestPayslipPeriod),1)])])):y("",!0),t.loading?(r(),i("div",I,[...e[26]||(e[26]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading payslips...",-1)])])):t.error?(r(),i("div",G,[c(a(t.error)+" ",1),s("button",{onClick:e[6]||(e[6]=(...l)=>n.fetchPayslips&&n.fetchPayslips(...l)),class:"btn-primary"},"Retry")])):t.payslips.length===0?(r(),i("div",J,[e[27]||(e[27]=s("i",{class:"icon icon-empty"},null,-1)),e[28]||(e[28]=s("p",null,"No payslips found for the selected filters.",-1)),s("button",{onClick:e[7]||(e[7]=(...l)=>n.resetFilters&&n.resetFilters(...l)),class:"btn-primary"},"Reset Filters")])):(r(),i("div",j,[s("table",z,[e[32]||(e[32]=s("thead",null,[s("tr",null,[s("th",null,"Period"),s("th",null,"Gross Pay (ZMW)"),s("th",null,"Deductions (ZMW)"),s("th",null,"Net Pay (ZMW)"),s("th",null,"Status"),s("th",null,"Payment Date"),s("th",null,"Actions")])],-1)),s("tbody",null,[(r(!0),i(f,null,m(n.paginatedPayslips,l=>(r(),i("tr",{key:l.id},[s("td",null,[s("strong",null,a(l.period),1)]),s("td",null,a(n.formatCurrency(l.grossPay)),1),s("td",q,a(n.formatCurrency(l.deductions)),1),s("td",K,[s("strong",null,a(n.formatCurrency(l.netPay)),1)]),s("td",null,[s("span",{class:g(["status-badge",l.status.toLowerCase()])},a(n.formatStatus(l.status)),3)]),s("td",null,a(n.formatDate(l.payment_date)),1),s("td",null,[s("div",Q,[s("button",{onClick:p=>n.viewPayslip(l),class:"action-btn view",title:"View Details"},[...e[29]||(e[29]=[s("i",{class:"icon icon-eye"},null,-1),c(" View ",-1)])],8,X),s("button",{onClick:C(p=>n.downloadPayslip(l),["prevent"]),class:g(["action-btn download",{downloading:t.downloading[l.id]}]),disabled:t.downloading[l.id],title:"Download PDF"},[t.downloading[l.id]?(r(),i("span",ss,[...e[30]||(e[30]=[s("i",{class:"icon icon-spinner"},null,-1),c(" Downloading... ",-1)])])):(r(),i("span",es,[...e[31]||(e[31]=[s("i",{class:"icon icon-download"},null,-1),c(" Download ",-1)])]))],10,$)])])]))),128))])]),n.totalPages>1?(r(),i("div",ts,[s("button",{onClick:e[8]||(e[8]=(...l)=>n.prevPage&&n.prevPage(...l)),disabled:t.currentPage===1},"Previous",8,ls),s("span",null,"Page "+a(t.currentPage)+" of "+a(n.totalPages),1),s("button",{onClick:e[9]||(e[9]=(...l)=>n.nextPage&&n.nextPage(...l)),disabled:t.currentPage===n.totalPages},"Next",8,ns)])):y("",!0)]))]),t.selectedPayslip?(r(),i("div",{key:0,class:"modal-overlay",onClick:e[13]||(e[13]=C(l=>t.selectedPayslip=null,["self"]))},[s("div",os,[s("div",as,[s("h2",null,"Payslip Details - "+a(t.selectedPayslip.period),1),s("button",{onClick:e[10]||(e[10]=l=>t.selectedPayslip=null),class:"close-btn"},"✕")]),s("div",is,[s("div",rs,[e[37]||(e[37]=s("div",{class:"card-header"},[s("h3",null,"Period Information"),s("i",{class:"icon icon-info"})],-1)),s("div",ds,[s("div",null,[e[33]||(e[33]=s("strong",null,"Period:",-1)),c(" "+a(t.selectedPayslip.period),1)]),s("div",null,[e[34]||(e[34]=s("strong",null,"Payment Date:",-1)),c(" "+a(n.formatDate(t.selectedPayslip.payment_date)),1)]),s("div",null,[e[35]||(e[35]=s("strong",null,"Status:",-1)),e[36]||(e[36]=c()),s("span",{class:g(["status-badge",t.selectedPayslip.status])},a(n.formatStatus(t.selectedPayslip.status)),3)])])]),s("div",us,[e[43]||(e[43]=s("div",{class:"card-header"},[s("h3",null,"Earnings"),s("i",{class:"icon icon-money"})],-1)),s("div",cs,[s("div",ps,[e[38]||(e[38]=s("span",null,"Basic Salary:",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.basic_salary)),1)]),s("div",ys,[e[39]||(e[39]=s("span",null,"House Allowance:",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.house_allowance)),1)]),s("div",gs,[e[40]||(e[40]=s("span",null,"Transport Allowance:",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.transport_allowance)),1)]),s("div",Ps,[e[41]||(e[41]=s("span",null,"Other Allowances:",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.other_allowances)),1)]),s("div",vs,[s("span",null,"Overtime Pay ("+a(t.selectedPayslip.overtime_hours)+"h):",1),s("span",null,a(n.formatCurrency(t.selectedPayslip.overtime_pay)),1)]),s("div",fs,[e[42]||(e[42]=s("span",null,[s("strong",null,"Gross Pay:")],-1)),s("span",null,[s("strong",null,a(n.formatCurrency(t.selectedPayslip.grossPay)),1)])])])]),s("div",ms,[e[49]||(e[49]=s("div",{class:"card-header"},[s("h3",null,"Deductions"),s("i",{class:"icon icon-minus"})],-1)),s("div",hs,[s("div",ws,[e[44]||(e[44]=s("span",null,"NAPSA (5%):",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.napsa)),1)]),s("div",bs,[e[45]||(e[45]=s("span",null,"PAYE Tax:",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.paye)),1)]),s("div",Cs,[e[46]||(e[46]=s("span",null,"NHIMA (1%):",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.nhima)),1)]),s("div",_s,[e[47]||(e[47]=s("span",null,"Other Deductions:",-1)),s("span",null,a(n.formatCurrency(t.selectedPayslip.other_deductions)),1)]),s("div",ks,[e[48]||(e[48]=s("span",null,[s("strong",null,"Total Deductions:")],-1)),s("span",null,[s("strong",null,a(n.formatCurrency(t.selectedPayslip.deductions)),1)])])])]),s("div",Ds,[e[50]||(e[50]=s("div",{class:"net-pay-label"},"NET PAY",-1)),s("div",As,a(n.formatCurrency(t.selectedPayslip.netPay)),1)])]),s("div",Ss,[s("button",{onClick:e[11]||(e[11]=l=>n.downloadPayslip(t.selectedPayslip)),class:"btn-primary",disabled:t.downloading[t.selectedPayslip.id]},a(t.downloading[t.selectedPayslip.id]?"⏳ Downloading...":"⬇️ Download PDF"),9,Ms),s("button",{onClick:e[12]||(e[12]=l=>t.selectedPayslip=null),class:"btn-secondary"},"Close")])])])):y("",!0),t.toast.show?(r(),i("div",{key:1,class:g(["toast",t.toast.type])},a(t.toast.message),3)):y("",!0)])}const Ys=_(D,[["render",Ns],["__scopeId","data-v-7fa0b777"]]);export{Ys as default};
