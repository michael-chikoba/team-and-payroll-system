import{_ as S,u as N}from"./index-cgHGa_Rg.js";import{b as a,p as t,C as p,q as c,t as n,F as M,D as A,v as k,x as u,y as f,A as _,s as C,g,f as i,z as F}from"./vendor-CFHPe_rb.js";const x={name:"EmployeeManagement",setup(){return{authStore:N()}},data(){return{employees:[],managers:[],loading:!1,error:null,showAddModal:!1,showEditModal:!1,submitting:!1,formError:null,currentEmployee:null,form:{first_name:"",last_name:"",email:"",role:"employee",position:"",department:"",base_salary:"",transport_allowance:"",lunch_allowance:"",employment_type:"",hire_date:"",manager_id:""},retryCount:0}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(!this.authStore.isAuthenticated){this.error="Please log in to access employee management.";return}if(!this.authStore.isAdmin&&!this.authStore.isManager){this.error="You do not have permission to access this page.";return}this.fetchEmployees(),this.fetchManagers()},async fetchEmployees(s=!1){this.loading=!0,this.error=null;try{console.log("Fetching employees... (retry:",s,")");const e=await g.get("/api/admin/employees");console.log("Employees response:",e.data);let m=[];e.data&&e.data.employees?m=e.data.employees:e.data&&e.data.data?m=e.data.data:m=e.data||[],this.employees=m,console.log("Processed employees:",this.employees)}catch(e){console.error("Fetch error:",e),this.handleApiError(e)}finally{this.loading=!1}},async fetchManagers(){var s;try{console.log("Fetching managers...");const e=await g.get("/api/admin/managers");console.log("Managers API response:",e.data),Array.isArray(e.data)?this.managers=e.data:e.data&&e.data.data?this.managers=e.data.data:this.managers=e.data||[],this.managers.length===0?console.warn("No managers found in the system"):console.log("Managers loaded successfully:",this.managers)}catch(e){console.error("Failed to fetch managers:",e),this.managers=[],((s=e.response)==null?void 0:s.status)!==404&&this.$notify({type:"error",title:"Error",text:"Failed to load managers list"})}},getEmployeeName(s){return s.first_name&&s.last_name?`${s.first_name} ${s.last_name}`.trim():s.user&&s.user.first_name?`${s.user.first_name} ${s.user.last_name||""}`.trim():s.name?s.name:s.full_name?s.full_name:"N/A"},getEmployeeRole(s){var e;return s.role||((e=s.user)==null?void 0:e.role)||"employee"},getManagerName(s){if(!s)return"No Manager";const e=this.managers.find(m=>m.id===s);return e?`${e.first_name} ${e.last_name}`:"Unknown Manager"},formatRole(s){return{admin:"Admin",manager:"Manager",employee:"Employee"}[s]||"Employee"},getRoleBadgeClass(s){return{"role-employee":s==="employee","role-manager":s==="manager","role-admin":s==="admin"}},onRoleChange(){(this.form.role==="manager"||this.form.role==="admin")&&(this.form.manager_id="")},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchEmployees(!0):this.error="Max retries exceeded. Check your network or server."},async submitForm(){this.submitting=!0,this.formError=null;try{if(this.form.role==="employee"&&!this.form.manager_id){this.formError="Please select a manager for the employee.",this.submitting=!1;return}const s={first_name:this.form.first_name,last_name:this.form.last_name,email:this.form.email,role:this.form.role,position:this.form.position,department:this.form.department,base_salary:parseFloat(this.form.base_salary),transport_allowance:parseFloat(this.form.transport_allowance),lunch_allowance:parseFloat(this.form.lunch_allowance),employment_type:this.form.employment_type,hire_date:this.form.hire_date,manager_id:this.form.role==="employee"?this.form.manager_id:null};console.log("Submitting employee data:",s),this.showEditModal?await g.put(`/api/admin/employees/${this.currentEmployee.id}`,s):await g.post("/api/admin/employees",s),await this.fetchEmployees(),await this.fetchManagers(),this.closeModals();const e=this.showEditModal?"Employee updated successfully!":"Employee created successfully! Default password is: Password123!";this.$notify({type:"success",title:"Success",text:e})}catch(s){console.error("Submit error:",s.response),this.handleApiError(s)}finally{this.submitting=!1}},handleApiError(s){var m,d,r,l,o,h,y,b,v,E,w;let e="An unexpected error occurred.";if(s.code==="ERR_NETWORK"||s.message.includes("Network Error"))e="Network error: Please check your connection and try again.";else if(((m=s.response)==null?void 0:m.status)===401)e="Your session has expired. Please log in again.",this.authStore.clearAuth(),this.$router.push({name:"login"});else if(((d=s.response)==null?void 0:d.status)===403)e="You do not have permission to perform this action.";else if(((r=s.response)==null?void 0:r.status)===422){this.formError=s.response.data.message||"Please check the form for errors.";return}else if(((l=s.response)==null?void 0:l.status)===404)e="The requested resource was not found.";else if(((o=s.response)==null?void 0:o.status)===500){e=((y=(h=s.response)==null?void 0:h.data)==null?void 0:y.message)||"Server error occurred. Please try again.",(v=(b=s.response)==null?void 0:b.data)!=null&&v.details&&this.authStore.isAdmin&&(this.formError=s.response.data.details);return}else e=((w=(E=s.response)==null?void 0:E.data)==null?void 0:w.message)||e;this.error=e},editEmployee(s){var m,d,r,l,o;this.currentEmployee=s;const e=this.getEmployeeRole(s);this.form={first_name:s.first_name||((m=s.user)==null?void 0:m.first_name)||"",last_name:s.last_name||((d=s.user)==null?void 0:d.last_name)||"",email:s.email||((r=s.user)==null?void 0:r.email)||"",role:e,position:s.position||"",department:s.department||"",base_salary:s.base_salary||"",transport_allowance:s.transport_allowance||"",lunch_allowance:s.lunch_allowance||"",employment_type:s.employment_type||"",hire_date:((l=s.hire_date)==null?void 0:l.split("T")[0])||((o=s.created_at)==null?void 0:o.split("T")[0])||"",manager_id:e==="employee"?s.manager_id:""},this.showEditModal=!0},async deleteEmployee(s){const e=this.getEmployeeName(s);if(confirm(`Are you sure you want to delete ${e}? This action cannot be undone.`))try{await g.delete(`/api/admin/employees/${s.id}`),await this.fetchEmployees(),await this.fetchManagers(),this.$notify({type:"success",title:"Success",text:"Employee deleted successfully!"})}catch(m){this.handleApiError(m)}},viewEmployee(s){this.$router.push({name:"employee-details",params:{id:s.id}})},closeModals(){this.showAddModal=!1,this.showEditModal=!1,this.currentEmployee=null,this.formError=null,this.resetForm()},resetForm(){this.form={first_name:"",last_name:"",email:"",role:"employee",position:"",department:"",base_salary:"",transport_allowance:"",lunch_allowance:"",employment_type:"",hire_date:"",manager_id:""}},getInitials(s){return!s||s==="N/A"?"??":s.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)},formatNumber(s){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s||0)},formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},formatEmploymentType(s){return{full_time:"Full Time",part_time:"Part Time",contract:"Contract"}[s]||s||"N/A"}}},R={class:"employee-management"},T={class:"page-header"},D={key:0,class:"error-message"},U={key:1,class:"error-message"},V={key:2,class:"loading"},P={key:3,class:"error-message"},q={key:4,class:"employees-table-wrapper"},I={class:"employees-table"},K={class:"employee-name"},B={class:"employee-avatar"},L={class:"badge-cell"},z={class:"badge"},H={class:"badge-cell"},Y={class:"employee-actions"},O=["onClick"],j=["onClick"],W={key:0,class:"empty-state"},G={class:"modal"},J={class:"modal-header"},Q={class:"form-row"},X={class:"form-group"},Z={class:"form-group"},$={key:0,class:"form-group"},ee={class:"form-group"},te={class:"form-row"},se={class:"form-group"},oe={class:"form-group"},re={class:"form-row"},le={class:"form-group"},ae={class:"form-group"},ne={class:"form-row"},ie={class:"form-group"},me={class:"form-group"},de={class:"form-row"},ue={class:"form-group"},pe={class:"form-group"},fe={key:0,style:{color:"red"}},he=["required","disabled"],ge=["value"],ye={key:0,class:"warning-text"},ce={key:1,class:"info-text"},_e={key:1,class:"form-error"},be={class:"modal-footer"},ve=["disabled"];function Ee(s,e,m,d,r,l){return i(),a("div",R,[t("div",T,[e[21]||(e[21]=t("h1",null,"Employee Management",-1)),d.authStore.isAdmin?(i(),a("button",{key:0,onClick:e[0]||(e[0]=o=>r.showAddModal=!0),class:"btn-primary"},[...e[20]||(e[20]=[t("span",null,"âž•",-1),c(" Add Employee ",-1)])])):p("",!0)]),d.authStore.isAuthenticated?!d.authStore.isAdmin&&!d.authStore.isManager?(i(),a("div",U," You don't have permission to access this page. ")):r.loading?(i(),a("div",V,[...e[22]||(e[22]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading employees...",-1)])])):r.error?(i(),a("div",P,[c(n(r.error)+" ",1),t("button",{onClick:e[1]||(e[1]=(...o)=>l.retryFetch&&l.retryFetch(...o)),class:"btn-primary",style:{"margin-top":"1rem"}},"Retry")])):(i(),a("div",q,[t("table",I,[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"ID"),t("th",null,"Email"),t("th",null,"Position"),t("th",null,"Department"),t("th",null,"Salary"),t("th",null,"Transport"),t("th",null,"Lunch"),t("th",null,"Hire Date"),t("th",null,"Manager"),t("th",null,"Type"),t("th",null,"Role"),t("th",null,"Actions")])],-1)),t("tbody",null,[(i(!0),a(M,null,A(r.employees,o=>{var h;return i(),a("tr",{key:o.id},[t("td",null,[t("div",K,[t("div",B,n(l.getInitials(l.getEmployeeName(o))),1),c(" "+n(l.getEmployeeName(o)),1)])]),t("td",null,n(o.employee_id||o.id),1),t("td",null,n(o.email||((h=o.user)==null?void 0:h.email)||"N/A"),1),t("td",null,n(o.position||"N/A"),1),t("td",null,n(o.department||"N/A"),1),t("td",null,"K"+n(l.formatNumber(o.base_salary)),1),t("td",null,"K"+n(l.formatNumber(o.transport_allowance||0)),1),t("td",null,"K"+n(l.formatNumber(o.lunch_allowance||0)),1),t("td",null,n(l.formatDate(o.hire_date||o.created_at)),1),t("td",null,n(l.getManagerName(o.manager_id)),1),t("td",L,[t("span",z,n(l.formatEmploymentType(o.employment_type)),1)]),t("td",H,[t("span",{class:F(["badge",l.getRoleBadgeClass(l.getEmployeeRole(o))])},n(l.formatRole(l.getEmployeeRole(o))),3)]),t("td",null,[t("div",Y,[d.authStore.isAdmin?(i(),a("button",{key:0,onClick:y=>l.editEmployee(o),class:"btn-edit",title:"Edit"},[...e[23]||(e[23]=[t("span",{class:"icon"},"âœï¸",-1)])],8,O)):p("",!0),d.authStore.isAdmin?(i(),a("button",{key:1,onClick:y=>l.deleteEmployee(o),class:"btn-delete",title:"Delete"},[...e[24]||(e[24]=[t("span",{class:"icon"},"ðŸ—‘ï¸",-1)])],8,j)):p("",!0)])])])}),128))])]),r.employees.length===0?(i(),a("div",W,[e[26]||(e[26]=t("p",null,"No employees found",-1)),d.authStore.isAdmin?(i(),a("button",{key:0,onClick:e[2]||(e[2]=o=>r.showAddModal=!0),class:"btn-primary"}," Add First Employee ")):p("",!0)])):p("",!0)])):(i(),a("div",D," Please log in to access employee management. ")),(r.showAddModal||r.showEditModal)&&d.authStore.isAdmin?(i(),a("div",{key:5,class:"modal-overlay",onClick:e[19]||(e[19]=k((...o)=>l.closeModals&&l.closeModals(...o),["self"]))},[t("div",G,[t("div",J,[t("h2",null,n(r.showEditModal?"Edit Employee":"Add New Employee"),1),t("button",{onClick:e[3]||(e[3]=(...o)=>l.closeModals&&l.closeModals(...o)),class:"close-btn"},"âœ•")]),t("form",{onSubmit:e[18]||(e[18]=k((...o)=>l.submitForm&&l.submitForm(...o),["prevent"])),class:"modal-body"},[t("div",Q,[t("div",X,[e[27]||(e[27]=t("label",null,"First Name *",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.first_name=o),type:"text",required:"",placeholder:"Enter first name"},null,512),[[f,r.form.first_name]])]),t("div",Z,[e[28]||(e[28]=t("label",null,"Last Name *",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.last_name=o),type:"text",required:"",placeholder:"Enter last name"},null,512),[[f,r.form.last_name]])])]),r.showEditModal?p("",!0):(i(),a("div",$,[e[29]||(e[29]=t("label",null,"Email *",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.form.email=o),type:"email",required:"",placeholder:"employee@example.com"},null,512),[[f,r.form.email]])])),t("div",ee,[e[31]||(e[31]=t("label",null,"Role *",-1)),u(t("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.form.role=o),required:"",onChange:e[8]||(e[8]=(...o)=>l.onRoleChange&&l.onRoleChange(...o))},[...e[30]||(e[30]=[t("option",{value:"employee"},"Employee",-1),t("option",{value:"manager"},"Manager",-1),t("option",{value:"admin"},"Admin",-1)])],544),[[_,r.form.role]])]),t("div",te,[t("div",se,[e[32]||(e[32]=t("label",null,"Position *",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>r.form.position=o),type:"text",required:"",placeholder:"e.g., Software Developer"},null,512),[[f,r.form.position]])]),t("div",oe,[e[34]||(e[34]=t("label",null,"Department *",-1)),u(t("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>r.form.department=o),required:""},[...e[33]||(e[33]=[C('<option value="" data-v-d9bdab78>Select Department</option><option value="IT" data-v-d9bdab78>IT</option><option value="HR" data-v-d9bdab78>HR</option><option value="Finance" data-v-d9bdab78>Finance</option><option value="Sales" data-v-d9bdab78>Sales</option><option value="Marketing" data-v-d9bdab78>Marketing</option><option value="Operations" data-v-d9bdab78>Operations</option><option value="Administration" data-v-d9bdab78>Administration</option><option value="Management" data-v-d9bdab78>Management</option>',9)])],512),[[_,r.form.department]])])]),t("div",re,[t("div",le,[e[35]||(e[35]=t("label",null,"Base Salary (K) *",-1)),u(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>r.form.base_salary=o),type:"number",step:"0.01",required:"",placeholder:"0.00"},null,512),[[f,r.form.base_salary,void 0,{number:!0}]])]),t("div",ae,[e[37]||(e[37]=t("label",null,"Employment Type *",-1)),u(t("select",{"onUpdate:modelValue":e[12]||(e[12]=o=>r.form.employment_type=o),required:""},[...e[36]||(e[36]=[t("option",{value:""},"Select Type",-1),t("option",{value:"full_time"},"Full Time",-1),t("option",{value:"part_time"},"Part Time",-1),t("option",{value:"contract"},"Contract",-1)])],512),[[_,r.form.employment_type]])])]),t("div",ne,[t("div",ie,[e[38]||(e[38]=t("label",null,"Transport Allowance (K)",-1)),u(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>r.form.transport_allowance=o),type:"number",step:"0.01",placeholder:"300.00"},null,512),[[f,r.form.transport_allowance,void 0,{number:!0}]])]),t("div",me,[e[39]||(e[39]=t("label",null,"Lunch Allowance (K)",-1)),u(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>r.form.lunch_allowance=o),type:"number",step:"0.01",placeholder:"240.00"},null,512),[[f,r.form.lunch_allowance,void 0,{number:!0}]])])]),t("div",de,[t("div",ue,[e[40]||(e[40]=t("label",null,"Hire Date *",-1)),u(t("input",{"onUpdate:modelValue":e[15]||(e[15]=o=>r.form.hire_date=o),type:"date",required:""},null,512),[[f,r.form.hire_date]])]),t("div",pe,[t("label",null,[e[41]||(e[41]=c("Manager ",-1)),r.form.role==="employee"?(i(),a("span",fe,"*")):p("",!0)]),u(t("select",{"onUpdate:modelValue":e[16]||(e[16]=o=>r.form.manager_id=o),required:r.form.role==="employee",disabled:r.form.role==="manager"||r.form.role==="admin"},[e[42]||(e[42]=t("option",{value:""},"No Manager",-1)),(i(!0),a(M,null,A(r.managers,o=>(i(),a("option",{key:o.id,value:o.id},n(o.first_name)+" "+n(o.last_name)+" ("+n(o.department)+") ",9,ge))),128))],8,he),[[_,r.form.manager_id]]),r.form.role==="employee"&&r.managers.length===0?(i(),a("small",ye," No managers available. Please create a manager first. ")):p("",!0),r.form.role==="manager"||r.form.role==="admin"?(i(),a("small",ce,n(r.form.role==="admin"?"Admins":"Managers")+" don't have managers ",1)):p("",!0)])]),r.formError?(i(),a("div",_e,n(r.formError),1)):p("",!0),t("div",be,[t("button",{type:"button",onClick:e[17]||(e[17]=(...o)=>l.closeModals&&l.closeModals(...o)),class:"btn-secondary"}," Cancel "),t("button",{type:"submit",class:"btn-primary",disabled:r.submitting},n(r.submitting?"Saving...":r.showEditModal?"Update":"Add Employee"),9,ve)])],32)])])):p("",!0)])}const Ae=S(x,[["render",Ee],["__scopeId","data-v-d9bdab78"]]);export{Ae as default};
