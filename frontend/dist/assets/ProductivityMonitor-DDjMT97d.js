import{_,u as g}from"./index-C1X9tsoG.js";import{b as d,p as t,q as h,t as i,F as p,C as m,D as y,g as f,f as c,z as w}from"./vendor-Dn_KV7fh.js";const k={name:"ProductivityMonitor",setup(){return{authStore:g()}},data(){return{productivityData:[],teamOverview:null,loading:!1,error:null,retryCount:0}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(!this.authStore.isAuthenticated){this.error="Please log in to access productivity monitor.";return}if(!this.authStore.isManager){this.error="You do not have permission to access this page.";return}this.fetchProductivity()},async fetchProductivity(s=!1){var e,l;this.loading=!0,this.error=null;try{console.log("Fetching productivity data... (retry:",s,")"),console.log("Auth token:",this.authStore.token?"Present":"Missing"),console.log("User role:",this.authStore.userRole),console.log("Manager ID:",(e=this.authStore.user)==null?void 0:e.id);const r=await f.get("/api/manager/reports/productivity",{params:{manager_id:(l=this.authStore.user)==null?void 0:l.id,period:"last_30_days"}});console.log("Productivity response:",r.data),this.productivityData=r.data.employees||[],this.teamOverview=r.data.overview||null}catch(r){console.error("Fetch error:",r),console.error("Error response:",r.response),console.error("Full error:",r.toJSON?r.toJSON():r),this.handleApiError(r)}finally{this.loading=!1}},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchProductivity(!0):this.error="Max retries exceeded. Check your network or server."},handleApiError(s){var l,r,a,n;let e="An unexpected error occurred. (Likely CORS - check console)";s.code==="ERR_NETWORK"||s.message.includes("Network Error")?e="Network/CORS error: Ensure backend allows requests from localhost:3000":((l=s.response)==null?void 0:l.status)===401?(e="Your session has expired. Please log in again.",this.authStore.clearAuth(),this.$router.push({name:"login"})):((r=s.response)==null?void 0:r.status)===403?e="You do not have permission to perform this action.":e=((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||e,this.error=e},viewDetails(s){this.$router.push({name:"employee-productivity-details",params:{id:s.id}})},getInitials(s){return s?s.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"??"},formatHours(s){if(!s)return"0h";const e=Math.floor(s),l=Math.round((s-e)*60);return`${e}h ${l}m`},formatDateRange(s,e){if(!s||!e)return"N/A";const l=new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),r=new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"});return`${l} - ${r}`},getTrendClass(s){return s==="up"?"trend-up":s==="down"?"trend-down":"trend-neutral"},getTrendIcon(s){return s==="up"?"ðŸ“ˆ":s==="down"?"ðŸ“‰":"âž¡ï¸"}}},S={class:"productivity-monitor"},C={key:0,class:"error-message"},b={key:1,class:"error-message"},D={key:2,class:"loading"},P={key:3,class:"error-message"},O={key:0,class:"overview-section"},T={class:"overview-card"},M={class:"overview-metrics"},R={class:"metric"},A={class:"metric-value"},N={class:"metric"},x={class:"metric-value"},E={class:"metric"},F={class:"metric-value"},H={class:"metric"},I={class:"metric-value"},L={class:"employees-grid"},z={class:"employee-header"},U={class:"employee-avatar"},V={class:"employee-info"},Y={class:"employee-id"},B={class:"productivity-score"},q={class:"productivity-details"},J={class:"detail-row"},W={class:"detail-row"},j={class:"detail-row"},K={class:"detail-row"},G={class:"productivity-actions"},Q=["onClick"],X={key:0,class:"empty-state"};function Z(s,e,l,r,a,n){return c(),d("div",S,[e[12]||(e[12]=t("div",{class:"page-header"},[t("h1",null,"Team Productivity Monitor")],-1)),r.authStore.isAuthenticated?r.authStore.isManager?a.loading?(c(),d("div",D,[...e[1]||(e[1]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading productivity data...",-1)])])):a.error?(c(),d("div",P,[h(i(a.error)+" ",1),t("button",{onClick:e[0]||(e[0]=(...o)=>n.retryFetch&&n.retryFetch(...o)),class:"btn-primary",style:{"margin-top":"1rem"}},"Retry")])):(c(),d(p,{key:4},[a.teamOverview?(c(),d("div",O,[t("div",T,[e[6]||(e[6]=t("h3",null,"Team Overview",-1)),t("div",M,[t("div",R,[t("span",A,i(a.teamOverview.avgProductivityScore)+"%",1),e[2]||(e[2]=t("span",{class:"metric-label"},"Average Score",-1))]),t("div",N,[t("span",x,i(a.teamOverview.totalTasksCompleted),1),e[3]||(e[3]=t("span",{class:"metric-label"},"Tasks Completed",-1))]),t("div",E,[t("span",F,i(n.formatHours(a.teamOverview.totalHoursWorked)),1),e[4]||(e[4]=t("span",{class:"metric-label"},"Total Hours",-1))]),t("div",H,[t("span",I,i(a.teamOverview.completionRate)+"%",1),e[5]||(e[5]=t("span",{class:"metric-label"},"Completion Rate",-1))])])])])):m("",!0)],64)):(c(),d("div",b," You don't have permission to access this page. ")):(c(),d("div",C," Please log in to access productivity monitor. ")),t("div",L,[(c(!0),d(p,null,y(a.productivityData,o=>{var u,v;return c(),d("div",{key:o.id,class:"employee-card"},[t("div",z,[t("div",U,i(n.getInitials(o.full_name||((u=o.user)==null?void 0:u.name))),1),t("div",V,[t("h3",null,i(o.full_name||((v=o.user)==null?void 0:v.name)),1),t("p",Y,i(o.employee_id),1)]),t("div",B,[h(i(o.productivity_score)+"% ",1),t("span",{class:w(["score-trend",n.getTrendClass(o.trend)])},i(n.getTrendIcon(o.trend)),3)])]),t("div",q,[t("div",J,[e[7]||(e[7]=t("span",{class:"label"},"ðŸ“‹ Tasks:",-1)),t("span",null,i(o.tasks_completed)+" / "+i(o.total_tasks),1)]),t("div",W,[e[8]||(e[8]=t("span",{class:"label"},"â±ï¸ Hours:",-1)),t("span",null,i(n.formatHours(o.hours_worked)),1)]),t("div",j,[e[9]||(e[9]=t("span",{class:"label"},"ðŸ“Š Efficiency:",-1)),t("span",null,i(o.efficiency_rate)+"%",1)]),t("div",K,[e[10]||(e[10]=t("span",{class:"label"},"ðŸ“ˆ Period:",-1)),t("span",null,i(n.formatDateRange(o.period_start,o.period_end)),1)])]),t("div",G,[t("button",{onClick:$=>n.viewDetails(o),class:"btn-view"},"View Details",8,Q)])])}),128)),a.productivityData.length===0?(c(),d("div",X,[...e[11]||(e[11]=[t("p",null,"No productivity data available",-1),t("p",null,"Productivity tracking may not be enabled for your team yet.",-1)])])):m("",!0)])])}const st=_(k,[["render",Z],["__scopeId","data-v-a81a2d27"]]);export{st as default};
