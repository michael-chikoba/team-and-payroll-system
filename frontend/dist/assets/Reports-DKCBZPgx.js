import{_ as b,u as f}from"./index-C1X9tsoG.js";import{b as l,p as e,q as _,t as o,C as R,x as u,y as c,F as w,D as S,g,f as i}from"./vendor-Dn_KV7fh.js";const P={name:"AdminReports",setup(){return{authStore:f()}},data(){const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1),d=new Date(s.getFullYear(),s.getMonth()+1,0);return{loading:!1,generatingReport:!1,error:null,allEmployees:[],orgStats:{},generatedReports:[],currentReport:null,attendanceReportParams:{start_date:t.toISOString().split("T")[0],end_date:d.toISOString().split("T")[0],department:"all",report_type:"summary"},leaveReportParams:{start_date:t.toISOString().split("T")[0],end_date:d.toISOString().split("T")[0],leave_type:"all",status:"all"},payrollReportParams:{start_date:t.toISOString().split("T")[0],end_date:d.toISOString().split("T")[0],department:"all",status:"all"},retryCount:0}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(!this.authStore.isAuthenticated){this.error="Please log in to access admin reports.";return}if(!this.authStore.isAdmin){this.error="You do not have permission to access this page.";return}this.fetchAdminData(),this.loadGeneratedReports()},async fetchAdminData(){this.loading=!0,this.error=null;try{const s=await g.get("/api/admin/employees");this.allEmployees=s.data.data||s.data||[],this.calculateOrgStats()}catch(s){console.error("Fetch error:",s),this.handleApiError(s)}finally{this.loading=!1}},calculateOrgStats(){const s=this.allEmployees.length;new Date().toISOString().split("T")[0],this.orgStats={total_employees:s,present_today:Math.floor(s*.85),pending_leaves:Math.floor(s*.1),avg_attendance:85}},async generateAttendanceReport(){this.generatingReport=!0;try{console.log("Generating attendance report with params:",this.attendanceReportParams);const s=await g.post("/api/admin/generate/attendance",this.attendanceReportParams);if(console.log("Attendance report response:",s.data),s.data.success)this.generatedReports.unshift({id:Date.now(),type:"attendance",title:"Attendance Report",period:`${this.attendanceReportParams.start_date} to ${this.attendanceReportParams.end_date}`,generated_at:new Date().toISOString(),data:s.data.report}),this.$notify({type:"success",title:"Success",text:"Attendance report generated successfully!"});else throw new Error(s.data.message||"Failed to generate report")}catch(s){console.error("Error generating attendance report:",s),this.handleApiError(s)}finally{this.generatingReport=!1}},async generateLeaveReport(){this.generatingReport=!0;try{console.log("Generating leave report with params:",this.leaveReportParams);const s=await g.post("/api/admin/generate/leave",this.leaveReportParams);if(console.log("Leave report response:",s.data),s.data.success)this.generatedReports.unshift({id:Date.now(),type:"leave",title:"Leave Report",period:`${this.leaveReportParams.start_date} to ${this.leaveReportParams.end_date}`,generated_at:new Date().toISOString(),data:s.data.report}),this.$notify({type:"success",title:"Success",text:"Leave report generated successfully!"});else throw new Error(s.data.message||"Failed to generate report")}catch(s){console.error("Error generating leave report:",s),this.handleApiError(s)}finally{this.generatingReport=!1}},async generatePayrollReport(){this.generatingReport=!0;try{console.log("Generating payroll report with params:",this.payrollReportParams);const s=await g.post("/api/admin/generate/payroll",this.payrollReportParams);if(console.log("Payroll report response:",s.data),s.data.success)this.generatedReports.unshift({id:Date.now(),type:"payroll",title:"Payroll Report",period:`${this.payrollReportParams.start_date} to ${this.payrollReportParams.end_date}`,generated_at:new Date().toISOString(),data:s.data.report}),this.$notify({type:"success",title:"Success",text:"Payroll report generated successfully!"});else throw new Error(s.data.message||"Failed to generate report")}catch(s){console.error("Error generating payroll report:",s),this.handleApiError(s)}finally{this.generatingReport=!1}},async downloadReport(s){try{console.log("Downloading report:",s.type);const t={format:"pdf",start_date:s.data.period_start,end_date:s.data.period_end},d=await g.post(`/api/admin/download/${s.type}`,t,{responseType:"blob"}),p=window.URL.createObjectURL(new Blob([d.data])),r=document.createElement("a");r.href=p,r.setAttribute("download",`${s.type}_report_${new Date().getTime()}.pdf`),document.body.appendChild(r),r.click(),r.remove(),this.$notify({type:"success",title:"Success",text:"Report download started!"})}catch(t){console.error("Error downloading report:",t),this.handleApiError(t)}},async exportToExcel(s){try{console.log("Exporting report to Excel:",s.type);const t={format:"csv",start_date:s.data.period_start,end_date:s.data.period_end},d=await g.post(`/api/admin/download/${s.type}`,t,{responseType:"blob"}),p=window.URL.createObjectURL(new Blob([d.data])),r=document.createElement("a");r.href=p,r.setAttribute("download",`${s.type}_report_${new Date().getTime()}.csv`),document.body.appendChild(r),r.click(),r.remove(),this.$notify({type:"success",title:"Success",text:"Report exported to Excel!"})}catch(t){console.error("Error exporting to Excel:",t),this.handleApiError(t)}},viewReport(s){this.currentReport=s},loadGeneratedReports(){const s=localStorage.getItem("generatedReports");s&&(this.generatedReports=JSON.parse(s))},saveGeneratedReports(){localStorage.setItem("generatedReports",JSON.stringify(this.generatedReports))},getReportIcon(s){return{attendance:"ðŸ“Š",leave:"ðŸ“‹",payroll:"ðŸ’°"}[s]||"ðŸ“„"},formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchAdminData():this.error="Max retries exceeded. Check your network or server."},handleApiError(s){var d,p,r,n,v,y,m;let t="An unexpected error occurred.";s.code==="ERR_NETWORK"||s.message.includes("Network Error")?t="Network error: Please check your connection and try again.":((d=s.response)==null?void 0:d.status)===401?(t="Your session has expired. Please log in again.",this.authStore.clearAuth(),this.$router.push({name:"login"})):((p=s.response)==null?void 0:p.status)===403?t="You do not have permission to perform this action.":((r=s.response)==null?void 0:r.status)===404?t="Report generation endpoint not found. Please check the API routes.":((n=s.response)==null?void 0:n.status)===422?t="Invalid report parameters. Please check your inputs.":((v=s.response)==null?void 0:v.status)===500?t="Server error: Please try again later.":t=((m=(y=s.response)==null?void 0:y.data)==null?void 0:m.message)||s.message||t,this.error=t,this.$notify({type:"error",title:"Error",text:t})}},watch:{generatedReports:{handler(){this.saveGeneratedReports()},deep:!0}}},k={class:"reports-management"},A={class:"page-header"},E={class:"header-actions"},D=["disabled"],x=["disabled"],C=["disabled"],G={key:0,class:"error-message"},T={key:1,class:"error-message"},L={key:2,class:"loading"},O={key:3,class:"error-message"},I={key:4,class:"reports-dashboard"},F={class:"stats-grid"},U={class:"stat-card"},V={class:"stat-content"},N={class:"stat-value"},M={class:"stat-card"},z={class:"stat-content"},Y={class:"stat-value"},B={class:"stat-card"},q={class:"stat-content"},W={class:"stat-value"},j={class:"stat-card"},J={class:"stat-content"},K={class:"stat-value"},H={class:"report-generation-section"},Q={class:"generation-options"},X={class:"generation-option"},Z={class:"date-inputs"},$={class:"input-group"},tt={class:"input-group"},et=["disabled"],st={class:"generation-option"},rt={class:"date-inputs"},at={class:"input-group"},ot={class:"input-group"},nt=["disabled"],lt={class:"generation-option"},it={class:"date-inputs"},dt={class:"input-group"},pt={class:"input-group"},ut=["disabled"],ct={key:0,class:"generated-reports"},gt={class:"reports-list"},vt={class:"report-icon"},yt={class:"report-info"},mt={class:"report-period"},Rt={class:"report-date"},_t={class:"report-actions"},ht=["onClick"],bt=["onClick"],ft={key:1,class:"report-preview-section"},wt={class:"preview-actions"},St={class:"preview-content"},Pt={key:0},kt={class:"report-stats"},At={class:"report-stat"},Et={class:"stat-value"},Dt={class:"report-stat"},xt={class:"stat-value"},Ct={class:"report-stat"},Gt={class:"stat-value"},Tt={class:"report-stat"},Lt={class:"stat-value"},Ot={key:1},It={class:"report-stats"},Ft={class:"report-stat"},Ut={class:"stat-value"},Vt={class:"report-stat"},Nt={class:"stat-value"},Mt={class:"report-stat"},zt={class:"stat-value"},Yt={class:"report-stat"},Bt={class:"stat-value"},qt={key:2},Wt={class:"report-stats"},jt={class:"report-stat"},Jt={class:"stat-value"},Kt={class:"report-stat"},Ht={class:"stat-value"},Qt={class:"report-stat"},Xt={class:"stat-value"},Zt={class:"report-stat"},$t={class:"stat-value"};function te(s,t,d,p,r,n){var v,y,m;return i(),l("div",k,[e("div",A,[t[19]||(t[19]=e("h1",null,"Organization Reports",-1)),e("div",E,[e("button",{onClick:t[0]||(t[0]=(...a)=>n.generateAttendanceReport&&n.generateAttendanceReport(...a)),class:"btn-primary",disabled:r.generatingReport},[t[16]||(t[16]=e("span",null,"ðŸ“Š",-1)),_(" "+o(r.generatingReport?"Generating...":"Generate Attendance Report"),1)],8,D),e("button",{onClick:t[1]||(t[1]=(...a)=>n.generateLeaveReport&&n.generateLeaveReport(...a)),class:"btn-secondary",disabled:r.generatingReport},[t[17]||(t[17]=e("span",null,"ðŸ“‹",-1)),_(" "+o(r.generatingReport?"Generating...":"Generate Leave Report"),1)],8,x),e("button",{onClick:t[2]||(t[2]=(...a)=>n.generatePayrollReport&&n.generatePayrollReport(...a)),class:"btn-tertiary",disabled:r.generatingReport},[t[18]||(t[18]=e("span",null,"ðŸ’°",-1)),_(" "+o(r.generatingReport?"Generating...":"Generate Payroll Report"),1)],8,C)])]),p.authStore.isAuthenticated?p.authStore.isAdmin?r.loading?(i(),l("div",L,[...t[20]||(t[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading organization reports...",-1)])])):r.error?(i(),l("div",O,[_(o(r.error)+" ",1),e("button",{onClick:t[3]||(t[3]=(...a)=>n.retryFetch&&n.retryFetch(...a)),class:"btn-primary",style:{"margin-top":"1rem"}},"Retry")])):(i(),l("div",I,[t[62]||(t[62]=e("div",{class:"admin-info"},[e("h2",null,"ðŸ¢ Organization Overview"),e("p",{class:"admin-subtitle"},"Company-wide performance metrics and reports")],-1)),e("div",F,[e("div",U,[t[23]||(t[23]=e("div",{class:"stat-icon"},"ðŸ‘¥",-1)),e("div",V,[t[21]||(t[21]=e("h3",null,"Total Employees",-1)),e("p",N,o(r.orgStats.total_employees||0),1),t[22]||(t[22]=e("p",{class:"stat-label"},"All Staff",-1))])]),e("div",M,[t[26]||(t[26]=e("div",{class:"stat-icon"},"âœ…",-1)),e("div",z,[t[24]||(t[24]=e("h3",null,"Present Today",-1)),e("p",Y,o(r.orgStats.present_today||0),1),t[25]||(t[25]=e("p",{class:"stat-label"},"Active Employees",-1))])]),e("div",B,[t[29]||(t[29]=e("div",{class:"stat-icon"},"ðŸ“…",-1)),e("div",q,[t[27]||(t[27]=e("h3",null,"Pending Leaves",-1)),e("p",W,o(r.orgStats.pending_leaves||0),1),t[28]||(t[28]=e("p",{class:"stat-label"},"Company-Wide",-1))])]),e("div",j,[t[32]||(t[32]=e("div",{class:"stat-icon"},"ðŸ“Š",-1)),e("div",J,[t[30]||(t[30]=e("h3",null,"Avg. Attendance",-1)),e("p",K,o(r.orgStats.avg_attendance||0)+"%",1),t[31]||(t[31]=e("p",{class:"stat-label"},"This Month",-1))])])]),e("div",H,[t[45]||(t[45]=e("h2",null,"Generate Reports",-1)),e("div",Q,[e("div",X,[t[35]||(t[35]=e("h3",null,"Attendance Report",-1)),t[36]||(t[36]=e("p",null,"Generate comprehensive attendance report for selected period",-1)),e("div",Z,[e("div",$,[t[33]||(t[33]=e("label",null,"Start Date:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=a=>r.attendanceReportParams.start_date=a),class:"date-input"},null,512),[[c,r.attendanceReportParams.start_date]])]),e("div",tt,[t[34]||(t[34]=e("label",null,"End Date:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=a=>r.attendanceReportParams.end_date=a),class:"date-input"},null,512),[[c,r.attendanceReportParams.end_date]])])]),e("button",{onClick:t[6]||(t[6]=(...a)=>n.generateAttendanceReport&&n.generateAttendanceReport(...a)),class:"btn-primary",disabled:r.generatingReport},o(r.generatingReport?"Generating...":"Generate Report"),9,et)]),e("div",st,[t[39]||(t[39]=e("h3",null,"Leave Report",-1)),t[40]||(t[40]=e("p",null,"Generate leave utilization and approval reports",-1)),e("div",rt,[e("div",at,[t[37]||(t[37]=e("label",null,"Start Date:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=a=>r.leaveReportParams.start_date=a),class:"date-input"},null,512),[[c,r.leaveReportParams.start_date]])]),e("div",ot,[t[38]||(t[38]=e("label",null,"End Date:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[8]||(t[8]=a=>r.leaveReportParams.end_date=a),class:"date-input"},null,512),[[c,r.leaveReportParams.end_date]])])]),e("button",{onClick:t[9]||(t[9]=(...a)=>n.generateLeaveReport&&n.generateLeaveReport(...a)),class:"btn-secondary",disabled:r.generatingReport},o(r.generatingReport?"Generating...":"Generate Report"),9,nt)]),e("div",lt,[t[43]||(t[43]=e("h3",null,"Payroll Report",-1)),t[44]||(t[44]=e("p",null,"Generate payroll summary and tax reports",-1)),e("div",it,[e("div",dt,[t[41]||(t[41]=e("label",null,"Start Date:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=a=>r.payrollReportParams.start_date=a),class:"date-input"},null,512),[[c,r.payrollReportParams.start_date]])]),e("div",pt,[t[42]||(t[42]=e("label",null,"End Date:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[11]||(t[11]=a=>r.payrollReportParams.end_date=a),class:"date-input"},null,512),[[c,r.payrollReportParams.end_date]])])]),e("button",{onClick:t[12]||(t[12]=(...a)=>n.generatePayrollReport&&n.generatePayrollReport(...a)),class:"btn-tertiary",disabled:r.generatingReport},o(r.generatingReport?"Generating...":"Generate Report"),9,ut)])])]),r.generatedReports.length>0?(i(),l("div",ct,[t[46]||(t[46]=e("h2",null,"Recently Generated Reports",-1)),e("div",gt,[(i(!0),l(w,null,S(r.generatedReports,a=>(i(),l("div",{key:a.id,class:"report-item"},[e("div",vt,o(n.getReportIcon(a.type)),1),e("div",yt,[e("h4",null,o(a.title),1),e("p",mt,o(a.period),1),e("p",Rt,"Generated: "+o(n.formatDate(a.generated_at)),1)]),e("div",_t,[e("button",{onClick:h=>n.downloadReport(a),class:"btn-download"},"ðŸ“¥ Download",8,ht),e("button",{onClick:h=>n.viewReport(a),class:"btn-view"},"ðŸ‘ï¸ View",8,bt)])]))),128))])])):R("",!0),r.currentReport?(i(),l("div",ft,[e("h2",null,"Report Preview: "+o(r.currentReport.title),1),e("div",wt,[e("button",{onClick:t[13]||(t[13]=a=>n.downloadReport(r.currentReport)),class:"btn-primary"},"Download PDF"),e("button",{onClick:t[14]||(t[14]=a=>n.exportToExcel(r.currentReport)),class:"btn-secondary"},"Export to Excel"),e("button",{onClick:t[15]||(t[15]=a=>r.currentReport=null),class:"btn-tertiary"},"Close Preview")]),e("div",St,[r.currentReport.type==="attendance"&&r.currentReport.data?(i(),l("div",Pt,[t[51]||(t[51]=e("h3",null,"Attendance Summary",-1)),e("div",kt,[e("div",At,[t[47]||(t[47]=e("span",{class:"stat-label"},"Total Employees:",-1)),e("span",Et,o(r.currentReport.data.total_employees||0),1)]),e("div",Dt,[t[48]||(t[48]=e("span",{class:"stat-label"},"Average Attendance:",-1)),e("span",xt,o(r.currentReport.data.attendance_rate||0)+"%",1)]),e("div",Ct,[t[49]||(t[49]=e("span",{class:"stat-label"},"Total Present Days:",-1)),e("span",Gt,o(((v=r.currentReport.data.attendance_summary)==null?void 0:v.present)||0),1)]),e("div",Tt,[t[50]||(t[50]=e("span",{class:"stat-label"},"Working Days:",-1)),e("span",Lt,o(r.currentReport.data.working_days||0),1)])])])):R("",!0),r.currentReport.type==="leave"&&r.currentReport.data?(i(),l("div",Ot,[t[56]||(t[56]=e("h3",null,"Leave Summary",-1)),e("div",It,[e("div",Ft,[t[52]||(t[52]=e("span",{class:"stat-label"},"Total Leave Requests:",-1)),e("span",Ut,o(r.currentReport.data.total_leave_requests||0),1)]),e("div",Vt,[t[53]||(t[53]=e("span",{class:"stat-label"},"Approved Leaves:",-1)),e("span",Nt,o(((y=r.currentReport.data.status_breakdown)==null?void 0:y.approved)||0),1)]),e("div",Mt,[t[54]||(t[54]=e("span",{class:"stat-label"},"Pending Leaves:",-1)),e("span",zt,o(((m=r.currentReport.data.status_breakdown)==null?void 0:m.pending)||0),1)]),e("div",Yt,[t[55]||(t[55]=e("span",{class:"stat-label"},"Approval Rate:",-1)),e("span",Bt,o(r.currentReport.data.approval_rate||0)+"%",1)])])])):R("",!0),r.currentReport.type==="payroll"&&r.currentReport.data?(i(),l("div",qt,[t[61]||(t[61]=e("h3",null,"Payroll Summary",-1)),e("div",Wt,[e("div",jt,[t[57]||(t[57]=e("span",{class:"stat-label"},"Total Payroll:",-1)),e("span",Jt,"$"+o(r.currentReport.data.total_net_salary||0),1)]),e("div",Kt,[t[58]||(t[58]=e("span",{class:"stat-label"},"Employees Processed:",-1)),e("span",Ht,o(r.currentReport.data.processed_employees||0),1)]),e("div",Qt,[t[59]||(t[59]=e("span",{class:"stat-label"},"Average Salary:",-1)),e("span",Xt,"$"+o(r.currentReport.data.average_net_salary||0),1)]),e("div",Zt,[t[60]||(t[60]=e("span",{class:"stat-label"},"Total Tax:",-1)),e("span",$t,"$"+o(r.currentReport.data.total_tax_amount||0),1)])])])):R("",!0)])])):R("",!0)])):(i(),l("div",T," You don't have permission to access this page. ")):(i(),l("div",G," Please log in to access admin reports. "))])}const re=b(P,[["render",te]]);export{re as default};
