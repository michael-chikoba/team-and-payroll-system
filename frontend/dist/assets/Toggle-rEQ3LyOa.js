import{g as n,b as i,p as d,C as h,t as u,z as y,f as r}from"./vendor-CFHPe_rb.js";import{_ as f,u as k}from"./index-cgHGa_Rg.js";const g={name:"ClockToggle",setup(){return{authStore:k()}},data(){return{todayStatus:"absent",clockingIn:!1,clockingOut:!1,resetting:!1,showResetButton:!1}},computed:{attendancePrefix(){var t;return`/api/${((t=this.authStore.user)==null?void 0:t.role)||"employee"}/attendance`},buttonText(){switch(this.todayStatus){case"present":return"Clock Out";case"completed":return"Clock In (Today Completed)";default:return"Clock In"}},isClockedIn(){return this.todayStatus==="present"}},methods:{async toggleClock(){this.isClockedIn?await this.clockOut():await this.clockIn()},async clockIn(){var e,t,s,l,o,c;this.clockingIn=!0;try{const a=await n.post(`${this.attendancePrefix}/clock-in`);this.todayStatus="present",this.showResetButton=!1,this.$notify({type:"success",title:"Success",text:a.data.message||"Clocked in successfully!"}),await this.fetchAttendance(),await this.fetchTodayStatus()}catch(a){console.error("Clock-in error:",a),((e=a.response)==null?void 0:e.status)===422&&((l=(s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)!=null&&l.includes("Already clocked in"))&&(this.showResetButton=!0),this.$notify({type:"error",title:"Clock-in Failed",text:((c=(o=a.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to clock in. Please try again."}),await this.fetchTodayStatus()}finally{this.clockingIn=!1}},async clockOut(){var e,t;this.clockingOut=!0;try{const s=await n.post(`${this.attendancePrefix}/clock-out`);this.todayStatus="completed",this.showResetButton=!1,this.$notify({type:"success",title:"Success",text:s.data.message||"Clocked out successfully!"}),await this.fetchAttendance(),await this.fetchTodayStatus()}catch(s){console.error("Clock-out error:",s),this.$notify({type:"error",title:"Clock-out Failed",text:((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to clock out. Please try again."}),await this.fetchTodayStatus()}finally{this.clockingOut=!1}},async fetchAttendance(){console.log("Fetching attendance...")},async fetchTodayStatus(){var e;try{const t=await n.get(`${this.attendancePrefix}/today-status`);this.todayStatus=t.data.status||"absent",this.showResetButton=this.todayStatus==="present"&&((e=t.data.attendance)==null?void 0:e.clockOut)}catch(t){console.error("Fetch today status error:",t),this.todayStatus="absent",this.showResetButton=!1}},async forceResetStatus(){var e,t;if(confirm("This will auto-close any open attendance records. Continue?")){this.resetting=!0;try{const s=await n.post(`${this.attendancePrefix}/force-reset`);this.showResetButton=!1,this.$notify({type:"success",title:"Status Reset",text:s.data.message||"Attendance status has been reset successfully."}),await this.fetchAttendance(),await this.fetchTodayStatus()}catch(s){console.error("Reset error:",s),this.$notify({type:"error",title:"Reset Failed",text:((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to reset status. Please contact support."})}finally{this.resetting=!1}}}},mounted(){this.fetchTodayStatus()}},p={class:"clock-toggle-container"},S=["disabled"],m={key:0,class:"loading-spinner"},w={key:1},C=["disabled"];function x(e,t,s,l,o,c){return r(),i("div",p,[d("button",{class:y(["clock-toggle-btn",{"is-clocked-in":o.todayStatus==="present",loading:o.clockingIn||o.clockingOut}]),disabled:o.clockingIn||o.clockingOut,onClick:t[0]||(t[0]=(...a)=>c.toggleClock&&c.toggleClock(...a))},[o.clockingIn||o.clockingOut?(r(),i("span",m,"â³")):(r(),i("span",w,u(c.buttonText),1))],10,S),o.showResetButton?(r(),i("button",{key:0,class:"reset-btn",disabled:o.resetting,onClick:t[1]||(t[1]=(...a)=>c.forceResetStatus&&c.forceResetStatus(...a)),title:"Reset stuck attendance status"},u(o.resetting?"Resetting...":"Reset"),9,C)):h("",!0)])}const b=f(g,[["render",x],["__scopeId","data-v-c4ac53ce"]]);export{b as C};
