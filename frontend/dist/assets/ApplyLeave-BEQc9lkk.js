import{_ as g,u as b}from"./index-CUA5mSp8.js";import{b as u,p as s,t as d,q as D,v as T,C as y,x as m,A as S,s as w,y as f,g as E,f as p}from"./vendor-CFHPe_rb.js";const L={name:"ApplyLeave",setup(){return{authStore:b()}},data(){return{pageName:"Apply for Leave",form:{leaveType:"",duration:1,startDate:"",endDate:"",reason:"",attachment:null},today:new Date().toISOString().split("T")[0],submitting:!1,successMessage:null,formError:null,retryCount:0}},watch:{"form.startDate"(){this.form.startDate&&this.form.endDate<this.form.startDate&&(this.form.endDate="")},"form.endDate"(){this.form.startDate&&this.form.endDate&&this.calculateDuration()}},methods:{updateLeaveType(){console.log("Leave type selected:",this.form.leaveType),this.formError=null},calculateDuration(){if(this.form.startDate&&this.form.endDate){const t=new Date(this.form.startDate),n=new Date(this.form.endDate)-t,i=Math.ceil(n/(1e3*60*60*24))+1;this.form.duration=i}},validateForm(){this.formError=null;const t=["annual","sick","maternity","paternity","bereavement","unpaid"];if(!this.form.leaveType)return this.formError="Please select a leave type.",!1;if(!t.includes(this.form.leaveType))return this.formError=`Invalid leave type selected. Please choose from: ${t.join(", ")}`,!1;if(!this.form.startDate||!this.form.endDate)return this.formError="Please select both start and end dates.",!1;const e=new Date(this.form.startDate);return new Date(this.form.endDate)<e?(this.formError="End date must be after start date.",!1):this.form.reason.trim()?!0:(this.formError="Please provide a reason for your leave request.",!1)},async submitLeave(){if(this.validateForm()){this.submitting=!0,this.formError=null;try{const t=new FormData;t.append("type",this.form.leaveType),t.append("duration",this.form.duration),t.append("start_date",this.form.startDate),t.append("end_date",this.form.endDate),t.append("reason",this.form.reason),this.form.attachment&&t.append("attachment",this.form.attachment),console.log("Submitting leave request with payload:",{type:this.form.leaveType,duration:this.form.duration,start_date:this.form.startDate,end_date:this.form.endDate,reason:this.form.reason});for(let[n,i]of t.entries())console.log(`FormData: ${n} =`,i);const e=await E.post("/api/employee/leaves",t,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"},timeout:1e4});this.successMessage="Leave request submitted successfully! It will be reviewed by your manager.",this.$notify&&this.$notify({type:"success",title:"Success",text:"Your leave request has been submitted."}),setTimeout(()=>{this.resetForm()},3e3)}catch(t){console.error("Leave submission error:",t),this.handleApiError(t)}finally{this.submitting=!1}}},handleFileUpload(t){const e=t.target.files[0];if(e){if(e.size>5*1024*1024){this.formError="File size must be less than 5MB.",t.target.value="";return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(e.type)){this.formError="File type not allowed. Please upload PDF, DOC, DOCX, JPG, or PNG files only.",t.target.value="";return}}this.form.attachment=e,this.formError=null},resetForm(){this.form={leaveType:"",duration:1,startDate:"",endDate:"",reason:"",attachment:null},this.formError=null,this.successMessage=null,this.$refs.fileInput&&(this.$refs.fileInput.value="")},handleApiError(t){var n,i,o,a,r,c,v,h;let e="An unexpected error occurred.";if(t.code==="ERR_NETWORK")e="Network error. Please check your connection.";else if(((n=t.response)==null?void 0:n.status)===401)e="Session expired. Redirecting to login...",this.authStore.clearAuth(),setTimeout(()=>{this.$router.push({name:"login"})},2e3);else if(((i=t.response)==null?void 0:i.status)===422){const l=t.response.data;console.log("Validation errors:",l),l.errors?e=Object.values(l.errors).flat().join(". "):l.message?e=l.message:e="Please check the form for errors.",e.includes("type")&&e.includes("invalid")&&(e=`Invalid leave type. Please select one of: Annual, Sick, Maternity, Paternity, Bereavement, or Unpaid Leave. (You selected: ${this.form.leaveType})`)}else((o=t.response)==null?void 0:o.status)===403?e="You do not have permission to apply for leave.":((a=t.response)==null?void 0:a.status)===500?e="Server error. Please try again later or contact support.":e=((c=(r=t.response)==null?void 0:r.data)==null?void 0:c.message)||e;this.formError=e,console.error("API Error Details:",{status:(v=t.response)==null?void 0:v.status,data:(h=t.response)==null?void 0:h.data,message:t.message})}},mounted(){this.today=new Date().toISOString().split("T")[0]}},_={class:"apply-leave-view"},k={class:"header"},A={class:"title"},F={class:"content"},P={key:0,class:"success-message"},x={class:"form-row"},q={class:"form-group"},M={class:"form-group"},C={class:"form-row"},I={class:"form-group"},U=["min"],V={class:"form-group"},N=["min"],O={class:"form-group"},j={class:"form-group"},B={key:0,class:"file-info"},R={key:0,class:"form-error"},Y={class:"form-actions"},z=["disabled"];function G(t,e,n,i,o,a){return p(),u("div",_,[s("header",k,[s("h1",A,d(o.pageName),1),e[10]||(e[10]=s("p",{class:"subtitle"},"Submit your leave request for approval",-1))]),s("div",F,[o.successMessage?(p(),u("div",P,[D(d(o.successMessage)+" ",1),s("button",{onClick:e[0]||(e[0]=(...r)=>a.resetForm&&a.resetForm(...r)),class:"btn-secondary"},"Apply Another")])):(p(),u("form",{key:1,onSubmit:e[9]||(e[9]=T((...r)=>a.submitLeave&&a.submitLeave(...r),["prevent"])),class:"leave-form"},[s("div",x,[s("div",q,[e[12]||(e[12]=s("label",null,"Leave Type *",-1)),m(s("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.leaveType=r),required:"",onChange:e[2]||(e[2]=(...r)=>a.updateLeaveType&&a.updateLeaveType(...r))},[...e[11]||(e[11]=[w('<option value="" data-v-5b764e24>Select Leave Type</option><option value="annual" data-v-5b764e24>Annual Leave</option><option value="sick" data-v-5b764e24>Sick Leave</option><option value="maternity" data-v-5b764e24>Maternity Leave</option><option value="paternity" data-v-5b764e24>Paternity Leave</option><option value="bereavement" data-v-5b764e24>Bereavement Leave</option><option value="unpaid" data-v-5b764e24>Unpaid Leave</option>',7)])],544),[[S,o.form.leaveType]])]),s("div",M,[e[13]||(e[13]=s("label",null,"Duration (Days) *",-1)),m(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.duration=r),type:"number",min:"1",max:"30",required:"",placeholder:"e.g., 5"},null,512),[[f,o.form.duration,void 0,{number:!0}]])])]),s("div",C,[s("div",I,[e[14]||(e[14]=s("label",null,"Start Date *",-1)),m(s("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.startDate=r),type:"date",required:"",min:o.today},null,8,U),[[f,o.form.startDate]])]),s("div",V,[e[15]||(e[15]=s("label",null,"End Date *",-1)),m(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.endDate=r),type:"date",required:"",min:o.form.startDate||o.today},null,8,N),[[f,o.form.endDate]])])]),s("div",O,[e[16]||(e[16]=s("label",null,"Reason/Description *",-1)),m(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.reason=r),rows:"4",required:"",placeholder:"Provide a detailed reason for your leave request..."},null,512),[[f,o.form.reason]])]),s("div",j,[e[17]||(e[17]=s("label",null,"Attach Supporting Document (Optional)",-1)),s("input",{ref:"fileInput",type:"file",accept:".pdf,.doc,.docx,.jpg,.png",onChange:e[7]||(e[7]=(...r)=>a.handleFileUpload&&a.handleFileUpload(...r))},null,544),o.form.attachment?(p(),u("p",B,"Selected: "+d(o.form.attachment.name),1)):y("",!0)]),o.formError?(p(),u("div",R,d(o.formError),1)):y("",!0),s("div",Y,[s("button",{type:"button",onClick:e[8]||(e[8]=(...r)=>a.resetForm&&a.resetForm(...r)),class:"btn-secondary"}," Cancel "),s("button",{type:"submit",class:"btn-primary",disabled:o.submitting},d(o.submitting?"Submitting...":"Submit Leave Request"),9,z)])],32))])])}const X=g(L,[["render",G],["__scopeId","data-v-5b764e24"]]);export{X as default};
