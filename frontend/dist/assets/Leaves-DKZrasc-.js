import{_ as P,u as C}from"./index-cgHGa_Rg.js";import{b as o,p as t,t as i,q as c,z as v,C as p,a as h,F as m,D as f,e as L,g as b,f as u}from"./vendor-CFHPe_rb.js";const k={name:"Leaves",components:{},setup(){return{authStore:C()}},data(){return{pageName:"My Leaves",activeTab:"pending",pendingLeaves:[],leaveHistory:[],pendingCurrentPage:1,historyCurrentPage:1,itemsPerPage:10,loading:!1,error:null,retryCount:0}},mounted(){this.fetchLeaves()},methods:{getPaginatedPending(){const s=(this.pendingCurrentPage-1)*this.itemsPerPage,e=s+this.itemsPerPage;return this.pendingLeaves.slice(s,e)},getPaginatedHistory(){const s=(this.historyCurrentPage-1)*this.itemsPerPage,e=s+this.itemsPerPage;return this.leaveHistory.slice(s,e)},async fetchLeaves(s=!1){this.loading=!0,this.error=null;try{console.log("Fetching leaves... (retry:",s,")");const e=await b.get("/api/employee/leaves");console.log("Leaves API response:",e.data);const d=e.data.data||e.data||[];this.pendingLeaves=d.filter(l=>l.status==="pending"||l.status==="under_review"),this.leaveHistory=d.filter(l=>l.status!=="pending"&&l.status!=="under_review"),console.log("Pending leaves:",this.pendingLeaves),console.log("Leave history:",this.leaveHistory)}catch(e){console.error("Leaves fetch error:",e),this.handleApiError(e)}finally{this.loading=!1}},async cancelLeave(s){var e,d;if(confirm("Are you sure you want to cancel this leave request?"))try{const l=await b.post(`/api/employee/leaves/${s}/cancel`);await this.fetchLeaves(),this.$notify({type:"success",title:"Success",text:l.data.message||"Leave request cancelled successfully!"})}catch(l){console.error("Cancel leave error:",l),this.$notify({type:"error",title:"Cancel Failed",text:((d=(e=l.response)==null?void 0:e.data)==null?void 0:d.message)||"Failed to cancel leave request. Please try again."})}},viewDetails(s){this.$router.push({name:"leave-details",params:{id:s}})},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchLeaves(!0):this.error="Max retries exceeded. Please refresh the page."},handleApiError(s){var d,l,a,r,g;let e="An unexpected error occurred.";s.code==="ERR_NETWORK"||s.message.includes("Network Error")?e="Network error. Check your connection.":((d=s.response)==null?void 0:d.status)===401?(e="Session expired. Redirecting to login...",this.authStore.clearAuth(),this.$router.push({name:"login"})):((l=s.response)==null?void 0:l.status)===403?e="Access denied.":((a=s.response)==null?void 0:a.status)===404?e="Leave data not found. The endpoint may not be available.":e=((g=(r=s.response)==null?void 0:r.data)==null?void 0:g.message)||e,this.error=e},formatLeaveType(s){return{annual:"Annual",sick:"Sick",maternity:"Maternity",paternity:"Paternity",bereavement:"Bereavement",unpaid:"Unpaid",casual:"Casual",emergency:"Emergency"}[s]||s},formatStatus(s){return{pending:"Pending",approved:"Approved",rejected:"Rejected",cancelled:"Cancelled",under_review:"Under Review"}[s]||s},formatDateRange(s,e){return`${this.formatDate(s)} - ${this.formatDate(e)}`},formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},truncateText(s){return s?s.length>50?s.substring(0,50)+"...":s:""}}},_={class:"leaves-view"},w={class:"header"},D={class:"header-content"},A={class:"title"},T={class:"tabs-container"},S={class:"tabs"},N={class:"content"},R={key:0,class:"section"},H={key:0,class:"empty-state"},x={key:1,class:"table-container"},F={class:"leaves-table"},q={class:"reason-cell"},E=["onClick"],B=["onClick"],M={key:1,class:"section"},V={key:0,class:"empty-state"},U={key:1,class:"table-container"},j={class:"leaves-table"},z={key:2,class:"loading"},I={key:3,class:"error-message"};function K(s,e,d,l,a,r){const g=L("pagination");return u(),o("div",_,[t("header",w,[t("div",D,[t("h1",A,i(a.pageName),1),e[7]||(e[7]=t("p",{class:"subtitle"},"Manage your leave requests and view approval history",-1))]),t("button",{onClick:e[0]||(e[0]=n=>s.$router.push("/employee/apply-leave")),class:"apply-btn"},[...e[8]||(e[8]=[t("i",{class:"icon"},"+",-1),c(" Apply for Leave ",-1)])])]),t("div",T,[t("div",S,[t("button",{onClick:e[1]||(e[1]=n=>a.activeTab="pending"),class:v(["tab-btn",{active:a.activeTab==="pending"}])},[e[9]||(e[9]=t("i",{class:"icon-clock"},null,-1)),c(" Pending Requests ("+i(r.getPaginatedPending().length)+") ",1)],2),t("button",{onClick:e[2]||(e[2]=n=>a.activeTab="history"),class:v(["tab-btn",{active:a.activeTab==="history"}])},[e[10]||(e[10]=t("i",{class:"icon-history"},null,-1)),c(" Leave History ("+i(r.getPaginatedHistory().length)+") ",1)],2)]),e[11]||(e[11]=t("div",{class:"tab-indicator"},null,-1))]),t("div",N,[a.activeTab==="pending"?(u(),o("div",R,[a.pendingLeaves.length===0?(u(),o("div",H,[e[12]||(e[12]=t("i",{class:"icon-empty"},null,-1)),e[13]||(e[13]=t("p",null,"No pending leave requests.",-1)),t("button",{onClick:e[3]||(e[3]=n=>s.$router.push("/employee/apply-leave")),class:"btn-primary"},"Apply for Leave")])):(u(),o("div",x,[t("table",F,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"Type"),t("th",null,"Dates"),t("th",null,"Duration"),t("th",null,"Reason"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(u(!0),o(m,null,f(r.getPaginatedPending(),n=>(u(),o("tr",{key:n.id},[t("td",null,i(r.formatLeaveType(n.leave_type)),1),t("td",null,i(r.formatDateRange(n.start_date,n.end_date)),1),t("td",null,i(n.duration)+" days",1),t("td",q,i(r.truncateText(n.reason)),1),t("td",null,[t("span",{class:v(["status-badge",n.status.toLowerCase()])},i(r.formatStatus(n.status)),3)]),t("td",null,[n.status==="pending"?(u(),o("button",{key:0,onClick:y=>r.cancelLeave(n.id),class:"action-btn cancel"},[...e[14]||(e[14]=[t("i",{class:"icon-cancel"},null,-1),c(" Cancel ",-1)])],8,E)):p("",!0),t("button",{onClick:y=>r.viewDetails(n.id),class:"action-btn view"},[...e[15]||(e[15]=[t("i",{class:"icon-eye"},null,-1),c(" View ",-1)])],8,B)])]))),128))])]),h(g,{"current-page":a.pendingCurrentPage,"total-items":a.pendingLeaves.length,"items-per-page":a.itemsPerPage,onPageChange:e[4]||(e[4]=n=>a.pendingCurrentPage=n)},null,8,["current-page","total-items","items-per-page"])]))])):p("",!0),a.activeTab==="history"?(u(),o("div",M,[a.leaveHistory.length===0?(u(),o("div",V,[...e[17]||(e[17]=[t("i",{class:"icon-empty"},null,-1),t("p",null,"No leave history available.",-1)])])):(u(),o("div",U,[t("table",j,[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",null,"Type"),t("th",null,"Dates"),t("th",null,"Duration"),t("th",null,"Status"),t("th",null,"Approved By"),t("th",null,"Action Date")])],-1)),t("tbody",null,[(u(!0),o(m,null,f(r.getPaginatedHistory(),n=>{var y;return u(),o("tr",{key:n.id},[t("td",null,i(r.formatLeaveType(n.leave_type)),1),t("td",null,i(r.formatDateRange(n.start_date,n.end_date)),1),t("td",null,i(n.duration)+" days",1),t("td",null,[t("span",{class:v(["status-badge",n.status.toLowerCase()])},i(r.formatStatus(n.status)),3)]),t("td",null,i(n.approved_by||((y=n.approver)==null?void 0:y.name)||"N/A"),1),t("td",null,i(r.formatDate(n.updated_at||n.action_date)),1)])}),128))])]),h(g,{"current-page":a.historyCurrentPage,"total-items":a.leaveHistory.length,"items-per-page":a.itemsPerPage,onPageChange:e[5]||(e[5]=n=>a.historyCurrentPage=n)},null,8,["current-page","total-items","items-per-page"])]))])):p("",!0),a.loading?(u(),o("div",z,[...e[19]||(e[19]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading leave records...",-1)])])):p("",!0),a.error?(u(),o("div",I,[c(i(a.error)+" ",1),t("button",{onClick:e[6]||(e[6]=(...n)=>r.retryFetch&&r.retryFetch(...n)),class:"btn-primary"},"Retry")])):p("",!0)])])}const G=P(k,[["render",K],["__scopeId","data-v-10b67971"]]);export{G as default};
