import{_ as D,u as R}from"./index-Djdf6BKf.js";import{b as c,p as s,s as A,t as l,F as w,C,a as g,w as y,e as M,g as m,f as u}from"./vendor-COruVTVJ.js";const P={name:"ManagerDashboard",setup(){return{authStore:R()}},data(){return{overview:{teamSize:0,pendingLeaves:0,attendanceRate:0,totalHours:0},attendanceSummary:null,pendingLeaves:[],loading:!1,error:null,debugInfo:null,retryCount:0,today:new Date().toISOString().split("T")[0]}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(console.log("=== Manager Dashboard Initialization ==="),console.log("Authenticated:",this.authStore.isAuthenticated),console.log("Is Manager:",this.authStore.isManager),console.log("User:",this.authStore.user),console.log("Token exists:",!!this.authStore.token),!this.authStore.isAuthenticated){this.error="Please log in to access the dashboard.";return}if(!this.authStore.isManager){this.error="You do not have permission to access this page.";return}this.fetchDashboardData()},async fetchDashboardData(t=!1){var e,o,i,a,d,p,r,v,h;this.loading=!0,this.error=null,this.debugInfo=null;try{console.log("=== Fetching Manager Dashboard Data ==="),console.log("Retry attempt:",t?this.retryCount:"Initial"),console.log("Base URL:",m.defaults.baseURL),console.log("Auth token present:",!!this.authStore.token),console.log("User ID:",(e=this.authStore.user)==null?void 0:e.id),console.log("User role:",(o=this.authStore.user)==null?void 0:o.role);const[n,_]=await Promise.all([m.get("/api/dashboard"),m.get("/api/manager/attendance",{params:{date:this.today}})]);if(console.log("=== Dashboard Response ==="),console.log("Status:",n.status),console.log("Role:",n.data.role),console.log("=== Attendance Response ==="),console.log("Status:",_.status),console.log("Attendance data:",_.data),n.data.role!=="manager")throw new Error(`Expected manager role but got: ${n.data.role}`);const f=n.data.stats||{},L=f.team_productivity||{},b=_.data.attendances||[],k=f.team_size||0;console.log("ðŸ“Š Processing attendance data:",{teamSize:k,attendanceDataCount:b.length,rawAttendanceData:b});const S=this.calculateAttendanceMetrics(b,k);this.overview={teamSize:k,pendingLeaves:f.pending_leave_approvals||0,attendanceRate:S.attendanceRate,totalHours:Math.round(L.total_hours||0)},this.attendanceSummary=S.summary,this.pendingLeaves=n.data.pending_leaves||[],console.log("=== Data Mapped Successfully ==="),console.log("Overview:",this.overview),console.log("Attendance Summary:",this.attendanceSummary),console.log("Pending leaves count:",this.pendingLeaves.length),this.retryCount=0}catch(n){console.error("=== Dashboard Fetch Error ==="),console.error("Error type:",n.name),console.error("Error message:",n.message),console.error("Error code:",n.code),console.error("Response status:",(i=n.response)==null?void 0:i.status),console.error("Response data:",(a=n.response)==null?void 0:a.data),console.error("Full error:",n),this.debugInfo={errorType:n.name,errorMessage:n.message,errorCode:n.code,responseStatus:(d=n.response)==null?void 0:d.status,responseData:(p=n.response)==null?void 0:p.data,requestUrl:(r=n.config)==null?void 0:r.url,requestMethod:(v=n.config)==null?void 0:v.method,hasToken:!!this.authStore.token,userRole:(h=this.authStore.user)==null?void 0:h.role,baseURL:m.defaults.baseURL},this.handleApiError(n)}finally{this.loading=!1}},calculateAttendanceMetrics(t,e){const o={present:0,absent:0,late:0,onLeave:0};if(!t||!Array.isArray(t))return{summary:o,attendanceRate:0};t.forEach(d=>{var r;switch(((r=d.status)==null?void 0:r.toLowerCase())||"absent"){case"present":case"completed":o.present++;break;case"absent":o.absent++;break;case"late":o.late++;break;case"on_leave":o.onLeave++;break;default:o.absent++}});const i=o.present+o.late,a=e>0?Math.round(i/e*100):0;return console.log("ðŸ“Š Calculated Attendance Metrics:",{summary:o,presentAndLateCount:i,teamSize:e,attendanceRate:a}),{summary:o,attendanceRate:a}},retryFetch(){this.retryCount++,console.log("Retry attempt:",this.retryCount),this.retryCount<=3?this.fetchDashboardData(!0):this.error="Max retries exceeded. Please check your connection and try again later."},handleApiError(t){var o,i,a,d,p,r,v;let e="An unexpected error occurred.";if(t.code==="ERR_NETWORK"||t.message.includes("Network Error"))e="Network error: Cannot connect to the server. Please check if the backend is running.";else if(((o=t.response)==null?void 0:o.status)===401)e="Authentication failed. Your session may have expired. Please log in again.",setTimeout(()=>{this.authStore.clearAuth(),this.$router.push({name:"login"})},2e3);else if(((i=t.response)==null?void 0:i.status)===403)e="Access denied. You do not have permission to view this dashboard.";else if(((a=t.response)==null?void 0:a.status)===404){const h=(d=t.config)==null?void 0:d.url;h!=null&&h.includes("/api/manager/attendance")?e="Attendance endpoint not found. Please verify the API route exists: /api/manager/attendance":e="Dashboard endpoint not found. Please verify the API route exists: /api/dashboard"}else((p=t.response)==null?void 0:p.status)===500?e="Server error. Please contact support if this persists.":e=((v=(r=t.response)==null?void 0:r.data)==null?void 0:v.message)||t.message||e;this.error=e},async approveLeave(t){var e,o;try{await m.post(`/api/manager/leaves/${t}/approve`),alert("Leave approved successfully!"),this.fetchDashboardData()}catch(i){console.error("Approve leave error:",i),alert("Failed to approve leave: "+(((o=(e=i.response)==null?void 0:e.data)==null?void 0:o.message)||i.message))}},async rejectLeave(t){var o,i;const e=prompt("Please provide a reason for rejection:");if(e)try{await m.post(`/api/manager/leaves/${t}/reject`,{reason:e}),alert("Leave rejected."),this.fetchDashboardData()}catch(a){console.error("Reject leave error:",a),alert("Failed to reject leave: "+(((i=(o=a.response)==null?void 0:o.data)==null?void 0:i.message)||a.message))}},formatLeaveType(t){return t?t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"N/A"},formatDate(t){if(!t)return"N/A";try{return new Date(t.includes("T")?t:t+"T00:00:00").toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})}catch{return t}}}},T={class:"manager-dashboard"},E={key:0,class:"error-message"},x={key:1,class:"error-message"},I={key:2,class:"loading"},q={key:3,class:"error-message"},U={key:0,class:"error-details"},j={key:4,class:"dashboard-content"},F={class:"metrics-section"},N={class:"metrics-grid"},z={class:"metric-card"},B={class:"metric-value"},H={class:"metric-card"},O={class:"metric-value"},V={class:"metric-card"},Y={class:"metric-value"},K={class:"metric-card"},Q={class:"metric-value"},W={key:0,class:"attendance-summary-section"},G={class:"attendance-header"},J={class:"attendance-date"},X={class:"attendance-stats"},Z={class:"attendance-stat present"},$={class:"stat-value"},ee={class:"attendance-stat absent"},se={class:"stat-value"},te={class:"attendance-stat late"},ae={class:"stat-value"},oe={class:"attendance-stat leave"},ne={class:"stat-value"},re={class:"activities-section"},ie={key:0,class:"pending-leaves-list"},le={class:"leave-header"},de={class:"employee-info"},ce={class:"employee-name"},ue={class:"leave-type"},pe={class:"leave-dates"},he={class:"leave-details"},ve={class:"leave-reason"},me={class:"leave-days"},ge={class:"leave-actions"},ye=["onClick"],_e=["onClick"],fe={key:1,class:"empty-state"},be={class:"quick-links-section"},ke={class:"quick-links-grid"};function Se(t,e,o,i,a,d){const p=M("router-link");return u(),c("div",T,[e[25]||(e[25]=s("div",{class:"page-header"},[s("h1",null,"Manager Dashboard")],-1)),i.authStore.isAuthenticated?i.authStore.isManager?a.loading?(u(),c("div",I,[...e[1]||(e[1]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading dashboard...",-1)])])):a.error?(u(),c("div",q,[e[3]||(e[3]=s("h3",null,"Error Loading Dashboard",-1)),s("p",null,l(a.error),1),a.debugInfo?(u(),c("div",U,[s("details",null,[e[2]||(e[2]=s("summary",null,"Debug Information (click to expand)",-1)),s("pre",null,l(a.debugInfo),1)])])):A("",!0),s("button",{onClick:e[0]||(e[0]=(...r)=>d.retryFetch&&d.retryFetch(...r)),class:"btn-primary"},"Retry")])):(u(),c("div",j,[s("div",F,[e[12]||(e[12]=s("h2",null,"Team Metrics",-1)),s("div",N,[s("div",z,[e[4]||(e[4]=s("div",{class:"metric-icon"},"ðŸ‘¥",-1)),s("div",B,l(a.overview.teamSize),1),e[5]||(e[5]=s("div",{class:"metric-label"},"Team Members",-1))]),s("div",H,[e[6]||(e[6]=s("div",{class:"metric-icon"},"â°",-1)),s("div",O,l(a.overview.pendingLeaves),1),e[7]||(e[7]=s("div",{class:"metric-label"},"Pending Leaves",-1))]),s("div",V,[e[8]||(e[8]=s("div",{class:"metric-icon"},"ðŸ“Š",-1)),s("div",Y,l(a.overview.attendanceRate)+"%",1),e[9]||(e[9]=s("div",{class:"metric-label"},"Attendance Rate",-1))]),s("div",K,[e[10]||(e[10]=s("div",{class:"metric-icon"},"â±ï¸",-1)),s("div",Q,l(a.overview.totalHours),1),e[11]||(e[11]=s("div",{class:"metric-label"},"Total Team Hours",-1))])])]),a.attendanceSummary?(u(),c("div",W,[s("div",G,[e[13]||(e[13]=s("h2",null,"Today's Attendance",-1)),s("span",J,l(d.formatDate(a.today)),1)]),s("div",X,[s("div",Z,[s("span",$,l(a.attendanceSummary.present||0),1),e[14]||(e[14]=s("span",{class:"stat-label"},"Present",-1))]),s("div",ee,[s("span",se,l(a.attendanceSummary.absent||0),1),e[15]||(e[15]=s("span",{class:"stat-label"},"Absent",-1))]),s("div",te,[s("span",ae,l(a.attendanceSummary.late||0),1),e[16]||(e[16]=s("span",{class:"stat-label"},"Late",-1))]),s("div",oe,[s("span",ne,l(a.attendanceSummary.onLeave||0),1),e[17]||(e[17]=s("span",{class:"stat-label"},"On Leave",-1))])])])):A("",!0),s("div",re,[e[19]||(e[19]=s("h2",null,"Pending Leave Approvals",-1)),a.pendingLeaves.length>0?(u(),c("div",ie,[(u(!0),c(w,null,C(a.pendingLeaves,r=>{var v,h;return u(),c("div",{key:r.id,class:"leave-item"},[s("div",le,[s("div",de,[s("span",ce,l(((h=(v=r.employee)==null?void 0:v.user)==null?void 0:h.name)||"Unknown Employee"),1),s("span",ue,l(d.formatLeaveType(r.type)),1)]),s("span",pe,l(d.formatDate(r.start_date))+" - "+l(d.formatDate(r.end_date)),1)]),s("div",he,[s("p",ve,l(r.reason||"No reason provided"),1),s("span",me,l(r.number_of_days||0)+" days",1)]),s("div",ge,[s("button",{onClick:n=>d.approveLeave(r.id),class:"btn-approve"},"âœ“ Approve",8,ye),s("button",{onClick:n=>d.rejectLeave(r.id),class:"btn-reject"},"âœ— Reject",8,_e)])])}),128))])):(u(),c("div",fe,[...e[18]||(e[18]=[s("p",null,"âœ… No pending leave approvals",-1)])]))]),s("div",be,[e[24]||(e[24]=s("h2",null,"Quick Actions",-1)),s("div",ke,[g(p,{to:"/manager/employees",class:"quick-link-card"},{default:y(()=>[...e[20]||(e[20]=[s("div",{class:"quick-link-icon"},"ðŸ‘¨â€ðŸ’¼",-1),s("span",null,"View Team",-1)])]),_:1}),g(p,{to:"/manager/leave-approvals",class:"quick-link-card"},{default:y(()=>[...e[21]||(e[21]=[s("div",{class:"quick-link-icon"},"ðŸ“…",-1),s("span",null,"Leave Approvals",-1)])]),_:1}),g(p,{to:"/manager/attendance",class:"quick-link-card"},{default:y(()=>[...e[22]||(e[22]=[s("div",{class:"quick-link-icon"},"ðŸ“ˆ",-1),s("span",null,"Attendance Report",-1)])]),_:1}),g(p,{to:"/manager/reports/team",class:"quick-link-card"},{default:y(()=>[...e[23]||(e[23]=[s("div",{class:"quick-link-icon"},"ðŸ“‹",-1),s("span",null,"Team Reports",-1)])]),_:1})])])])):(u(),c("div",x," You don't have permission to access this page. ")):(u(),c("div",E," Please log in to access the dashboard. "))])}const De=D(P,[["render",Se],["__scopeId","data-v-217e9803"]]);export{De as default};
