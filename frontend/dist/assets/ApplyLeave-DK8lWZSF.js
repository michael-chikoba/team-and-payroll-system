import{_ as g,u as b}from"./index-C1X9tsoG.js";import{b as u,p as s,t as i,q as D,v as T,C as v,x as p,A as S,s as w,y as f,g as L,f as d}from"./vendor-Dn_KV7fh.js";const E={name:"ApplyLeave",setup(){return{authStore:b()}},data(){return{pageName:"Apply for Leave",form:{leaveType:"",duration:1,startDate:"",endDate:"",reason:"",attachment:null},today:new Date().toISOString().split("T")[0],submitting:!1,successMessage:null,formError:null,retryCount:0,debugMode:!1}},computed:{debugData(){return{formData:{type:this.form.leaveType,duration:this.form.duration,start_date:this.form.startDate,end_date:this.form.endDate,reason:this.form.reason,attachment:this.form.attachment?this.form.attachment.name:null},validation:{validLeaveTypes:["Annual","sick","maternity","paternity","bereavement","unpaid"],currentType:this.form.leaveType,isValidType:["annual","sick","maternity","paternity","bereavement","unpaid"].includes(this.form.leaveType)}}}},watch:{"form.startDate"(){this.form.startDate&&this.form.endDate<this.form.startDate&&(this.form.endDate="")},"form.endDate"(){this.form.startDate&&this.form.endDate&&this.calculateDuration()}},methods:{updateLeaveType(){console.log("Leave type selected:",this.form.leaveType),this.formError=null},calculateDuration(){if(this.form.startDate&&this.form.endDate){const t=new Date(this.form.startDate),n=new Date(this.form.endDate)-t,l=Math.ceil(n/(1e3*60*60*24))+1;this.form.duration=l}},validateForm(){this.formError=null;const t=["annual","sick","maternity","paternity","bereavement","unpaid"];if(!this.form.leaveType)return this.formError="Please select a leave type.",!1;if(!t.includes(this.form.leaveType))return this.formError=`Invalid leave type selected. Please choose from: ${t.join(", ")}`,!1;if(!this.form.startDate||!this.form.endDate)return this.formError="Please select both start and end dates.",!1;const e=new Date(this.form.startDate);return new Date(this.form.endDate)<e?(this.formError="End date must be after start date.",!1):this.form.reason.trim()?!0:(this.formError="Please provide a reason for your leave request.",!1)},async submitLeave(){if(this.validateForm()){this.submitting=!0,this.formError=null;try{const t=new FormData;t.append("type",this.form.leaveType),t.append("duration",this.form.duration),t.append("start_date",this.form.startDate),t.append("end_date",this.form.endDate),t.append("reason",this.form.reason),this.form.attachment&&t.append("attachment",this.form.attachment),console.log("Submitting leave request with payload:",{type:this.form.leaveType,duration:this.form.duration,start_date:this.form.startDate,end_date:this.form.endDate,reason:this.form.reason});for(let[n,l]of t.entries())console.log(`FormData: ${n} =`,l);const e=await L.post("/api/employee/leaves",t,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"},timeout:1e4});console.log("Leave request submitted successfully:",e.data),this.successMessage="Leave request submitted successfully! It will be reviewed by your manager.",this.$notify&&this.$notify({type:"success",title:"Success",text:"Your leave request has been submitted."}),setTimeout(()=>{this.resetForm()},3e3)}catch(t){console.error("Leave submission error:",t),this.handleApiError(t)}finally{this.submitting=!1}}},handleFileUpload(t){const e=t.target.files[0];if(e){if(e.size>5*1024*1024){this.formError="File size must be less than 5MB.",t.target.value="";return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(e.type)){this.formError="File type not allowed. Please upload PDF, DOC, DOCX, JPG, or PNG files only.",t.target.value="";return}}this.form.attachment=e,this.formError=null},resetForm(){this.form={leaveType:"",duration:1,startDate:"",endDate:"",reason:"",attachment:null},this.formError=null,this.successMessage=null,this.debugMode=!1,this.$refs.fileInput&&(this.$refs.fileInput.value="")},toggleDebug(){this.debugMode=!this.debugMode},handleApiError(t){var n,l,o,a,r,c,h,y;let e="An unexpected error occurred.";if(t.code==="ERR_NETWORK")e="Network error. Please check your connection.";else if(((n=t.response)==null?void 0:n.status)===401)e="Session expired. Redirecting to login...",this.authStore.clearAuth(),setTimeout(()=>{this.$router.push({name:"login"})},2e3);else if(((l=t.response)==null?void 0:l.status)===422){const m=t.response.data;console.log("Validation errors:",m),m.errors?e=Object.values(m.errors).flat().join(". "):m.message?e=m.message:e="Please check the form for errors.",e.includes("type")&&e.includes("invalid")&&(e=`Invalid leave type. Please select one of: Annual, Sick, Maternity, Paternity, Bereavement, or Unpaid Leave. (You selected: ${this.form.leaveType})`)}else((o=t.response)==null?void 0:o.status)===403?e="You do not have permission to apply for leave.":((a=t.response)==null?void 0:a.status)===500?e="Server error. Please try again later or contact support.":e=((c=(r=t.response)==null?void 0:r.data)==null?void 0:c.message)||e;this.formError=e,console.error("API Error Details:",{status:(h=t.response)==null?void 0:h.status,data:(y=t.response)==null?void 0:y.data,message:t.message})}},mounted(){this.today=new Date().toISOString().split("T")[0],console.log("Available leave types:",["Annual","sick","maternity","paternity","bereavement","unpaid"])}},k={class:"apply-leave-view"},_={class:"header"},A={class:"title"},M={class:"content"},F={key:0,class:"success-message"},P={class:"form-row"},x={class:"form-group"},q={class:"help-text"},C={class:"form-group"},I={class:"form-row"},V={class:"form-group"},N=["min"],U={class:"form-group"},O=["min"],j={class:"form-group"},B={class:"form-group"},R={key:0,class:"file-info"},Y={key:0,class:"form-error"},z={key:1,class:"debug-info"},G={class:"form-actions"},H=["disabled"];function J(t,e,n,l,o,a){return d(),u("div",k,[s("header",_,[s("h1",A,i(o.pageName),1),e[11]||(e[11]=s("p",{class:"subtitle"},"Submit your leave request for approval",-1))]),s("div",M,[o.successMessage?(d(),u("div",F,[D(i(o.successMessage)+" ",1),s("button",{onClick:e[0]||(e[0]=(...r)=>a.resetForm&&a.resetForm(...r)),class:"btn-secondary"},"Apply Another")])):(d(),u("form",{key:1,onSubmit:e[10]||(e[10]=T((...r)=>a.submitLeave&&a.submitLeave(...r),["prevent"])),class:"leave-form"},[s("div",P,[s("div",x,[e[13]||(e[13]=s("label",null,"Leave Type *",-1)),p(s("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.leaveType=r),required:"",onChange:e[2]||(e[2]=(...r)=>a.updateLeaveType&&a.updateLeaveType(...r))},[...e[12]||(e[12]=[w('<option value="" data-v-99816517>Select Leave Type</option><option value="annual" data-v-99816517>Annual Leave</option><option value="sick" data-v-99816517>Sick Leave</option><option value="maternity" data-v-99816517>Maternity Leave</option><option value="paternity" data-v-99816517>Paternity Leave</option><option value="bereavement" data-v-99816517>Bereavement Leave</option><option value="unpaid" data-v-99816517>Unpaid Leave</option>',7)])],544),[[S,o.form.leaveType]]),s("small",q,"Selected value: "+i(o.form.leaveType||"None"),1)]),s("div",C,[e[14]||(e[14]=s("label",null,"Duration (Days) *",-1)),p(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.duration=r),type:"number",min:"1",max:"30",required:"",placeholder:"e.g., 5"},null,512),[[f,o.form.duration,void 0,{number:!0}]])])]),s("div",I,[s("div",V,[e[15]||(e[15]=s("label",null,"Start Date *",-1)),p(s("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.startDate=r),type:"date",required:"",min:o.today},null,8,N),[[f,o.form.startDate]])]),s("div",U,[e[16]||(e[16]=s("label",null,"End Date *",-1)),p(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.endDate=r),type:"date",required:"",min:o.form.startDate||o.today},null,8,O),[[f,o.form.endDate]])])]),s("div",j,[e[17]||(e[17]=s("label",null,"Reason/Description *",-1)),p(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.reason=r),rows:"4",required:"",placeholder:"Provide a detailed reason for your leave request..."},null,512),[[f,o.form.reason]])]),s("div",B,[e[18]||(e[18]=s("label",null,"Attach Supporting Document (Optional)",-1)),s("input",{ref:"fileInput",type:"file",accept:".pdf,.doc,.docx,.jpg,.png",onChange:e[7]||(e[7]=(...r)=>a.handleFileUpload&&a.handleFileUpload(...r))},null,544),o.form.attachment?(d(),u("p",R,"Selected: "+i(o.form.attachment.name),1)):v("",!0)]),o.formError?(d(),u("div",Y,i(o.formError),1)):v("",!0),o.debugMode?(d(),u("div",z,[e[19]||(e[19]=s("h4",null,"Debug Information:",-1)),s("pre",null,i(a.debugData),1)])):v("",!0),s("div",G,[s("button",{type:"button",onClick:e[8]||(e[8]=(...r)=>a.resetForm&&a.resetForm(...r)),class:"btn-secondary"}," Cancel "),s("button",{type:"button",onClick:e[9]||(e[9]=(...r)=>a.toggleDebug&&a.toggleDebug(...r)),class:"btn-debug"},i(o.debugMode?"Hide Debug":"Show Debug"),1),s("button",{type:"submit",class:"btn-primary",disabled:o.submitting},i(o.submitting?"Submitting...":"Submit Leave Request"),9,H)])],32))])])}const Q=g(E,[["render",J],["__scopeId","data-v-99816517"]]);export{Q as default};
