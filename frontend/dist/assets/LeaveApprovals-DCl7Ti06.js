import{_ as w,u as L}from"./index-C1X9tsoG.js";import{b as i,p as s,C as j,q as b,t as l,F as C,D as S,v as A,x as q,y as M,g as u,f as n,z as D}from"./vendor-Dn_KV7fh.js";const N={name:"LeaveApprovals",setup(){return{authStore:L()}},data(){return{leaveRequests:[],loading:!1,error:null,retryCount:0,processing:!1,showRejectDialog:!1,selectedRequest:null,rejectNotes:""}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(!this.authStore.isAuthenticated){this.error="Please log in to access leave approvals.";return}if(!this.authStore.isManager){this.error="You do not have permission to access this page.";return}this.fetchLeaveRequests()},async fetchLeaveRequests(t=!1){this.loading=!0,this.error=null;try{console.log("Fetching pending leave requests... (retry:",t,")");const e=await u.get("/api/manager/leaves/pending");console.log("Leave requests response:",e.data),this.leaveRequests=e.data.data||e.data}catch(e){console.error("Fetch error:",e),this.handleApiError(e)}finally{this.loading=!1}},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchLeaveRequests(!0):this.error="Max retries exceeded. Check your network or server."},async approveRequest(t){var e,d,c;if(confirm(`Approve leave request for ${((e=t.employee)==null?void 0:e.full_name)||((c=(d=t.employee)==null?void 0:d.user)==null?void 0:c.name)}?`)){this.processing=!0;try{await u.post(`/api/manager/leaves/${t.id}/approve`,{status:"approved"}),this.$notify&&this.$notify({type:"success",title:"Success",text:"Leave request approved successfully!"}),await this.fetchLeaveRequests()}catch(r){console.error("Approve error:",r),this.handleApiError(r)}finally{this.processing=!1}}},showRejectModal(t){this.selectedRequest=t,this.rejectNotes="",this.showRejectDialog=!0},closeRejectModal(){this.showRejectDialog=!1,this.selectedRequest=null,this.rejectNotes=""},async confirmReject(){if(this.selectedRequest){this.processing=!0;try{await u.post(`/api/manager/leaves/${this.selectedRequest.id}/reject`,{status:"rejected",manager_notes:this.rejectNotes}),this.$notify&&this.$notify({type:"success",title:"Success",text:"Leave request rejected successfully!"}),this.closeRejectModal(),await this.fetchLeaveRequests()}catch(t){console.error("Reject error:",t),this.handleApiError(t)}finally{this.processing=!1}}},handleApiError(t){var d,c,r,o;let e="An unexpected error occurred.";t.code==="ERR_NETWORK"?e="Network error. Please check your connection.":((d=t.response)==null?void 0:d.status)===401?(e="Session expired. Redirecting to login...",this.authStore.clearAuth(),setTimeout(()=>this.$router.push({name:"login"}),2e3)):((c=t.response)==null?void 0:c.status)===403?e="You do not have permission to perform this action.":e=((o=(r=t.response)==null?void 0:r.data)==null?void 0:o.message)||e,this.error=e},getInitials(t){return t?t.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"??"},formatDate(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},formatStatus(t){return{pending:"Pending",approved:"Approved",rejected:"Rejected"}[t]||t},getStatusClass(t){return`status-${t}`},formatLeaveType(t){return{annual:"Annual Leave",sick:"Sick Leave",maternity:"Maternity Leave",paternity:"Paternity Leave",bereavement:"Bereavement Leave",unpaid:"Unpaid Leave"}[t]||t}}},x={class:"leave-approvals"},E={key:0,class:"error-message"},T={key:1,class:"error-message"},F={key:2,class:"loading"},P={key:3,class:"error-message"},z={key:4,class:"requests-grid"},B={class:"request-header"},U={class:"employee-avatar"},V={class:"request-info"},Y={class:"employee-id"},I={class:"request-details"},O={class:"detail-row"},K={class:"detail-row"},W={class:"detail-row"},G={class:"detail-row"},H={class:"detail-row reason-row"},J={key:0,class:"request-actions"},Q=["onClick","disabled"],X=["onClick","disabled"],Z={key:1,class:"request-status"},$={key:0,class:"empty-state"},ee={class:"modal"},se={class:"modal-header"},te={class:"modal-body"},ae={class:"form-group"},oe={class:"modal-footer"},re=["disabled"];function le(t,e,d,c,r,o){var p,v;return n(),i("div",x,[e[16]||(e[16]=s("div",{class:"page-header"},[s("h1",null,"Leave Approvals")],-1)),c.authStore.isAuthenticated?c.authStore.isManager?r.loading?(n(),i("div",F,[...e[6]||(e[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading leave requests...",-1)])])):r.error?(n(),i("div",P,[b(l(r.error)+" ",1),s("button",{onClick:e[0]||(e[0]=(...a)=>o.retryFetch&&o.retryFetch(...a)),class:"btn-primary",style:{"margin-top":"1rem"}},"Retry")])):(n(),i("div",z,[(n(!0),i(C,null,S(r.leaveRequests,a=>{var h,m,y,f,g,R,_;return n(),i("div",{key:a.id,class:"request-card"},[s("div",B,[s("div",U,l(o.getInitials(((h=a.employee)==null?void 0:h.full_name)||((y=(m=a.employee)==null?void 0:m.user)==null?void 0:y.name))),1),s("div",V,[s("h3",null,l(((f=a.employee)==null?void 0:f.full_name)||((R=(g=a.employee)==null?void 0:g.user)==null?void 0:R.name)),1),s("p",Y,l((_=a.employee)==null?void 0:_.employee_id),1),s("span",{class:D(["status-badge",o.getStatusClass(a.status)])},l(o.formatStatus(a.status)),3)])]),s("div",I,[s("div",O,[e[7]||(e[7]=s("span",{class:"label"},"ðŸ“… Leave Type:",-1)),s("span",null,l(o.formatLeaveType(a.type)),1)]),s("div",K,[e[8]||(e[8]=s("span",{class:"label"},"ðŸ“† Start Date:",-1)),s("span",null,l(o.formatDate(a.start_date)),1)]),s("div",W,[e[9]||(e[9]=s("span",{class:"label"},"ðŸ“† End Date:",-1)),s("span",null,l(o.formatDate(a.end_date)),1)]),s("div",G,[e[10]||(e[10]=s("span",{class:"label"},"ðŸ“Š Days:",-1)),s("span",null,l(a.total_days),1)]),s("div",H,[e[11]||(e[11]=s("span",{class:"label"},"ðŸ“ Reason:",-1)),s("span",null,l(a.reason||"N/A"),1)])]),a.status==="pending"?(n(),i("div",J,[s("button",{onClick:k=>o.approveRequest(a),class:"btn-approve",disabled:r.processing}," Approve ",8,Q),s("button",{onClick:k=>o.showRejectModal(a),class:"btn-reject",disabled:r.processing}," Reject ",8,X)])):(n(),i("div",Z,[s("p",null,"This request has been "+l(o.formatStatus(a.status))+".",1)]))])}),128)),r.leaveRequests.length===0?(n(),i("div",$,[...e[12]||(e[12]=[s("p",null,"No pending leave requests",-1),s("p",null,"Your team has no leave requests to review at the moment.",-1)])])):j("",!0)])):(n(),i("div",T," You don't have permission to access this page. ")):(n(),i("div",E," Please log in to access leave approvals. ")),r.showRejectDialog?(n(),i("div",{key:5,class:"modal-overlay",onClick:e[5]||(e[5]=A((...a)=>o.closeRejectModal&&o.closeRejectModal(...a),["self"]))},[s("div",ee,[s("div",se,[e[13]||(e[13]=s("h2",null,"Reject Leave Request",-1)),s("button",{onClick:e[1]||(e[1]=(...a)=>o.closeRejectModal&&o.closeRejectModal(...a)),class:"close-btn"},"âœ•")]),s("div",te,[s("p",null,[e[14]||(e[14]=b("Rejecting leave request for: ",-1)),s("strong",null,l((v=(p=r.selectedRequest)==null?void 0:p.employee)==null?void 0:v.full_name),1)]),s("div",ae,[e[15]||(e[15]=s("label",null,"Manager Notes (Optional)",-1)),q(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.rejectNotes=a),rows:"4",placeholder:"Provide a reason for rejection..."},null,512),[[M,r.rejectNotes]])])]),s("div",oe,[s("button",{onClick:e[3]||(e[3]=(...a)=>o.closeRejectModal&&o.closeRejectModal(...a)),class:"btn-secondary"},"Cancel"),s("button",{onClick:e[4]||(e[4]=(...a)=>o.confirmReject&&o.confirmReject(...a)),class:"btn-reject",disabled:r.processing},l(r.processing?"Rejecting...":"Confirm Reject"),9,re)])])])):j("",!0)])}const ce=w(N,[["render",le],["__scopeId","data-v-98c99796"]]);export{ce as default};
