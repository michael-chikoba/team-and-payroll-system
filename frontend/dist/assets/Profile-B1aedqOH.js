import{_ as g,u as b}from"./index-Djdf6BKf.js";import{b as a,p as t,t as d,s as f,q as h,v as P,x as u,y as p,F as v,C as w,g as m,f as c}from"./vendor-COruVTVJ.js";const D={name:"Profile",setup(){return{authStore:b()}},data(){return{pageName:"My Profile",form:{firstName:"",lastName:"",email:"",phone:"",dateOfBirth:"",nationalId:"",address:"",emergencyContact:""},profilePicUrl:"",documents:[],today:new Date().toISOString().split("T")[0],loading:!1,updatingProfile:!1,uploadingDoc:!1,formError:null,error:null,retryCount:0}},mounted(){this.fetchProfile()},methods:{async fetchProfile(r=!1){var e;this.loading=!0,this.error=null;try{console.log("Fetching profile... (retry:",r,")");const[l,n]=await Promise.all([m.get("/api/employee/profile"),m.get("/api/employee/documents")]);console.log("Profile response:",l.data),console.log("Documents response:",n.data);const o=l.data.profile||l.data;this.form={firstName:o.first_name||"",lastName:o.last_name||"",email:o.email||"",phone:o.phone||"",dateOfBirth:((e=o.date_of_birth)==null?void 0:e.split("T")[0])||"",nationalId:o.national_id||"",address:o.address||"",emergencyContact:o.emergency_contact||""},this.profilePicUrl=o.profile_pic||"",this.documents=n.data.data||n.data||[]}catch(l){console.error("Profile fetch error:",l),this.handleApiError(l)}finally{this.loading=!1}},async updateProfile(){this.updatingProfile=!0,this.formError=null;try{const r={...this.form};await m.put("/api/employee/profile",r),this.authStore.updateUser(this.form),this.$notify({type:"success",title:"Success",text:"Profile updated successfully!"})}catch(r){this.handleApiError(r)}finally{this.updatingProfile=!1}},async handleProfilePicUpload(r){const e=r.target.files[0];if(!e)return;if(e.size>2*1024*1024){this.formError="Profile picture must be less than 2MB.";return}const l=new FormData;l.append("profile_pic",e);try{const n=await m.post("/api/employee/profile-pic",l,{headers:{"Content-Type":"multipart/form-data"}});this.profilePicUrl=n.data.profile_pic_url||URL.createObjectURL(e),this.$notify({type:"success",title:"Success",text:"Profile picture updated!"})}catch(n){this.handleApiError(n)}},handleImageError(){this.profilePicUrl="/default-avatar.png"},async handleDocumentUpload(r){const e=Array.from(r.target.files);if(e.length!==0){this.uploadingDoc=!0;try{const l=new FormData;e.forEach(o=>{if(o.size>5*1024*1024){this.formError=`File ${o.name} exceeds 5MB limit.`;return}l.append("documents",o),l.append("type",o.name.includes(".pdf")?"contract":"general")});const n=await m.post("/api/employee/documents",l,{headers:{"Content-Type":"multipart/form-data"}});this.documents=[...this.documents,...n.data.newDocuments||[]],this.$notify({type:"success",title:"Success",text:`${e.length} document(s) uploaded successfully!`})}catch(l){this.handleApiError(l)}finally{this.uploadingDoc=!1,r.target.value=""}}},async downloadDocument(r){try{const e=await m.get(`/api/employee/documents/${r}/download`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=l,n.setAttribute("download",`castle-document-${r}.pdf`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l)}catch(e){this.handleApiError(e)}},async deleteDocument(r){if(confirm("Are you sure you want to delete this document?"))try{await m.delete(`/api/employee/documents/${r}`),this.documents=this.documents.filter(e=>e.id!==r),this.$notify({type:"success",title:"Success",text:"Document deleted successfully!"})}catch(e){this.handleApiError(e)}},resetForm(){this.fetchProfile()},getFileIcon(r){var n;const e=(n=r.split(".").pop())==null?void 0:n.toLowerCase();return{pdf:"ğŸ“„",doc:"ğŸ“",docx:"ğŸ“",jpg:"ğŸ–¼ï¸",jpeg:"ğŸ–¼ï¸",png:"ğŸ–¼ï¸"}[e]||"ğŸ“"},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchProfile(!0):this.error="Max retries exceeded. Please refresh the page."},handleApiError(r){var l,n,o,i,s;let e="An unexpected error occurred.";if(r.code==="ERR_NETWORK"||r.message.includes("Network Error"))e="Network error. Check your connection.";else if(((l=r.response)==null?void 0:l.status)===401)e="Session expired. Redirecting to login...",this.authStore.clearAuth(),this.$router.push({name:"login"});else if(((n=r.response)==null?void 0:n.status)===403)e="Access denied.";else if(((o=r.response)==null?void 0:o.status)===422){e=r.response.data.message||"Please check the form for errors.",this.formError=e;return}else e=((s=(i=r.response)==null?void 0:i.data)==null?void 0:s.message)||e;this.formError=e},formatDate(r){return r?new Date(r).toLocaleDateString("en-ZM",{year:"numeric",month:"short",day:"numeric"}):"N/A"}}},U={class:"profile-view"},_={class:"header"},E={class:"title"},x={class:"content"},C={class:"profile-pic-section"},N={class:"pic-container"},k=["src"],F={for:"profile-pic-upload",class:"pic-upload-btn"},A={class:"form-row"},I={class:"form-group"},S={class:"form-group"},B={class:"form-row"},M={class:"form-group"},R={class:"form-group"},L={class:"form-row"},O={class:"form-group"},V=["max"],T={class:"form-group"},j={class:"form-group full-width"},q={class:"form-group full-width"},z={key:0,class:"form-error"},Z={class:"form-actions"},G=["disabled"],K={class:"documents-section"},W={class:"upload-area"},H={for:"document-upload",class:"upload-btn"},J={key:0,class:"empty-state"},Q={key:1,class:"documents-grid"},X={class:"doc-icon"},Y={class:"doc-name"},$={class:"doc-type"},ee={class:"doc-date"},te={class:"doc-actions"},oe=["onClick"],se=["onClick"],re={key:0,class:"loading"},le={key:1,class:"error-message"};function ne(r,e,l,n,o,i){return c(),a("div",U,[t("header",_,[t("h1",E,d(o.pageName),1),e[15]||(e[15]=t("p",{class:"subtitle"},"Manage your personal information and documents",-1))]),t("div",x,[t("div",C,[t("div",N,[t("img",{src:o.profilePicUrl||"/default-avatar.png",alt:"Profile Picture",class:"profile-pic",onError:e[0]||(e[0]=(...s)=>i.handleImageError&&i.handleImageError(...s))},null,40,k),t("label",F,[e[16]||(e[16]=h(" ğŸ“· Change Photo ",-1)),t("input",{id:"profile-pic-upload",type:"file",accept:"image/*",onChange:e[1]||(e[1]=(...s)=>i.handleProfilePicUpload&&i.handleProfilePicUpload(...s)),ref:"profilePicInput"},null,544)])]),e[17]||(e[17]=t("p",{class:"pic-info"},"Upload a professional photo (Max 2MB)",-1))]),t("form",{onSubmit:e[11]||(e[11]=P((...s)=>i.updateProfile&&i.updateProfile(...s),["prevent"])),class:"profile-form"},[t("div",A,[t("div",I,[e[18]||(e[18]=t("label",null,"First Name *",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.firstName=s),type:"text",required:"",placeholder:"Enter first name"},null,512),[[p,o.form.firstName]])]),t("div",S,[e[19]||(e[19]=t("label",null,"Last Name *",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.lastName=s),type:"text",required:"",placeholder:"Enter last name"},null,512),[[p,o.form.lastName]])])]),t("div",B,[t("div",M,[e[20]||(e[20]=t("label",null,"Email *",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.email=s),type:"email",required:"",placeholder:"employee@castleholding.co.zm"},null,512),[[p,o.form.email]])]),t("div",R,[e[21]||(e[21]=t("label",null,"Phone Number",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.phone=s),type:"tel",placeholder:"+260 97 123 4567"},null,512),[[p,o.form.phone]])])]),t("div",L,[t("div",O,[e[22]||(e[22]=t("label",null,"Date of Birth",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.dateOfBirth=s),type:"date",max:o.today},null,8,V),[[p,o.form.dateOfBirth]])]),t("div",T,[e[23]||(e[23]=t("label",null,"National ID / Passport",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.form.nationalId=s),type:"text",placeholder:"e.g., 234567/89/1"},null,512),[[p,o.form.nationalId]])])]),t("div",j,[e[24]||(e[24]=t("label",null,"Address",-1)),u(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.form.address=s),rows:"3",placeholder:"Enter your full address in Lusaka, Zambia..."},null,512),[[p,o.form.address]])]),t("div",q,[e[25]||(e[25]=t("label",null,"Emergency Contact",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.form.emergencyContact=s),type:"text",placeholder:"Name and phone number"},null,512),[[p,o.form.emergencyContact]])]),o.formError?(c(),a("div",z,d(o.formError),1)):f("",!0),t("div",Z,[t("button",{type:"button",onClick:e[10]||(e[10]=(...s)=>i.resetForm&&i.resetForm(...s)),class:"btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn-primary",disabled:o.updatingProfile},d(o.updatingProfile?"Updating...":"Update Profile"),9,G)])],32),t("div",K,[e[29]||(e[29]=t("h3",{class:"section-title"},"Official Documents",-1)),e[30]||(e[30]=t("p",{class:"section-subtitle"},"Upload and manage your employment documents",-1)),t("div",W,[t("label",H,[e[26]||(e[26]=h(" + Upload Document ",-1)),t("input",{id:"document-upload",type:"file",accept:".pdf,.doc,.docx,.jpg,.png",multiple:"",onChange:e[12]||(e[12]=(...s)=>i.handleDocumentUpload&&i.handleDocumentUpload(...s)),ref:"documentInput"},null,544)]),e[27]||(e[27]=t("p",{class:"upload-info"},"Supported: PDF, DOC, Images (Max 5MB each)",-1))]),o.documents.length===0?(c(),a("div",J,[e[28]||(e[28]=t("p",null,"No documents uploaded yet.",-1)),t("button",{onClick:e[13]||(e[13]=s=>r.$refs.documentInput.click()),class:"btn-primary"},"Upload First Document")])):(c(),a("div",Q,[(c(!0),a(v,null,w(o.documents,s=>(c(),a("div",{key:s.id,class:"document-card"},[t("div",X,d(i.getFileIcon(s.fileName)),1),t("h4",Y,d(s.fileName),1),t("p",$,d(s.type||"General Document"),1),t("p",ee,d(i.formatDate(s.uploadDate)),1),t("div",te,[t("button",{onClick:y=>i.downloadDocument(s.id),class:"action-btn download"},"Download",8,oe),t("button",{onClick:y=>i.deleteDocument(s.id),class:"action-btn delete"},"Delete",8,se)])]))),128))]))]),o.loading?(c(),a("div",re,[...e[31]||(e[31]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading profile...",-1)])])):f("",!0),o.error?(c(),a("div",le,[h(d(o.error)+" ",1),t("button",{onClick:e[14]||(e[14]=(...s)=>i.retryFetch&&i.retryFetch(...s)),class:"btn-primary"},"Retry")])):f("",!0)])])}const de=g(D,[["render",ne],["__scopeId","data-v-ff035a33"]]);export{de as default};
