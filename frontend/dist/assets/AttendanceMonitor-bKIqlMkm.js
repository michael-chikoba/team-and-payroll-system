import{b as r,s as u,p as t,z as h,t as i,x as b,y as g,q as k,F as C,C as w,g as y,f as d}from"./vendor-COruVTVJ.js";import{_ as D}from"./index-Djdf6BKf.js";const A={name:"AttendanceMonitor",data(){return{attendanceData:[],teamOverview:null,loading:!1,error:null,retryCount:0,selectedDate:new Date().toISOString().split("T")[0],today:new Date().toISOString().split("T")[0],filterStatus:"all",modalVisible:!1,modalMessage:"",modalIsConfirm:!1,modalResolve:null,modalReject:null,currentEmployeeToMark:null}},computed:{isToday(){return this.selectedDate===this.today},presentCount(){return this.attendanceData.filter(s=>["present","completed"].includes(s.status)).length},absentCount(){return this.attendanceData.filter(s=>["absent","on_leave"].includes(s.status)).length},lateCount(){return this.attendanceData.filter(s=>s.status==="late").length},filteredData(){return this.filterStatus==="all"?this.attendanceData:this.attendanceData.filter(s=>this.filterStatus==="present"?["present","completed"].includes(s.status):this.filterStatus==="absent"?["absent","on_leave"].includes(s.status):this.filterStatus==="late"?s.status==="late":s.status===this.filterStatus)}},mounted(){this.fetchAttendance()},methods:{showAlert(s){return this.modalMessage=s,this.modalIsConfirm=!1,this.modalVisible=!0,new Promise(e=>{this.modalResolve=e})},showConfirm(s){return this.modalMessage=s,this.modalIsConfirm=!0,this.modalVisible=!0,new Promise((e,c)=>{this.modalResolve=e,this.modalReject=c})},confirmAction(){this.modalVisible=!1,this.modalResolve&&this.modalResolve(),this.resetModal()},cancelAction(){this.modalVisible=!1,this.modalReject&&this.modalReject(),this.resetModal()},resetModal(){this.modalResolve=null,this.modalReject=null,this.modalMessage="",this.modalIsConfirm=!1,this.currentEmployeeToMark=null},async fetchAttendance(s=!1){this.loading=!0,this.error=null;try{console.log("ğŸ“¡ Fetching attendance for date:",this.selectedDate);const e=await y.get("/api/manager/attendance",{params:{date:this.selectedDate}});console.log("âœ… Full API response:",e),console.log("ğŸ‘¥ Attendances data:",e.data.attendances),console.log("ğŸ“Š Summary data:",e.data.summary);const m=(e.data.attendances||[]).filter(o=>o.date===this.selectedDate);this.attendanceData=m.map(o=>({id:o.employee.id,full_name:`${o.employee.first_name} ${o.employee.last_name}`.trim(),employee_id:o.employee.id,department:o.employee.department||"N/A",position:o.employee.position||"N/A",status:o.status,clock_in_time:o.checkIn,clock_out_time:o.checkOut,hours_worked:o.hoursWorked||0,date:o.date}));const n=(e.data.summary||{}).total_employees||0,l=this.attendanceData.filter(o=>["present","completed"].includes(o.status)).length,f=this.attendanceData.filter(o=>o.status==="late").length,v=this.attendanceData.filter(o=>["absent","on_leave"].includes(o.status)).length,p=l+f,_=n>0?Math.round(p/n*100):0;console.log("ğŸ“Š Calculated Overview:",{totalEmployees:n,presentOnTime:l,late:f,absent:v,attendanceRate:_,totalPresentAndLate:p}),this.teamOverview={totalEmployees:n,presentCount:l,absentCount:v,lateCount:f,attendanceRate:_}}catch(e){console.error("âŒ Fetch attendance error:",e),this.handleApiError(e)}finally{this.loading=!1}},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchAttendance(!0):(this.error="Max retries exceeded. Please refresh the page.",this.retryCount=0)},handleApiError(s){var c;let e="Failed to load attendance data.";if(s.response)if(s.response.status===401)e="Session expired. Please log in again.";else if(s.response.status===403)e="Access denied. You must be a manager to view this data.";else if(s.response.status===404){e="No attendance data found for this date.",this.attendanceData=[],this.teamOverview={totalEmployees:0,presentCount:0,absentCount:0,lateCount:0,attendanceRate:0};return}else(c=s.response.data)!=null&&c.message&&(e=s.response.data.message);else s.request&&(e="Network error. Please check your connection.");this.error=e},async attemptMarkPresent(s){this.currentEmployeeToMark=s,await this.showConfirm(`Mark ${s.full_name} as present for ${this.formatDate(this.selectedDate)}? This will register a manual clock-in.`).catch(()=>!1)&&await this.markPresent(s)},async markPresent(s){var e,c;try{await y.post(`/api/manager/attendance/${s.id}/mark-present`,{date:this.selectedDate}),await this.showAlert("Employee successfully marked as present!"),await this.fetchAttendance()}catch(m){const a=((c=(e=m.response)==null?void 0:e.data)==null?void 0:c.message)||"Failed to mark employee as present.";await this.showAlert(a)}},viewHistory(s){this.showAlert(`Attendance history for ${s.full_name} would open in a real app.`)},getInitials(s){var a,n;if(!s)return"??";const e=s.split(" "),c=((a=e[0])==null?void 0:a[0])||"",m=e.length>1?(n=e[e.length-1])==null?void 0:n[0]:"";return(c+m).toUpperCase().substring(0,2)},formatDate(s){if(!s)return"N/A";try{return new Date(s.includes("T")?s:s+"T00:00:00").toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})}catch{return s}},formatTime(s){if(!s)return"N/A";if(s.match(/AM|PM/i))return s;try{let e;return s.includes("T")||s.includes("Z")?e=new Date(s):e=new Date(`2000-01-01T${s}:00`),isNaN(e)?s:e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return s}},formatHours(s){if(s==null||s===void 0)return"0h 0m";const e=Math.floor(s),c=Math.round((s-e)*60);return`${e}h ${c}m`},formatStatus(s){return{present:"Present",completed:"Completed",absent:"Absent",late:"Late",on_leave:"On Leave"}[s]||s},getStatusClass(s){return s==="completed"?"status-present":`status-${s}`}}},S={class:"attendance-monitor"},M={class:"simple-modal-content"},T={class:"modal-actions"},R={class:"page-header"},O={class:"subtitle"},I={class:"header-actions"},P=["max"],N=["disabled"],x={key:0},F={key:1},L={key:1,class:"loading"},V={key:2,class:"error-message"},E={key:3},H={key:0,class:"overview-section"},j={class:"overview-card"},U={class:"overview-metrics"},B={class:"metric total"},q={class:"metric-value"},z={class:"metric present"},W={class:"metric-value"},Y={class:"metric absent"},Z={class:"metric-value"},G={class:"metric late"},J={class:"metric-value"},K={class:"metric rate"},Q={class:"metric-value"},X={class:"employees-section"},$={key:0,class:"filter-tabs"},ee={class:"employees-grid"},te={class:"employee-header"},se={class:"employee-avatar"},ae={class:"employee-info"},ne={class:"employee-id"},le={class:"employee-position"},ie={class:"attendance-status"},oe={class:"attendance-details"},re={class:"detail-row"},de={class:"value"},ce={class:"detail-row"},ue={class:"value"},me={class:"detail-row"},he={class:"value"},fe={class:"detail-row"},ve={class:"value"},pe={class:"attendance-actions"},_e=["onClick"],ye=["onClick"],be={key:0,class:"empty-state"},ge={key:0};function ke(s,e,c,m,a,n){return d(),r("div",S,[a.modalVisible?(d(),r("div",{key:0,class:h(["simple-modal-overlay",{"is-confirm":a.modalIsConfirm}])},[t("div",M,[t("h3",null,i(a.modalIsConfirm?"Confirmation":"Notification"),1),t("p",null,i(a.modalMessage),1),t("div",T,[a.modalIsConfirm?(d(),r("button",{key:0,onClick:e[0]||(e[0]=(...l)=>n.cancelAction&&n.cancelAction(...l)),class:"btn-cancel"},"Cancel")):u("",!0),t("button",{onClick:e[1]||(e[1]=(...l)=>n.confirmAction&&n.confirmAction(...l)),class:"btn-primary"},i(a.modalIsConfirm?"Confirm":"Close"),1)])])],2)):u("",!0),t("div",R,[t("div",null,[e[10]||(e[10]=t("h1",null,"Team Attendance Monitor",-1)),t("p",O,"Monitoring team attendance for "+i(n.formatDate(a.selectedDate)),1)]),t("div",I,[b(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=l=>a.selectedDate=l),onChange:e[3]||(e[3]=(...l)=>n.fetchAttendance&&n.fetchAttendance(...l)),max:a.today,class:"date-picker"},null,40,P),[[g,a.selectedDate]]),t("button",{onClick:e[4]||(e[4]=(...l)=>n.fetchAttendance&&n.fetchAttendance(...l)),class:"btn-refresh",disabled:a.loading},[a.loading?(d(),r("span",x,"Loading...")):(d(),r("span",F,"ğŸ”„ Refresh"))],8,N)])]),a.loading?(d(),r("div",L,[...e[11]||(e[11]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading attendance data...",-1)])])):a.error?(d(),r("div",V,[k(i(a.error)+" ",1),t("button",{onClick:e[5]||(e[5]=(...l)=>n.retryFetch&&n.retryFetch(...l)),class:"btn-primary"},"Retry")])):(d(),r("div",E,[a.teamOverview?(d(),r("div",H,[t("div",j,[e[17]||(e[17]=t("h3",null,"ğŸ“Š Team Attendance Overview",-1)),t("div",U,[t("div",B,[t("span",q,i(a.teamOverview.totalEmployees),1),e[12]||(e[12]=t("span",{class:"metric-label"},"Total Team Members",-1))]),t("div",z,[t("span",W,i(a.teamOverview.presentCount),1),e[13]||(e[13]=t("span",{class:"metric-label"},"Present",-1))]),t("div",Y,[t("span",Z,i(a.teamOverview.absentCount),1),e[14]||(e[14]=t("span",{class:"metric-label"},"Absent",-1))]),t("div",G,[t("span",J,i(a.teamOverview.lateCount),1),e[15]||(e[15]=t("span",{class:"metric-label"},"Late",-1))]),t("div",K,[t("span",Q,i(a.teamOverview.attendanceRate)+"%",1),e[16]||(e[16]=t("span",{class:"metric-label"},"Attendance Rate",-1))])])])])):u("",!0),t("div",X,[t("h2",null,"Team Members ("+i(a.attendanceData.length)+")",1),a.attendanceData.length>0?(d(),r("div",$,[t("button",{onClick:e[6]||(e[6]=l=>a.filterStatus="all"),class:h([{active:a.filterStatus==="all"},"tab-btn"])}," All ("+i(a.attendanceData.length)+") ",3),t("button",{onClick:e[7]||(e[7]=l=>a.filterStatus="present"),class:h([{active:a.filterStatus==="present"},"tab-btn"])}," Present ("+i(n.presentCount)+") ",3),t("button",{onClick:e[8]||(e[8]=l=>a.filterStatus="absent"),class:h([{active:a.filterStatus==="absent"},"tab-btn"])}," Absent ("+i(n.absentCount)+") ",3),t("button",{onClick:e[9]||(e[9]=l=>a.filterStatus="late"),class:h([{active:a.filterStatus==="late"},"tab-btn"])}," Late ("+i(n.lateCount)+") ",3)])):u("",!0),t("div",ee,[(d(!0),r(C,null,w(n.filteredData,l=>(d(),r("div",{key:l.id,class:"employee-card"},[t("div",te,[t("div",se,i(n.getInitials(l.full_name)),1),t("div",ae,[t("h3",null,i(l.full_name),1),t("p",ne,i(l.employee_id)+" â€¢ "+i(l.department),1),t("p",le,i(l.position),1)]),t("div",ie,[t("span",{class:h(["status-badge",n.getStatusClass(l.status)])},i(n.formatStatus(l.status)),3)])]),t("div",oe,[t("div",re,[e[18]||(e[18]=t("span",{class:"label"},"ğŸ• Clock In:",-1)),t("span",de,i(n.formatTime(l.clock_in_time)),1)]),t("div",ce,[e[19]||(e[19]=t("span",{class:"label"},"ğŸ• Clock Out:",-1)),t("span",ue,i(n.formatTime(l.clock_out_time)),1)]),t("div",me,[e[20]||(e[20]=t("span",{class:"label"},"â±ï¸ Hours Worked:",-1)),t("span",he,i(n.formatHours(l.hours_worked)),1)]),t("div",fe,[e[21]||(e[21]=t("span",{class:"label"},"ğŸ“… Date:",-1)),t("span",ve,i(n.formatDate(l.date)),1)])]),t("div",pe,[t("button",{onClick:f=>n.viewHistory(l),class:"btn-view"}," ğŸ“‹ View History ",8,_e),l.status==="absent"&&n.isToday?(d(),r("button",{key:0,onClick:f=>n.attemptMarkPresent(l),class:"btn-mark"}," âœ“ Mark Present ",8,ye)):u("",!0)])]))),128)),n.filteredData.length===0?(d(),r("div",be,[e[22]||(e[22]=t("div",{class:"empty-icon"},"ğŸ“­",-1)),t("p",null,"No "+i(a.filterStatus==="all"?"":n.formatStatus(a.filterStatus).toLowerCase())+" employees found",1),a.filterStatus!=="all"?(d(),r("p",ge,"Try changing the filter or date")):u("",!0)])):u("",!0)])])]))])}const De=D(A,[["render",ke],["__scopeId","data-v-1d3a5e35"]]);export{De as default};
