import{_ as S,u as R}from"./index-cgHGa_Rg.js";import{b as p,p as e,q as f,t as l,z as T,C as A,F as k,D,g as h,f as v,E}from"./vendor-CFHPe_rb.js";const x={name:"AdminDashboard",setup(){return{authStore:R()}},data(){return{stats:{totalEmployees:0,newEmployees:0,activeToday:0,attendanceRate:0,onLeave:0,pendingLeaves:0,monthlyPayroll:0,payrollChange:0},recentActivity:[],pendingApprovals:[],departments:[],loading:!1,error:null,retryCount:0}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(!this.authStore.isAuthenticated){this.error="Please log in to access the dashboard.";return}if(!this.authStore.isAdmin){this.error="You do not have permission to access this page.";return}this.fetchDashboardData()},async fetchDashboardData(n=!1){this.loading=!0,this.error=null;try{console.log("Fetching dashboard data... (retry:",n,")");const[t,r,d,s,i,a]=await Promise.all([h.get("/api/admin/employees"),h.get("/api/admin/reports/attendance"),h.get("/api/admin/reports/leave"),h.get("/api/admin/reports/payroll"),h.get("/api/admin/audit-logs"),h.get("/api/admin/attendance/current-statuses")]),m=Array.isArray(t.data)?t.data:t.data.data||[];this.stats.totalEmployees=m.length;const L=new Date().getMonth(),w=new Date().getFullYear();this.stats.newEmployees=m.filter(o=>{if(!o.hire_date)return!1;const c=new Date(o.hire_date);return c.getMonth()===L&&c.getFullYear()===w}).length;const C=r.data.data||r.data||{},u=a.data.data||a.data||{};Array.isArray(u)?this.stats.activeToday=u.filter(o=>o.is_present).length:C.present_today!==void 0?this.stats.activeToday=C.present_today:this.stats.activeToday=0,this.stats.totalEmployees>0?this.stats.attendanceRate=Math.round(this.stats.activeToday/this.stats.totalEmployees*100):this.stats.attendanceRate=0;const g=d.data.data||d.data||{};this.stats.onLeave=g.on_leave||g.onLeave||0,this.stats.pendingLeaves=g.pending||g.pending_count||0,Array.isArray(g.pending_leaves)?this.pendingApprovals=g.pending_leaves.slice(0,5).map(o=>{var c;return{id:o.id,name:((c=o.employee)==null?void 0:c.name)||`Employee #${o.employee_id}`,type:this.formatLeaveType(o.leave_type),date:this.formatDateRange(o.start_date,o.end_date)}}):this.pendingApprovals=[];const _=s.data.data||s.data||{};this.stats.monthlyPayroll=_.total_payroll||_.total||0,this.stats.payrollChange=_.change_percentage||_.change||0;const P=Array.isArray(i.data)?i.data:i.data.data||[];this.recentActivity=P.slice(0,5).map(o=>{var c;return{id:o.id,icon:this.getActivityIcon(o.action||o.type),text:o.description||o.message||`${o.action} by ${((c=o.user)==null?void 0:c.name)||"System"}`,time:this.formatRelativeTime(o.created_at||o.timestamp),color:this.getActivityColor(o.action||o.type)}});const y={};m.forEach(o=>{const c=o.department||"Unassigned";y[c]||(y[c]={id:c,name:c,employees:0,present:0,payroll:0}),y[c].employees++,y[c].payroll+=parseFloat(o.base_salary||0)}),Array.isArray(u)&&u.forEach(o=>{const c=m.find(b=>b.id===o.employee_id);if(c&&o.is_present){const b=c.department||"Unassigned";y[b]&&y[b].present++}}),this.departments=Object.values(y)}catch(t){console.error("Dashboard fetch error:",t),this.handleApiError(t)}finally{this.loading=!1}},formatLeaveType(n){return{annual:"Annual Leave",sick:"Sick Leave",maternity:"Maternity Leave",paternity:"Paternity Leave",unpaid:"Unpaid Leave",compassionate:"Compassionate Leave"}[n]||n},formatDateRange(n,t){const r=new Date(n),d=new Date(t),s={month:"short",day:"numeric"};return r.toDateString()===d.toDateString()?r.toLocaleDateString("en-US",s):`${r.toLocaleDateString("en-US",s)} - ${d.toLocaleDateString("en-US",s)}`},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchDashboardData(!0):this.error="Max retries exceeded. Check your network or server."},refreshData(){this.retryCount=0,this.fetchDashboardData()},processPayroll(){this.$router.push({name:"PayrollProcessing"})},navigateToName(n){this.$router.push({name:n})},approve(n){console.log("Approving leave:",n),h.post(`/api/manager/leaves/${n}/approve`).then(t=>{console.log("Leave approved successfully"),this.pendingApprovals=this.pendingApprovals.filter(r=>r.id!==n),this.stats.pendingLeaves=Math.max(0,this.stats.pendingLeaves-1)}).catch(t=>{var r,d;console.error("Error approving leave:",t),alert("Failed to approve leave: "+(((d=(r=t.response)==null?void 0:r.data)==null?void 0:d.message)||"Unknown error"))})},reject(n){console.log("Rejecting leave:",n),h.post(`/api/manager/leaves/${n}/reject`).then(t=>{console.log("Leave rejected successfully"),this.pendingApprovals=this.pendingApprovals.filter(r=>r.id!==n),this.stats.pendingLeaves=Math.max(0,this.stats.pendingLeaves-1)}).catch(t=>{var r,d;console.error("Error rejecting leave:",t),alert("Failed to reject leave: "+(((d=(r=t.response)==null?void 0:r.data)==null?void 0:d.message)||"Unknown error"))})},getActivityIcon(n){return{employee_added:"ğŸ‘¤",employee_created:"ğŸ‘¤",employee_updated:"âœï¸",employee_deleted:"ğŸ—‘ï¸",payroll_processed:"ğŸ’°",payroll_generated:"ğŸ’°",leave_applied:"ğŸ–ï¸",leave_approved:"âœ…",leave_rejected:"âŒ",payslip_generated:"ğŸ“„",payslip_created:"ğŸ“„",tax_updated:"âš™ï¸",settings_updated:"âš™ï¸",attendance_marked:"âœ“",login:"ğŸ”",logout:"ğŸšª"}[n]||"â„¹ï¸"},getActivityColor(n){return{employee_added:"#667eea",employee_created:"#667eea",employee_updated:"#4299e1",employee_deleted:"#e53e3e",payroll_processed:"#48bb78",payroll_generated:"#48bb78",leave_applied:"#f6ad55",leave_approved:"#48bb78",leave_rejected:"#e53e3e",payslip_generated:"#ed64a6",payslip_created:"#ed64a6",tax_updated:"#667eea",settings_updated:"#667eea",attendance_marked:"#48bb78",login:"#4299e1",logout:"#718096"}[n]||"#718096"},formatRelativeTime(n){const t=new Date,r=new Date(n),d=t-r,s=Math.floor(d/(1e3*60*60));return s<1?"Just now":s<24?`${s}h ago`:`${Math.floor(s/24)}d ago`},formatNumber(n){return new Intl.NumberFormat("en-US").format(n||0)},handleApiError(n){var r,d,s,i;let t="An unexpected error occurred.";((r=n.response)==null?void 0:r.status)===401?(t="Session expired. Please log in again.",this.authStore.clearAuth(),this.$router.push({name:"login"})):((d=n.response)==null?void 0:d.status)===403?t="Access denied.":t=((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||t,this.error=t}}},N={class:"admin-dashboard"},M={class:"page-header"},j={class:"header-actions"},F={key:0,class:"error-message"},U={key:1,class:"error-message"},z={key:2,class:"loading"},V={key:3,class:"error-message"},Y={key:4},I={class:"stats-grid"},B={class:"stat-card"},O={class:"stat-content"},q={class:"stat-value"},G={class:"stat-change positive"},H={class:"stat-card"},K={class:"stat-content"},J={class:"stat-value"},Q={class:"stat-change"},W={class:"stat-card"},X={class:"stat-content"},Z={class:"stat-value"},$={class:"stat-change negative"},tt={class:"stat-card payroll-highlight"},et={class:"stat-content"},st={class:"stat-value"},at={class:"quick-actions"},nt={class:"actions-grid"},ot={class:"content-grid"},it={class:"card"},rt={class:"card-header"},lt={class:"activity-list"},dt={class:"activity-content"},ct={class:"activity-text"},pt={class:"activity-time"},vt={key:0,class:"empty-state"},ht={class:"card"},yt={class:"card-header"},mt={class:"badge"},gt={class:"approvals-list"},ut={class:"approval-info"},_t={class:"approval-name"},bt={class:"approval-type"},ft={class:"approval-date"},At={class:"approval-actions"},kt=["onClick"],Dt=["onClick"],Ct={key:0,class:"empty-state"},Lt={class:"card full-width"},wt={class:"departments-grid"},Pt={class:"dept-name"},St={class:"dept-stats"},Rt={class:"dept-stat"},Tt={class:"dept-stat-value"},Et={class:"dept-stat"},xt={class:"dept-stat-value"},Nt={class:"dept-stat"},Mt={class:"dept-stat-value"},jt={key:0,class:"empty-state"};function Ft(n,t,r,d,s,i){return v(),p("div",N,[e("div",M,[t[11]||(t[11]=e("div",null,[e("h1",{class:"page-title"},"Payroll Admin Dashboard ğŸš€"),e("p",{class:"page-subtitle"},"Welcome back! Here's a snapshot of today's HR & Payroll data.")],-1)),e("div",j,[e("button",{onClick:t[0]||(t[0]=(...a)=>i.refreshData&&i.refreshData(...a)),class:"btn-secondary"},[...t[9]||(t[9]=[e("span",{class:"action-icon-small"},"ğŸ”„",-1),f(" Refresh Data ",-1)])]),e("button",{onClick:t[1]||(t[1]=(...a)=>i.processPayroll&&i.processPayroll(...a)),class:"btn-primary"},[...t[10]||(t[10]=[e("span",{class:"action-icon-small"},"ğŸ’°",-1),f(" Process Payroll ",-1)])])])]),d.authStore.isAuthenticated?d.authStore.isAdmin?s.loading?(v(),p("div",z,[...t[12]||(t[12]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading dashboard...",-1)])])):s.error?(v(),p("div",V,[f(l(s.error)+" ",1),e("button",{onClick:t[2]||(t[2]=(...a)=>i.retryFetch&&i.retryFetch(...a)),class:"btn-primary",style:{"margin-top":"1rem"}},"Retry")])):(v(),p("div",Y,[e("div",I,[e("div",B,[t[14]||(t[14]=e("div",{class:"stat-icon",style:{background:"#667eea",color:"white"}},"ğŸ‘¥",-1)),e("div",O,[t[13]||(t[13]=e("p",{class:"stat-label"},"Total Employees",-1)),e("h3",q,l(s.stats.totalEmployees),1),e("p",G,"ğŸ“ˆ +"+l(s.stats.newEmployees)+" this month",1)])]),e("div",H,[t[16]||(t[16]=e("div",{class:"stat-icon",style:{background:"#48bb78",color:"white"}},"âœ…",-1)),e("div",K,[t[15]||(t[15]=e("p",{class:"stat-label"},"Active Today",-1)),e("h3",J,l(s.stats.activeToday),1),e("p",Q,l(s.stats.attendanceRate)+"% attendance rate",1)])]),e("div",W,[t[18]||(t[18]=e("div",{class:"stat-icon",style:{background:"#f6ad55",color:"white"}},"ğŸ–ï¸",-1)),e("div",X,[t[17]||(t[17]=e("p",{class:"stat-label"},"On Leave",-1)),e("h3",Z,l(s.stats.onLeave),1),e("p",$,l(s.stats.pendingLeaves)+" pending approvals",1)])]),e("div",tt,[t[20]||(t[20]=e("div",{class:"stat-icon",style:{background:"#ed64a6",color:"white"}},"ğŸ’³",-1)),e("div",et,[t[19]||(t[19]=e("p",{class:"stat-label"},"Monthly Payroll",-1)),e("h3",st,"K"+l(i.formatNumber(s.stats.monthlyPayroll)),1),e("p",{class:T(["stat-change",{positive:s.stats.payrollChange>=0,negative:s.stats.payrollChange<0}])},l(s.stats.payrollChange>0?"â–²":"â–¼")+" "+l(Math.abs(s.stats.payrollChange))+"% vs last month ",3)])])]),e("div",at,[t[26]||(t[26]=e("h2",{class:"section-title"},"Quick Actions",-1)),e("div",nt,[e("button",{onClick:t[3]||(t[3]=a=>i.navigateToName("EmployeeManagement")),class:"action-card"},[...t[21]||(t[21]=[e("span",{class:"action-icon"},"â•",-1),e("span",{class:"action-label"},"Add Employee",-1)])]),e("button",{onClick:t[4]||(t[4]=a=>i.navigateToName("PayslipGeneration")),class:"action-card"},[...t[22]||(t[22]=[e("span",{class:"action-icon"},"ğŸ“„",-1),e("span",{class:"action-label"},"Generate Payslips",-1)])]),e("button",{onClick:t[5]||(t[5]=a=>i.navigateToName("AdminReports")),class:"action-card"},[...t[23]||(t[23]=[e("span",{class:"action-icon"},"âœï¸",-1),e("span",{class:"action-label"},"Manage Leaves",-1)])]),e("button",{onClick:t[6]||(t[6]=a=>i.navigateToName("AdminReports")),class:"action-card"},[...t[24]||(t[24]=[e("span",{class:"action-icon"},"ğŸ“Š",-1),e("span",{class:"action-label"},"View Reports",-1)])]),e("button",{onClick:t[7]||(t[7]=a=>i.navigateToName("TaxConfiguration")),class:"action-card"},[...t[25]||(t[25]=[e("span",{class:"action-icon"},"ğŸ“",-1),e("span",{class:"action-label"},"Tax Config",-1)])])])]),e("div",ot,[e("div",it,[e("div",rt,[t[27]||(t[27]=e("h2",{class:"card-title"},"Recent Activity",-1)),e("button",{onClick:t[8]||(t[8]=a=>i.navigateToName("AuditLogs")),class:"btn-text"},"View All")]),e("div",lt,[(v(!0),p(k,null,D(s.recentActivity,a=>(v(),p("div",{key:a.id,class:"activity-item"},[e("div",{class:"activity-icon",style:E({background:a.color,color:"white"})},l(a.icon),5),e("div",dt,[e("p",ct,l(a.text),1),e("p",pt,l(a.time),1)])]))),128)),s.recentActivity.length===0?(v(),p("div",vt,[...t[28]||(t[28]=[e("p",null,"No recent activity",-1)])])):A("",!0)])]),e("div",ht,[e("div",yt,[t[29]||(t[29]=e("h2",{class:"card-title"},"Pending Approvals",-1)),e("span",mt,l(s.pendingApprovals.length)+" Pending",1)]),e("div",gt,[(v(!0),p(k,null,D(s.pendingApprovals,a=>(v(),p("div",{key:a.id,class:"approval-item"},[e("div",ut,[e("p",_t,l(a.name),1),e("p",bt,l(a.type),1),e("p",ft,l(a.date),1)]),e("div",At,[e("button",{onClick:m=>i.approve(a.id),class:"btn-approve","aria-label":"Approve"},"âœ“",8,kt),e("button",{onClick:m=>i.reject(a.id),class:"btn-reject","aria-label":"Reject"},"âœ—",8,Dt)])]))),128)),s.pendingApprovals.length===0?(v(),p("div",Ct,[...t[30]||(t[30]=[e("p",null,"No pending approvals",-1)])])):A("",!0)])])]),e("div",Lt,[t[35]||(t[35]=e("div",{class:"card-header"},[e("h2",{class:"card-title"},"Department Overview")],-1)),e("div",wt,[(v(!0),p(k,null,D(s.departments,a=>(v(),p("div",{key:a.id,class:"dept-card"},[e("h3",Pt,l(a.name),1),e("div",St,[e("div",Rt,[e("span",Tt,l(a.employees),1),t[31]||(t[31]=e("span",{class:"dept-stat-label"},"Employees",-1))]),e("div",Et,[e("span",xt,l(a.present),1),t[32]||(t[32]=e("span",{class:"dept-stat-label"},"Present",-1))]),e("div",Nt,[e("span",Mt,"K"+l(i.formatNumber(a.payroll)),1),t[33]||(t[33]=e("span",{class:"dept-stat-label"},"Total Payroll",-1))])])]))),128)),s.departments.length===0?(v(),p("div",jt,[...t[34]||(t[34]=[e("p",null,"No departments found",-1)])])):A("",!0)])])])):(v(),p("div",U," You don't have permission to access this page. ")):(v(),p("div",F," Please log in to access the dashboard. "))])}const Vt=S(x,[["render",Ft],["__scopeId","data-v-b6f42c6d"]]);export{Vt as default};
