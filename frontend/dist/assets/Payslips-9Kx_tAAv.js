import{_ as b,u as C}from"./index-Djdf6BKf.js";import{b as i,p as s,s as c,t as a,x as m,A as v,F as f,C as h,q as y,v as P,z as p,g,f as r}from"./vendor-COruVTVJ.js";const _={name:"EmployeePayslips",setup(){return{authStore:C()}},data(){return{pageName:"My Payslips",payslips:[],filterYear:new Date().getFullYear(),filterMonth:"",filterStatus:"",availableYears:[],months:[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}],loading:!1,downloading:{},error:null,selectedPayslip:null,toast:{show:!1,message:"",type:"success"}}},computed:{totalEarnings(){return this.payslips.reduce((o,e)=>o+(e.netPay||0),0)},latestPayslipPeriod(){return this.payslips.length===0?"N/A":this.payslips[0].period||"N/A"}},mounted(){this.fetchPayslips()},methods:{async fetchPayslips(){this.loading=!0,this.error=null;try{const o={year:this.filterYear,...this.filterMonth&&{month:this.filterMonth},...this.filterStatus&&{status:this.filterStatus}},e=await g.get("/api/employee/payslips",{params:o});if(this.payslips=e.data.data||[],this.payslips.length>0){const u=[...new Set(this.payslips.map(d=>new Date(d.pay_period_start).getFullYear()))].sort((d,l)=>l-d);this.availableYears=u}else this.availableYears=[new Date().getFullYear()]}catch(o){console.error("Payslips fetch error:",o),this.handleApiError(o)}finally{this.loading=!1}},async downloadPayslip(o){this.downloading[o.id]=!0;try{const e=await g.get(`/api/employee/payslips/${o.id}/download`,{responseType:"blob"}),u=window.URL.createObjectURL(new Blob([e.data])),d=document.createElement("a");d.href=u,d.setAttribute("download",`payslip-${o.period.replace(" ","-")}.pdf`),document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(u),this.showToast("Payslip downloaded successfully!","success")}catch(e){console.error("Download error:",e),this.showToast("Failed to download payslip. Please try again.","error"),this.handleApiError(e)}finally{this.downloading[o.id]=!1}},viewPayslip(o){this.selectedPayslip=o},resetFilters(){this.filterYear=new Date().getFullYear(),this.filterMonth="",this.filterStatus="",this.fetchPayslips()},showToast(o,e="success"){this.toast={show:!0,message:o,type:e},setTimeout(()=>{this.toast.show=!1},3e3)},handleApiError(o){var u,d,l,n,t;let e="An unexpected error occurred.";o.code==="ERR_NETWORK"||o.message.includes("Network Error")?e="Network error. Please check your connection.":((u=o.response)==null?void 0:u.status)===401?(e="Session expired. Redirecting to login...",this.authStore.clearAuth(),this.$router.push({name:"login"})):((d=o.response)==null?void 0:d.status)===403?e="Access denied.":((l=o.response)==null?void 0:l.status)===404?e="Employee record not found. Please contact HR.":e=((t=(n=o.response)==null?void 0:n.data)==null?void 0:t.message)||e,this.error=e},formatCurrency(o){return new Intl.NumberFormat("en-ZM",{style:"currency",currency:"ZMW",minimumFractionDigits:2}).format(o||0)},formatStatus(o){return{generated:"Generated",paid:"Paid",draft:"Draft"}[o]||o},formatDate(o){return o?new Date(o).toLocaleDateString("en-ZM",{year:"numeric",month:"short",day:"numeric"}):"N/A"}}},k={class:"payslips-view"},D={class:"header"},A={class:"header-left"},S={class:"title"},M={class:"filters"},N={class:"filter-group"},E=["value"],F={class:"filter-group"},Y=["value"],T={class:"filter-group"},R={class:"content"},x={key:0,class:"summary-cards"},L={class:"card"},V={class:"value"},Z={class:"card"},O={class:"value"},U={class:"card"},W={class:"value"},B={key:1,class:"loading"},G={key:2,class:"error-message"},H={key:3,class:"empty-state"},I={key:4,class:"payslips-table"},J={class:"deduction"},j={class:"net-pay"},z={class:"action-buttons"},q=["onClick"],K=["onClick","disabled"],Q={key:0},X={key:1},$={class:"modal-card"},ss={class:"modal-header"},es={class:"modal-body"},ls={class:"detail-section"},ts={class:"detail-grid"},ns={class:"detail-section"},os={class:"amount-grid"},as={class:"amount-row"},is={class:"amount-row"},rs={class:"amount-row"},ds={class:"amount-row"},us={class:"amount-row"},ys={class:"amount-row total"},ps={class:"detail-section"},cs={class:"amount-grid"},ms={class:"amount-row"},vs={class:"amount-row"},fs={class:"amount-row"},hs={class:"amount-row"},Ps={class:"amount-row total deduction"},gs={class:"net-pay-section"},ws={class:"net-pay-amount"},bs={class:"modal-footer"},Cs=["disabled"];function _s(o,e,u,d,l,n){return r(),i("div",k,[s("header",D,[s("div",A,[s("h1",S,a(l.pageName),1),e[12]||(e[12]=s("p",{class:"subtitle"},"Castle Holding Zambia - Manage and download your payslips",-1))])]),s("div",M,[s("div",N,[e[13]||(e[13]=s("label",null,"Year:",-1)),m(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>l.filterYear=t),onChange:e[1]||(e[1]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t))},[(r(!0),i(f,null,h(l.availableYears,t=>(r(),i("option",{key:t,value:t},a(t),9,E))),128))],544),[[v,l.filterYear]])]),s("div",F,[e[15]||(e[15]=s("label",null,"Month:",-1)),m(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.filterMonth=t),onChange:e[3]||(e[3]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t))},[e[14]||(e[14]=s("option",{value:""},"All Months",-1)),(r(!0),i(f,null,h(l.months,t=>(r(),i("option",{key:t.value,value:t.value},a(t.label),9,Y))),128))],544),[[v,l.filterMonth]])]),s("div",T,[e[17]||(e[17]=s("label",null,"Status:",-1)),m(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.filterStatus=t),onChange:e[5]||(e[5]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t))},[...e[16]||(e[16]=[s("option",{value:""},"All",-1),s("option",{value:"generated"},"Generated",-1),s("option",{value:"paid"},"Paid",-1)])],544),[[v,l.filterStatus]])])]),s("div",R,[!l.loading&&l.payslips.length>0?(r(),i("div",x,[s("div",L,[e[18]||(e[18]=s("div",{class:"card-icon"},"ðŸ“„",-1)),e[19]||(e[19]=s("h3",null,"Total Payslips",-1)),s("p",V,a(l.payslips.length),1)]),s("div",Z,[e[20]||(e[20]=s("div",{class:"card-icon"},"ðŸ’°",-1)),e[21]||(e[21]=s("h3",null,"Total Earnings (ZMW)",-1)),s("p",O,a(n.formatCurrency(n.totalEarnings)),1)]),s("div",U,[e[22]||(e[22]=s("div",{class:"card-icon"},"ðŸ“…",-1)),e[23]||(e[23]=s("h3",null,"Latest Payslip",-1)),s("p",W,a(n.latestPayslipPeriod),1)])])):c("",!0),l.loading?(r(),i("div",B,[...e[24]||(e[24]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading payslips...",-1)])])):l.error?(r(),i("div",G,[y(a(l.error)+" ",1),s("button",{onClick:e[6]||(e[6]=(...t)=>n.fetchPayslips&&n.fetchPayslips(...t)),class:"btn-primary"},"Retry")])):l.payslips.length===0?(r(),i("div",H,[e[25]||(e[25]=s("div",{class:"empty-icon"},"ðŸ“­",-1)),e[26]||(e[26]=s("p",null,"No payslips found for the selected filters.",-1)),s("button",{onClick:e[7]||(e[7]=(...t)=>n.resetFilters&&n.resetFilters(...t)),class:"btn-primary"},"Reset Filters")])):(r(),i("table",I,[e[27]||(e[27]=s("thead",null,[s("tr",null,[s("th",null,"Period"),s("th",null,"Gross Pay (ZMW)"),s("th",null,"Deductions (ZMW)"),s("th",null,"Net Pay (ZMW)"),s("th",null,"Status"),s("th",null,"Payment Date"),s("th",null,"Actions")])],-1)),s("tbody",null,[(r(!0),i(f,null,h(l.payslips,t=>(r(),i("tr",{key:t.id},[s("td",null,[s("strong",null,a(t.period),1)]),s("td",null,a(n.formatCurrency(t.grossPay)),1),s("td",J,a(n.formatCurrency(t.deductions)),1),s("td",j,[s("strong",null,a(n.formatCurrency(t.netPay)),1)]),s("td",null,[s("span",{class:p(["status",t.status.toLowerCase()])},a(n.formatStatus(t.status)),3)]),s("td",null,a(n.formatDate(t.payment_date)),1),s("td",null,[s("div",z,[s("button",{onClick:w=>n.viewPayslip(t),class:"action-btn view",title:"View Details"}," ðŸ‘ï¸ View ",8,q),s("button",{onClick:P(w=>n.downloadPayslip(t),["prevent"]),class:p(["action-btn download",{downloading:l.downloading[t.id]}]),disabled:l.downloading[t.id],title:"Download PDF"},[l.downloading[t.id]?(r(),i("span",Q,"â³ Downloading...")):(r(),i("span",X,"â¬‡ï¸ Download"))],10,K)])])]))),128))])]))]),l.selectedPayslip?(r(),i("div",{key:0,class:"modal-overlay",onClick:e[11]||(e[11]=P(t=>l.selectedPayslip=null,["self"]))},[s("div",$,[s("div",ss,[s("h2",null,"Payslip Details - "+a(l.selectedPayslip.period),1),s("button",{onClick:e[8]||(e[8]=t=>l.selectedPayslip=null),class:"close-btn"},"âœ•")]),s("div",es,[s("div",ls,[e[32]||(e[32]=s("h3",null,"Period Information",-1)),s("div",ts,[s("div",null,[e[28]||(e[28]=s("strong",null,"Period:",-1)),y(" "+a(l.selectedPayslip.period),1)]),s("div",null,[e[29]||(e[29]=s("strong",null,"Payment Date:",-1)),y(" "+a(n.formatDate(l.selectedPayslip.payment_date)),1)]),s("div",null,[e[30]||(e[30]=s("strong",null,"Status:",-1)),e[31]||(e[31]=y()),s("span",{class:p(["status",l.selectedPayslip.status])},a(n.formatStatus(l.selectedPayslip.status)),3)])])]),s("div",ns,[e[38]||(e[38]=s("h3",null,"Earnings",-1)),s("div",os,[s("div",as,[e[33]||(e[33]=s("span",null,"Basic Salary:",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.basic_salary)),1)]),s("div",is,[e[34]||(e[34]=s("span",null,"House Allowance:",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.house_allowance)),1)]),s("div",rs,[e[35]||(e[35]=s("span",null,"Transport Allowance:",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.transport_allowance)),1)]),s("div",ds,[e[36]||(e[36]=s("span",null,"Other Allowances:",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.other_allowances)),1)]),s("div",us,[s("span",null,"Overtime Pay ("+a(l.selectedPayslip.overtime_hours)+"h):",1),s("span",null,a(n.formatCurrency(l.selectedPayslip.overtime_pay)),1)]),s("div",ys,[e[37]||(e[37]=s("span",null,[s("strong",null,"Gross Pay:")],-1)),s("span",null,[s("strong",null,a(n.formatCurrency(l.selectedPayslip.grossPay)),1)])])])]),s("div",ps,[e[44]||(e[44]=s("h3",null,"Deductions",-1)),s("div",cs,[s("div",ms,[e[39]||(e[39]=s("span",null,"NAPSA (5%):",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.napsa)),1)]),s("div",vs,[e[40]||(e[40]=s("span",null,"PAYE Tax:",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.paye)),1)]),s("div",fs,[e[41]||(e[41]=s("span",null,"NHIMA (1%):",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.nhima)),1)]),s("div",hs,[e[42]||(e[42]=s("span",null,"Other Deductions:",-1)),s("span",null,a(n.formatCurrency(l.selectedPayslip.other_deductions)),1)]),s("div",Ps,[e[43]||(e[43]=s("span",null,[s("strong",null,"Total Deductions:")],-1)),s("span",null,[s("strong",null,a(n.formatCurrency(l.selectedPayslip.deductions)),1)])])])]),s("div",gs,[e[45]||(e[45]=s("div",{class:"net-pay-label"},"NET PAY",-1)),s("div",ws,a(n.formatCurrency(l.selectedPayslip.netPay)),1)])]),s("div",bs,[s("button",{onClick:e[9]||(e[9]=t=>n.downloadPayslip(l.selectedPayslip)),class:"btn-primary",disabled:l.downloading[l.selectedPayslip.id]},a(l.downloading[l.selectedPayslip.id]?"â³ Downloading...":"â¬‡ï¸ Download PDF"),9,Cs),s("button",{onClick:e[10]||(e[10]=t=>l.selectedPayslip=null),class:"btn-secondary"},"Close")])])])):c("",!0),l.toast.show?(r(),i("div",{key:1,class:p(["toast",l.toast.type])},a(l.toast.message),3)):c("",!0)])}const As=b(_,[["render",_s],["__scopeId","data-v-0b4f6e18"]]);export{As as default};
