import{_ as S,u as N}from"./index-CUA5mSp8.js";import{b as l,p as t,C as u,q as c,t as i,F as w,D as A,v as k,x as p,y as f,A as _,s as C,g,f as n,z as F}from"./vendor-CFHPe_rb.js";const x={name:"EmployeeManagement",setup(){return{authStore:N()}},data(){return{employees:[],managers:[],loading:!1,error:null,showAddModal:!1,showEditModal:!1,submitting:!1,formError:null,currentEmployee:null,form:{first_name:"",last_name:"",email:"",role:"employee",position:"",department:"",base_salary:"",employment_type:"",hire_date:"",manager_id:""},retryCount:0}},mounted(){this.initializeComponent()},methods:{initializeComponent(){if(!this.authStore.isAuthenticated){this.error="Please log in to access employee management.";return}if(!this.authStore.isAdmin&&!this.authStore.isManager){this.error="You do not have permission to access this page.";return}this.fetchEmployees(),this.fetchManagers()},async fetchEmployees(s=!1){this.loading=!0,this.error=null;try{console.log("Fetching employees... (retry:",s,")");const e=await g.get("/api/admin/employees");console.log("Employees response:",e.data);let m=[];e.data&&e.data.employees?m=e.data.employees:e.data&&e.data.data?m=e.data.data:m=e.data||[],this.employees=m,console.log("Processed employees:",this.employees)}catch(e){console.error("Fetch error:",e),this.handleApiError(e)}finally{this.loading=!1}},async fetchManagers(){var s;try{console.log("Fetching managers...");const e=await g.get("/api/admin/managers");console.log("Managers API response:",e.data),Array.isArray(e.data)?this.managers=e.data:e.data&&e.data.data?this.managers=e.data.data:this.managers=e.data||[],this.managers.length===0?console.warn("No managers found in the system"):console.log("Managers loaded successfully:",this.managers)}catch(e){console.error("Failed to fetch managers:",e),this.managers=[],((s=e.response)==null?void 0:s.status)!==404&&this.$notify({type:"error",title:"Error",text:"Failed to load managers list"})}},getEmployeeName(s){return s.first_name&&s.last_name?`${s.first_name} ${s.last_name}`.trim():s.user&&s.user.first_name?`${s.user.first_name} ${s.user.last_name||""}`.trim():s.name?s.name:s.full_name?s.full_name:"N/A"},getEmployeeRole(s){var e;return s.role||((e=s.user)==null?void 0:e.role)||"employee"},getManagerName(s){if(!s)return"No Manager";const e=this.managers.find(m=>m.id===s);return e?`${e.first_name} ${e.last_name}`:"Unknown Manager"},formatRole(s){return{admin:"Admin",manager:"Manager",employee:"Employee"}[s]||"Employee"},getRoleBadgeClass(s){return{"role-employee":s==="employee","role-manager":s==="manager","role-admin":s==="admin"}},onRoleChange(){(this.form.role==="manager"||this.form.role==="admin")&&(this.form.manager_id="")},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchEmployees(!0):this.error="Max retries exceeded. Check your network or server."},async submitForm(){this.submitting=!0,this.formError=null;try{if(this.form.role==="employee"&&!this.form.manager_id){this.formError="Please select a manager for the employee.",this.submitting=!1;return}const s={first_name:this.form.first_name,last_name:this.form.last_name,email:this.form.email,role:this.form.role,position:this.form.position,department:this.form.department,base_salary:parseFloat(this.form.base_salary),employment_type:this.form.employment_type,hire_date:this.form.hire_date,manager_id:this.form.role==="employee"?this.form.manager_id:null};console.log("Submitting employee data:",s),this.showEditModal?await g.put(`/api/admin/employees/${this.currentEmployee.id}`,s):await g.post("/api/admin/employees",s),await this.fetchEmployees(),await this.fetchManagers(),this.closeModals();const e=this.showEditModal?"Employee updated successfully!":"Employee created successfully! Default password is: Password123!";this.$notify({type:"success",title:"Success",text:e})}catch(s){console.error("Submit error:",s.response),this.handleApiError(s)}finally{this.submitting=!1}},handleApiError(s){var m,d,r,a,o,h,y,v,b,E,M;let e="An unexpected error occurred.";if(s.code==="ERR_NETWORK"||s.message.includes("Network Error"))e="Network error: Please check your connection and try again.";else if(((m=s.response)==null?void 0:m.status)===401)e="Your session has expired. Please log in again.",this.authStore.clearAuth(),this.$router.push({name:"login"});else if(((d=s.response)==null?void 0:d.status)===403)e="You do not have permission to perform this action.";else if(((r=s.response)==null?void 0:r.status)===422){this.formError=s.response.data.message||"Please check the form for errors.";return}else if(((a=s.response)==null?void 0:a.status)===404)e="The requested resource was not found.";else if(((o=s.response)==null?void 0:o.status)===500){e=((y=(h=s.response)==null?void 0:h.data)==null?void 0:y.message)||"Server error occurred. Please try again.",(b=(v=s.response)==null?void 0:v.data)!=null&&b.details&&this.authStore.isAdmin&&(this.formError=s.response.data.details);return}else e=((M=(E=s.response)==null?void 0:E.data)==null?void 0:M.message)||e;this.error=e},editEmployee(s){var m,d,r,a,o;this.currentEmployee=s;const e=this.getEmployeeRole(s);this.form={first_name:s.first_name||((m=s.user)==null?void 0:m.first_name)||"",last_name:s.last_name||((d=s.user)==null?void 0:d.last_name)||"",email:s.email||((r=s.user)==null?void 0:r.email)||"",role:e,position:s.position||"",department:s.department||"",base_salary:s.base_salary||"",employment_type:s.employment_type||"",hire_date:((a=s.hire_date)==null?void 0:a.split("T")[0])||((o=s.created_at)==null?void 0:o.split("T")[0])||"",manager_id:e==="employee"?s.manager_id:""},this.showEditModal=!0},async deleteEmployee(s){const e=this.getEmployeeName(s);if(confirm(`Are you sure you want to delete ${e}? This action cannot be undone.`))try{await g.delete(`/api/admin/employees/${s.id}`),await this.fetchEmployees(),await this.fetchManagers(),this.$notify({type:"success",title:"Success",text:"Employee deleted successfully!"})}catch(m){this.handleApiError(m)}},viewEmployee(s){this.$router.push({name:"employee-details",params:{id:s.id}})},closeModals(){this.showAddModal=!1,this.showEditModal=!1,this.currentEmployee=null,this.formError=null,this.resetForm()},resetForm(){this.form={first_name:"",last_name:"",email:"",role:"employee",position:"",department:"",base_salary:"",employment_type:"",hire_date:"",manager_id:""}},getInitials(s){return!s||s==="N/A"?"??":s.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)},formatNumber(s){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s||0)},formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},formatEmploymentType(s){return{full_time:"Full Time",part_time:"Part Time",contract:"Contract"}[s]||s||"N/A"}}},R={class:"employee-management"},D={class:"page-header"},T={key:0,class:"error-message"},P={key:1,class:"error-message"},U={key:2,class:"loading"},V={key:3,class:"error-message"},q={key:4,class:"employees-table-wrapper"},I={class:"employees-table"},B={class:"employee-name"},z={class:"employee-avatar"},H={class:"badge-cell"},L={class:"badge"},Y={class:"badge-cell"},K={class:"employee-actions"},O=["onClick"],j=["onClick"],W=["onClick"],G={key:0,class:"empty-state"},J={class:"modal"},Q={class:"modal-header"},X={class:"form-row"},Z={class:"form-group"},$={class:"form-group"},ee={key:0,class:"form-group"},te={class:"form-group"},se={class:"form-row"},oe={class:"form-group"},re={class:"form-group"},ae={class:"form-row"},le={class:"form-group"},ne={class:"form-group"},ie={class:"form-row"},me={class:"form-group"},de={class:"form-group"},ue={key:0,style:{color:"red"}},pe=["required","disabled"],fe=["value"],he={key:0,class:"warning-text"},ye={key:1,class:"info-text"},ge={key:1,class:"form-error"},ce={class:"modal-footer"},_e=["disabled"];function ve(s,e,m,d,r,a){return n(),l("div",R,[t("div",D,[e[19]||(e[19]=t("h1",null,"Employee Management",-1)),d.authStore.isAdmin?(n(),l("button",{key:0,onClick:e[0]||(e[0]=o=>r.showAddModal=!0),class:"btn-primary"},[...e[18]||(e[18]=[t("span",null,"➕",-1),c(" Add Employee ",-1)])])):u("",!0)]),d.authStore.isAuthenticated?!d.authStore.isAdmin&&!d.authStore.isManager?(n(),l("div",P," You don't have permission to access this page. ")):r.loading?(n(),l("div",U,[...e[20]||(e[20]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading employees...",-1)])])):r.error?(n(),l("div",V,[c(i(r.error)+" ",1),t("button",{onClick:e[1]||(e[1]=(...o)=>a.retryFetch&&a.retryFetch(...o)),class:"btn-primary",style:{"margin-top":"1rem"}},"Retry")])):(n(),l("div",q,[t("table",I,[e[21]||(e[21]=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"ID"),t("th",null,"Email"),t("th",null,"Position"),t("th",null,"Department"),t("th",null,"Salary"),t("th",null,"Hire Date"),t("th",null,"Manager"),t("th",null,"Type"),t("th",null,"Role"),t("th",null,"Actions")])],-1)),t("tbody",null,[(n(!0),l(w,null,A(r.employees,o=>{var h;return n(),l("tr",{key:o.id},[t("td",null,[t("div",B,[t("div",z,i(a.getInitials(a.getEmployeeName(o))),1),c(" "+i(a.getEmployeeName(o)),1)])]),t("td",null,i(o.employee_id||o.id),1),t("td",null,i(o.email||((h=o.user)==null?void 0:h.email)||"N/A"),1),t("td",null,i(o.position||"N/A"),1),t("td",null,i(o.department||"N/A"),1),t("td",null,"K"+i(a.formatNumber(o.base_salary)),1),t("td",null,i(a.formatDate(o.hire_date||o.created_at)),1),t("td",null,i(a.getManagerName(o.manager_id)),1),t("td",H,[t("span",L,i(a.formatEmploymentType(o.employment_type)),1)]),t("td",Y,[t("span",{class:F(["badge",a.getRoleBadgeClass(a.getEmployeeRole(o))])},i(a.formatRole(a.getEmployeeRole(o))),3)]),t("td",null,[t("div",K,[t("button",{onClick:y=>a.viewEmployee(o),class:"btn-view"},"View",8,O),d.authStore.isAdmin?(n(),l("button",{key:0,onClick:y=>a.editEmployee(o),class:"btn-edit"},"Edit",8,j)):u("",!0),d.authStore.isAdmin?(n(),l("button",{key:1,onClick:y=>a.deleteEmployee(o),class:"btn-delete"},"Delete",8,W)):u("",!0)])])])}),128))])]),r.employees.length===0?(n(),l("div",G,[e[22]||(e[22]=t("p",null,"No employees found",-1)),d.authStore.isAdmin?(n(),l("button",{key:0,onClick:e[2]||(e[2]=o=>r.showAddModal=!0),class:"btn-primary"}," Add First Employee ")):u("",!0)])):u("",!0)])):(n(),l("div",T," Please log in to access employee management. ")),(r.showAddModal||r.showEditModal)&&d.authStore.isAdmin?(n(),l("div",{key:5,class:"modal-overlay",onClick:e[17]||(e[17]=k((...o)=>a.closeModals&&a.closeModals(...o),["self"]))},[t("div",J,[t("div",Q,[t("h2",null,i(r.showEditModal?"Edit Employee":"Add New Employee"),1),t("button",{onClick:e[3]||(e[3]=(...o)=>a.closeModals&&a.closeModals(...o)),class:"close-btn"},"✕")]),t("form",{onSubmit:e[16]||(e[16]=k((...o)=>a.submitForm&&a.submitForm(...o),["prevent"])),class:"modal-body"},[t("div",X,[t("div",Z,[e[23]||(e[23]=t("label",null,"First Name *",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.first_name=o),type:"text",required:"",placeholder:"Enter first name"},null,512),[[f,r.form.first_name]])]),t("div",$,[e[24]||(e[24]=t("label",null,"Last Name *",-1)),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.last_name=o),type:"text",required:"",placeholder:"Enter last name"},null,512),[[f,r.form.last_name]])])]),r.showEditModal?u("",!0):(n(),l("div",ee,[e[25]||(e[25]=t("label",null,"Email *",-1)),p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.form.email=o),type:"email",required:"",placeholder:"employee@example.com"},null,512),[[f,r.form.email]])])),t("div",te,[e[27]||(e[27]=t("label",null,"Role *",-1)),p(t("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.form.role=o),required:"",onChange:e[8]||(e[8]=(...o)=>a.onRoleChange&&a.onRoleChange(...o))},[...e[26]||(e[26]=[t("option",{value:"employee"},"Employee",-1),t("option",{value:"manager"},"Manager",-1),t("option",{value:"admin"},"Admin",-1)])],544),[[_,r.form.role]])]),t("div",se,[t("div",oe,[e[28]||(e[28]=t("label",null,"Position *",-1)),p(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>r.form.position=o),type:"text",required:"",placeholder:"e.g., Software Developer"},null,512),[[f,r.form.position]])]),t("div",re,[e[30]||(e[30]=t("label",null,"Department *",-1)),p(t("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>r.form.department=o),required:""},[...e[29]||(e[29]=[C('<option value="" data-v-a9daf6c2>Select Department</option><option value="IT" data-v-a9daf6c2>IT</option><option value="HR" data-v-a9daf6c2>HR</option><option value="Finance" data-v-a9daf6c2>Finance</option><option value="Sales" data-v-a9daf6c2>Sales</option><option value="Marketing" data-v-a9daf6c2>Marketing</option><option value="Operations" data-v-a9daf6c2>Operations</option><option value="Administration" data-v-a9daf6c2>Administration</option><option value="Management" data-v-a9daf6c2>Management</option>',9)])],512),[[_,r.form.department]])])]),t("div",ae,[t("div",le,[e[31]||(e[31]=t("label",null,"Base Salary (K) *",-1)),p(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>r.form.base_salary=o),type:"number",step:"0.01",required:"",placeholder:"0.00"},null,512),[[f,r.form.base_salary,void 0,{number:!0}]])]),t("div",ne,[e[33]||(e[33]=t("label",null,"Employment Type *",-1)),p(t("select",{"onUpdate:modelValue":e[12]||(e[12]=o=>r.form.employment_type=o),required:""},[...e[32]||(e[32]=[t("option",{value:""},"Select Type",-1),t("option",{value:"full_time"},"Full Time",-1),t("option",{value:"part_time"},"Part Time",-1),t("option",{value:"contract"},"Contract",-1)])],512),[[_,r.form.employment_type]])])]),t("div",ie,[t("div",me,[e[34]||(e[34]=t("label",null,"Hire Date *",-1)),p(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>r.form.hire_date=o),type:"date",required:""},null,512),[[f,r.form.hire_date]])]),t("div",de,[t("label",null,[e[35]||(e[35]=c("Manager ",-1)),r.form.role==="employee"?(n(),l("span",ue,"*")):u("",!0)]),p(t("select",{"onUpdate:modelValue":e[14]||(e[14]=o=>r.form.manager_id=o),required:r.form.role==="employee",disabled:r.form.role==="manager"||r.form.role==="admin"},[e[36]||(e[36]=t("option",{value:""},"No Manager",-1)),(n(!0),l(w,null,A(r.managers,o=>(n(),l("option",{key:o.id,value:o.id},i(o.first_name)+" "+i(o.last_name)+" ("+i(o.department)+") ",9,fe))),128))],8,pe),[[_,r.form.manager_id]]),r.form.role==="employee"&&r.managers.length===0?(n(),l("small",he," No managers available. Please create a manager first. ")):u("",!0),r.form.role==="manager"||r.form.role==="admin"?(n(),l("small",ye,i(r.form.role==="admin"?"Admins":"Managers")+" don't have managers ",1)):u("",!0)])]),r.formError?(n(),l("div",ge,i(r.formError),1)):u("",!0),t("div",ce,[t("button",{type:"button",onClick:e[15]||(e[15]=(...o)=>a.closeModals&&a.closeModals(...o)),class:"btn-secondary"}," Cancel "),t("button",{type:"submit",class:"btn-primary",disabled:r.submitting},i(r.submitting?"Saving...":r.showEditModal?"Update":"Add Employee"),9,_e)])],32)])])):u("",!0)])}const Me=S(x,[["render",ve],["__scopeId","data-v-a9daf6c2"]]);export{Me as default};
