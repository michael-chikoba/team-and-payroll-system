import{_ as m,u as f}from"./index-C1X9tsoG.js";import{b as i,p as e,t as r,z as y,C as c,F as h,D as v,q as b,g,f as u}from"./vendor-Dn_KV7fh.js";const _={name:"Leaves",setup(){return{authStore:f()}},data(){return{pageName:"My Leaves",activeTab:"pending",pendingLeaves:[],leaveHistory:[],loading:!1,error:null,retryCount:0}},mounted(){this.fetchLeaves()},methods:{async fetchLeaves(n=!1){this.loading=!0,this.error=null;try{console.log("Fetching leaves... (retry:",n,")");const t=await g.get("/api/employee/leaves");console.log("Leaves API response:",t.data);const d=t.data.data||t.data||[];this.pendingLeaves=d.filter(o=>o.status==="pending"||o.status==="under_review"),this.leaveHistory=d.filter(o=>o.status!=="pending"&&o.status!=="under_review"),console.log("Pending leaves:",this.pendingLeaves),console.log("Leave history:",this.leaveHistory)}catch(t){console.error("Leaves fetch error:",t),this.handleApiError(t)}finally{this.loading=!1}},async cancelLeave(n){var t,d;if(confirm("Are you sure you want to cancel this leave request?"))try{const o=await g.post(`/api/employee/leaves/${n}/cancel`);await this.fetchLeaves(),this.$notify({type:"success",title:"Success",text:o.data.message||"Leave request cancelled successfully!"})}catch(o){console.error("Cancel leave error:",o),this.$notify({type:"error",title:"Cancel Failed",text:((d=(t=o.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to cancel leave request. Please try again."})}},viewDetails(n){this.$router.push({name:"leave-details",params:{id:n}})},retryFetch(){this.retryCount++,this.retryCount<=3?this.fetchLeaves(!0):this.error="Max retries exceeded. Please refresh the page."},handleApiError(n){var d,o,a,l,s;let t="An unexpected error occurred.";n.code==="ERR_NETWORK"||n.message.includes("Network Error")?t="Network error. Check your connection.":((d=n.response)==null?void 0:d.status)===401?(t="Session expired. Redirecting to login...",this.authStore.clearAuth(),this.$router.push({name:"login"})):((o=n.response)==null?void 0:o.status)===403?t="Access denied.":((a=n.response)==null?void 0:a.status)===404?t="Leave data not found. The endpoint may not be available.":t=((s=(l=n.response)==null?void 0:l.data)==null?void 0:s.message)||t,this.error=t},formatLeaveType(n){return{annual:"Annual",sick:"Sick",maternity:"Maternity",paternity:"Paternity",bereavement:"Bereavement",unpaid:"Unpaid",casual:"Casual",emergency:"Emergency"}[n]||n},formatStatus(n){return{pending:"Pending",approved:"Approved",rejected:"Rejected",cancelled:"Cancelled",under_review:"Under Review"}[n]||n},formatDateRange(n,t){return`${this.formatDate(n)} - ${this.formatDate(t)}`},formatDate(n){return n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}}},L={class:"leaves-view"},k={class:"header"},C={class:"title"},w={class:"tabs"},D={class:"content"},A={key:0,class:"section"},S={key:0,class:"empty-state"},T={key:1,class:"leaves-table"},N={class:"reason-cell"},R=["onClick"],x=["onClick"],F={key:1,class:"section"},q={key:0,class:"empty-state"},E={key:1,class:"leaves-table"},H={key:2,class:"loading"},P={key:3,class:"error-message"};function B(n,t,d,o,a,l){return u(),i("div",L,[e("header",k,[e("h1",C,r(a.pageName),1),t[5]||(t[5]=e("p",{class:"subtitle"},"Manage your leave requests and view approval history",-1)),e("button",{onClick:t[0]||(t[0]=s=>n.$router.push("/employee/apply-leave")),class:"apply-btn"},"+ Apply for Leave")]),e("div",w,[e("button",{onClick:t[1]||(t[1]=s=>a.activeTab="pending"),class:y(["tab-btn",{active:a.activeTab==="pending"}])}," Pending Requests ("+r(a.pendingLeaves.length)+") ",3),e("button",{onClick:t[2]||(t[2]=s=>a.activeTab="history"),class:y(["tab-btn",{active:a.activeTab==="history"}])}," Leave History ("+r(a.leaveHistory.length)+") ",3)]),e("div",D,[a.activeTab==="pending"?(u(),i("div",A,[a.pendingLeaves.length===0?(u(),i("div",S,[t[6]||(t[6]=e("p",null,"No pending leave requests.",-1)),e("button",{onClick:t[3]||(t[3]=s=>n.$router.push("/employee/apply-leave")),class:"btn-primary"},"Apply for Leave")])):(u(),i("table",T,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"Type"),e("th",null,"Dates"),e("th",null,"Duration"),e("th",null,"Reason"),e("th",null,"Status"),e("th",null,"Actions")])],-1)),e("tbody",null,[(u(!0),i(h,null,v(a.pendingLeaves,s=>(u(),i("tr",{key:s.id},[e("td",null,r(l.formatLeaveType(s.leave_type)),1),e("td",null,r(l.formatDateRange(s.start_date,s.end_date)),1),e("td",null,r(s.duration)+" days",1),e("td",N,r(s.reason?s.reason.substring(0,50):"")+r(s.reason&&s.reason.length>50?"...":""),1),e("td",null,[e("span",{class:y(["status",s.status.toLowerCase()])},r(l.formatStatus(s.status)),3)]),e("td",null,[s.status==="pending"?(u(),i("button",{key:0,onClick:p=>l.cancelLeave(s.id),class:"action-btn cancel"},"Cancel",8,R)):c("",!0),e("button",{onClick:p=>l.viewDetails(s.id),class:"action-btn view"},"View",8,x)])]))),128))])]))])):c("",!0),a.activeTab==="history"?(u(),i("div",F,[a.leaveHistory.length===0?(u(),i("div",q,[...t[8]||(t[8]=[e("p",null,"No leave history available.",-1)])])):(u(),i("table",E,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",null,"Type"),e("th",null,"Dates"),e("th",null,"Duration"),e("th",null,"Status"),e("th",null,"Approved By"),e("th",null,"Action Date")])],-1)),e("tbody",null,[(u(!0),i(h,null,v(a.leaveHistory,s=>{var p;return u(),i("tr",{key:s.id},[e("td",null,r(l.formatLeaveType(s.leave_type)),1),e("td",null,r(l.formatDateRange(s.start_date,s.end_date)),1),e("td",null,r(s.duration)+" days",1),e("td",null,[e("span",{class:y(["status",s.status.toLowerCase()])},r(l.formatStatus(s.status)),3)]),e("td",null,r(s.approved_by||((p=s.approver)==null?void 0:p.name)||"N/A"),1),e("td",null,r(l.formatDate(s.updated_at||s.action_date)),1)])}),128))])]))])):c("",!0),a.loading?(u(),i("div",H,[...t[10]||(t[10]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading leave records...",-1)])])):c("",!0),a.error?(u(),i("div",P,[b(r(a.error)+" ",1),e("button",{onClick:t[4]||(t[4]=(...s)=>l.retryFetch&&l.retryFetch(...s)),class:"btn-primary"},"Retry")])):c("",!0)])])}const U=m(_,[["render",B],["__scopeId","data-v-a8822dcd"]]);export{U as default};
