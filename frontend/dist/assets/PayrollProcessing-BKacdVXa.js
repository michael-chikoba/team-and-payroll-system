import{b as c,p as t,a as v,t as d,q as f,s as k,w as S,G as w,x as C,y as F,z as g,F as L,C as V,g as y,f as p,B as Q,E as U}from"./vendor-COruVTVJ.js";import{_ as B}from"./index-Djdf6BKf.js";const j={name:"PayrollProcessing",data(){return{pageName:"Payroll Processing Dashboard",employees:[],processing:!1,loading:!0,error:null,successMessage:null,searchQuery:"",filterStatus:"all",payrollPeriod:"",startDate:"",endDate:"",debugMode:!0,currentPayload:null}},computed:{pendingCount(){return this.employees.filter(s=>s.payroll_status==="pending").length},paidCount(){return this.employees.filter(s=>s.payroll_status==="paid").length},totalPayroll(){return this.employees.filter(s=>s.payroll_status==="pending").reduce((s,e)=>s+(e.salary||0),0)},filteredEmployees(){let s=this.employees;if(this.filterStatus!=="all"&&(s=s.filter(e=>e.payroll_status===this.filterStatus)),this.searchQuery){const e=this.searchQuery.toLowerCase();s=s.filter(l=>l.name.toLowerCase().includes(e)||l.position.toLowerCase().includes(e)||l.id.toString().includes(e)||l.email&&l.email.toLowerCase().includes(e))}return s},selectedCount(){return this.employees.filter(s=>s.selected).length},allSelected(){return this.filteredEmployees.length>0&&this.filteredEmployees.every(s=>s.selected)}},async mounted(){await this.initializePayrollPeriod(),await this.fetchEmployees()},methods:{getPayrollDates(){return{payroll_period:this.payrollPeriod,start_date:this.startDate,end_date:this.endDate}},preparePayrollPayload(s){return{employee_ids:s.map(o=>parseInt(o)).filter(o=>!isNaN(o)),...this.getPayrollDates()}},initializePayrollPeriod(){const s=new Date,e=s.getFullYear(),l=s.getMonth()+1,o=l.toString().padStart(2,"0");this.payrollPeriod=`${e}-${o}`,this.startDate=`${e}-${o}-01`;const r=new Date(e,l,0);this.endDate=`${e}-${o}-${r.getDate().toString().padStart(2,"0")}`},async fetchEmployees(){var s,e,l;this.loading=!0,this.error=null;try{const o={payroll_period:this.payrollPeriod,per_page:1e3},[r,n]=await Promise.all([y.get("/api/admin/employees"),y.get("/api/admin/payroll/history",{params:o})]),a={};(s=n.data)!=null&&s.data&&n.data.data.forEach(i=>{a[i.employee_id]={status:i.status,pay_period:i.pay_period,amount:i.amount}});let u=[];(e=r.data)!=null&&e.employees?u=r.data.employees:(l=r.data)!=null&&l.data?u=r.data.data:u=r.data||[],this.employees=u.map(i=>{var b,_,E;const m=a[i.id],D=i.first_name||((b=i.user)==null?void 0:b.first_name)||"",M=i.last_name||((_=i.user)==null?void 0:_.last_name)||"",N=[D,M].filter(Boolean).join(" ")||"Unknown Employee",A=i.position||i.department||"Unassigned",x=i.base_salary||i.salary||0,T=i.email||((E=i.user)==null?void 0:E.email)||null,I=m==null?void 0:m.status;return{id:i.id,name:N,email:T,position:A,salary:x,payroll_status:I,payPeriod:(m==null?void 0:m.pay_period)||this.payrollPeriod,employee_record:i,selected:!1}});const h=this.employees.filter(i=>!i.payroll_status);h.length>0&&console.log(`â„¹ï¸ ${h.length} employees without payroll status from backend`);const P=this.employees.filter(i=>i.payroll_status);console.log(`âœ… ${P.length} employees have payroll status:`,P.map(i=>({id:i.id,name:i.name,status:i.payroll_status})))}catch(o){console.error("âŒ Failed to load payroll data:",o),this.handleError(o)}finally{this.loading=!1}},async processPayroll(){const s=this.employees.filter(e=>e.payroll_status==="pending");if(s.length===0){this.showError("â„¹ï¸ No pending payroll to process.");return}if(confirm(`Process payroll for ${s.length} pending employee(s)?`)){this.processing=!0;try{const e=s.map(r=>r.id),l=this.preparePayrollPayload(e);this.currentPayload=l;const o=await y.post("/api/admin/payroll/process",l);this.employees.forEach(r=>{e.includes(r.id)&&(r.payroll_status="paid")}),this.showSuccess("âœ… Payroll processed successfully!")}catch(e){console.error("ðŸ’¥ Payroll processing error:",e),this.handlePayrollError(e)}finally{this.processing=!1}}},async bulkMarkPaid(){const e=this.employees.filter(l=>l.selected&&l.payroll_status).map(l=>l.id);if(e.length===0){this.showError("No employees with payroll status selected. Set status first before marking as paid.");return}if(confirm(`Mark ${e.length} employee(s) as paid?`))try{const l=this.preparePayrollPayload(e);this.currentPayload=l,await y.post("/api/admin/payroll/process",l),this.employees.forEach(o=>{o.selected&&o.payroll_status&&(o.payroll_status="paid",o.selected=!1)}),this.showSuccess(`âœ… ${e.length} employee(s) marked as paid.`)}catch(l){console.error("ðŸ’¥ Bulk mark paid error:",l),this.handlePayrollError(l)}},async bulkMarkPending(){const e=this.employees.filter(l=>l.selected&&l.payroll_status).map(l=>l.id);if(e.length===0){this.showError("No employees with payroll status selected. Set status first before marking as pending.");return}if(confirm(`Mark ${e.length} employee(s) as pending?`))try{const l={employee_ids:e,status:"pending",...this.getPayrollDates()};await y.post("/api/admin/payroll/update-status",l),this.employees.forEach(o=>{o.selected&&o.payroll_status&&(o.payroll_status="pending",o.selected=!1)}),this.showSuccess(`âœ… ${e.length} employee(s) marked as pending.`)}catch(l){console.error("ðŸ’¥ Bulk mark pending error:",l),this.handlePayrollError(l)}},async toggleStatus(s){const e=this.employees.find(r=>r.id===s);if(!e||!e.payroll_status){this.showError("Cannot toggle status for employee without payroll status");return}const l=e.payroll_status,o=l==="pending"?"paid":"pending";e.payroll_status=o;try{let r;o==="paid"?(r=this.preparePayrollPayload([s]),await y.post("/api/admin/payroll/process",r)):(r={employee_ids:[s],status:o,...this.getPayrollDates()},await y.post("/api/admin/payroll/update-status",r)),await this.fetchEmployees(),this.showSuccess(`âœ… Employee marked as ${o}.`)}catch(r){console.error("ðŸ’¥ Toggle status error:",r),this.handlePayrollError(r),e.payroll_status=l}},async setInitialStatus(s){const e=this.employees.find(o=>o.id===s);if(!e)return;const l=confirm(`Set initial status as Pending?

Click OK for Pending, Cancel for Paid`)?"pending":"paid";try{let o;l==="paid"?(o=this.preparePayrollPayload([s]),await y.post("/api/admin/payroll/process",o)):(o={employee_ids:[s],status:l,...this.getPayrollDates()},await y.post("/api/admin/payroll/update-status",o)),e.payroll_status=l,this.showSuccess(`âœ… Employee status set to ${l}.`)}catch(o){console.error("ðŸ’¥ Set initial status error:",o),this.handlePayrollError(o)}},handlePayrollError(s){var e,l;if(((e=s.response)==null?void 0:e.status)===422){const o=s.response.data;console.error("ðŸ” 422 Validation Error Details:",{status:s.response.status,data:o,requestData:(l=s.config)!=null&&l.data?JSON.parse(s.config.data):null});let r="Validation failed: ";if(o.errors){const n=o.errors,a=[];for(const[u,h]of Object.entries(n))a.push(`${u}: ${Array.isArray(h)?h.join(", "):h}`);r+=a.join("; ")}else o.message?r=o.message:r+="Please check the data and try again.";this.showError(r)}else this.handleError(s)},getInitials(s){return!s||s==="â€”"||s==="Unknown Employee"?"??":s.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)},getAvatarColor(s){const e=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #30cfd0 0%, #330867 100%)"],l=s.split("").reduce((o,r)=>o+r.charCodeAt(0),0)%e.length;return e[l]},addEmployee(){this.$router.push({name:"admin.employees.create"})},toggleSelectAll(){const s=!this.allSelected;this.filteredEmployees.forEach(e=>{e.selected=s})},clearSelection(){this.employees.forEach(s=>{s.selected=!1})},viewDetails(s){this.$router.push({name:"admin.employee.details",params:{id:s}})},async deleteEmployee(s){const e=this.employees.find(l=>l.id===s);if(confirm(`Delete ${(e==null?void 0:e.name)||"this employee"}? This cannot be undone.`))try{await y.delete(`/api/admin/employees/${s}`),this.employees=this.employees.filter(l=>l.id!==s),this.showSuccess("âœ… Employee removed successfully.")}catch(l){this.handleError(l)}},clearSearch(){this.searchQuery=""},dismissError(){this.error=null},showSuccess(s){this.successMessage=s,setTimeout(()=>{this.successMessage=null},5e3)},showError(s){this.error=s,setTimeout(()=>{this.error=null},5e3)},formatCurrency(s){return new Intl.NumberFormat("en-ZM",{style:"currency",currency:"ZMW",minimumFractionDigits:2}).format(s)},formatDate(s){if(!s)return"â€”";if(s.match(/^\d{4}-\d{2}$/)){const[l,o]=s.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o)-1]} ${l}`}const e=new Date(s);return isNaN(e.getTime())?"â€”":e.toLocaleDateString("en-ZM",{year:"numeric",month:"short",day:"numeric"})},handleError(s){var l,o,r,n,a,u,h;let e="An unexpected error occurred.";if(((l=s.response)==null?void 0:l.status)===401){e="Your session has expired. Please log in again.",(r=(o=this.$store)==null?void 0:o.auth)!=null&&r.clearAuth&&this.$store.auth.clearAuth(),this.$router.push({name:"login"});return}else if(((n=s.response)==null?void 0:n.status)===403)e="You do not have permission to perform this action.";else{if(((a=s.response)==null?void 0:a.status)===422)return;(h=(u=s.response)==null?void 0:u.data)!=null&&h.message?e=s.response.data.message:s.message?e=s.message:s.code==="ERR_NETWORK"&&(e="Network error. Please check your connection.")}this.error=e,console.error("API Error:",s)}}},R={class:"payroll-view"},z={class:"header"},O={class:"title"},J={class:"header-actions"},W=["disabled"],Y={key:0,class:"spinner-small"},q={key:0,class:"error-banner"},Z={key:0,class:"success-banner"},K={class:"summary-cards"},G={class:"card"},H={class:"value"},X={class:"card"},$={class:"value pending"},ee={class:"card"},se={class:"value"},te={class:"card"},le={class:"value success"},ae={class:"filters-section"},re={class:"search-box"},oe={class:"filter-buttons"},ne={class:"content"},ie={key:0,class:"loading-state"},de={key:1,class:"empty-state"},ue={key:2,class:"empty-state"},ce={key:3,class:"table-container"},pe={class:"payroll-table"},ye=["checked"],he=["onUpdate:modelValue"],me={class:"employee-name"},ge={class:"employee-info"},fe={class:"name"},ke={class:"email"},Pe={class:"position-badge"},be={class:"salary"},_e={key:1,class:"status unknown"},Ee={class:"action-buttons"},ve=["onClick"],Se=["onClick","title"],we=["onClick"],Ce=["onClick"],De={key:0,class:"bulk-actions"},Me={class:"selected-count"};function Ne(s,e,l,o,r,n){return p(),c("div",R,[t("header",z,[t("h1",O,d(r.pageName),1),t("div",J,[t("button",{onClick:e[0]||(e[0]=(...a)=>n.addEmployee&&n.addEmployee(...a)),class:"add-btn"},[...e[14]||(e[14]=[t("span",{class:"btn-icon"},"+",-1),f(" Add Employee ",-1)])]),t("button",{onClick:e[1]||(e[1]=(...a)=>n.processPayroll&&n.processPayroll(...a)),class:"process-btn",disabled:r.processing||n.pendingCount===0},[r.processing?(p(),c("span",Y)):k("",!0),f(" "+d(r.processing?"Processing...":"Process Payroll"),1)],8,W)])]),v(w,{name:"fade"},{default:S(()=>[r.error?(p(),c("div",q,[t("span",null,d(r.error),1),t("button",{onClick:e[2]||(e[2]=(...a)=>n.dismissError&&n.dismissError(...a)),class:"dismiss-btn"},"Ã—")])):k("",!0)]),_:1}),v(w,{name:"fade"},{default:S(()=>[r.successMessage?(p(),c("div",Z,[t("span",null,d(r.successMessage),1),t("button",{onClick:e[3]||(e[3]=a=>r.successMessage=null),class:"dismiss-btn"},"Ã—")])):k("",!0)]),_:1}),t("div",K,[t("div",G,[e[15]||(e[15]=t("div",{class:"card-icon employees"},"ðŸ‘¥",-1)),e[16]||(e[16]=t("h3",null,"Total Employees",-1)),t("p",H,d(r.employees.length),1)]),t("div",X,[e[17]||(e[17]=t("div",{class:"card-icon pending"},"â³",-1)),e[18]||(e[18]=t("h3",null,"Pending Payroll",-1)),t("p",$,d(n.pendingCount),1)]),t("div",ee,[e[19]||(e[19]=t("div",{class:"card-icon amount"},"ðŸ’°",-1)),e[20]||(e[20]=t("h3",null,"Total Payroll Amount",-1)),t("p",se,d(n.formatCurrency(n.totalPayroll)),1)]),t("div",te,[e[21]||(e[21]=t("div",{class:"card-icon paid"},"âœ“",-1)),e[22]||(e[22]=t("h3",null,"Paid This Period",-1)),t("p",le,d(n.paidCount),1)])]),t("div",ae,[t("div",re,[C(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.searchQuery=a),type:"text",placeholder:"Search by name, position, or ID...",class:"search-input"},null,512),[[F,r.searchQuery]])]),t("div",oe,[t("button",{onClick:e[5]||(e[5]=a=>r.filterStatus="all"),class:g(["filter-btn",{active:r.filterStatus==="all"}])}," All ("+d(r.employees.length)+") ",3),t("button",{onClick:e[6]||(e[6]=a=>r.filterStatus="pending"),class:g(["filter-btn",{active:r.filterStatus==="pending"}])}," Pending ("+d(n.pendingCount)+") ",3),t("button",{onClick:e[7]||(e[7]=a=>r.filterStatus="paid"),class:g(["filter-btn",{active:r.filterStatus==="paid"}])}," Paid ("+d(n.paidCount)+") ",3)])]),t("div",ne,[r.loading?(p(),c("div",ie,[...e[23]||(e[23]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading payroll data...",-1)])])):n.filteredEmployees.length===0&&!r.searchQuery?(p(),c("div",de,[e[24]||(e[24]=t("div",{class:"empty-icon"},"ðŸ“‹",-1)),e[25]||(e[25]=t("h2",null,"No Employees Found",-1)),e[26]||(e[26]=t("p",null,"Add employees to start processing payroll.",-1)),t("button",{onClick:e[8]||(e[8]=(...a)=>n.addEmployee&&n.addEmployee(...a)),class:"btn-primary"},"Add Your First Employee")])):n.filteredEmployees.length===0&&r.searchQuery?(p(),c("div",ue,[e[27]||(e[27]=t("div",{class:"empty-icon"},"ðŸ”",-1)),e[28]||(e[28]=t("h2",null,"No Results Found",-1)),e[29]||(e[29]=t("p",null,"Try adjusting your search criteria.",-1)),t("button",{onClick:e[9]||(e[9]=(...a)=>n.clearSearch&&n.clearSearch(...a)),class:"btn-secondary"},"Clear Search")])):(p(),c("div",ce,[t("table",pe,[t("thead",null,[t("tr",null,[t("th",null,[t("input",{type:"checkbox",onChange:e[10]||(e[10]=(...a)=>n.toggleSelectAll&&n.toggleSelectAll(...a)),checked:n.allSelected,class:"checkbox"},null,40,ye)]),e[30]||(e[30]=t("th",null,"ID",-1)),e[31]||(e[31]=t("th",null,"Employee",-1)),e[32]||(e[32]=t("th",null,"Position",-1)),e[33]||(e[33]=t("th",null,"Salary",-1)),e[34]||(e[34]=t("th",null,"Status",-1)),e[35]||(e[35]=t("th",null,"Pay Period",-1)),e[36]||(e[36]=t("th",null,"Actions",-1))])]),t("tbody",null,[(p(!0),c(L,null,V(n.filteredEmployees,a=>(p(),c("tr",{key:a.id,class:g({selected:a.selected})},[t("td",null,[C(t("input",{type:"checkbox","onUpdate:modelValue":u=>a.selected=u,class:"checkbox"},null,8,he),[[Q,a.selected]])]),t("td",null,[t("strong",null,"#"+d(a.id),1)]),t("td",null,[t("div",me,[t("div",{class:"employee-avatar",style:U({background:n.getAvatarColor(a.name)})},d(n.getInitials(a.name)),5),t("div",ge,[t("div",fe,d(a.name),1),t("div",ke,d(a.email||"â€”"),1)])])]),t("td",null,[t("span",Pe,d(a.position),1)]),t("td",be,d(n.formatCurrency(a.salary)),1),t("td",null,[a.payroll_status?(p(),c("span",{key:0,class:g(["status",a.payroll_status.toLowerCase()])},[e[37]||(e[37]=t("span",{class:"status-dot"},null,-1)),f(" "+d(a.payroll_status.charAt(0).toUpperCase()+a.payroll_status.slice(1)),1)],2)):(p(),c("span",_e,[...e[38]||(e[38]=[t("span",{class:"status-dot"},null,-1),f(" Not Set ",-1)])]))]),t("td",null,d(n.formatDate(a.payPeriod)),1),t("td",null,[t("div",Ee,[t("button",{onClick:u=>n.viewDetails(a.id),class:"action-btn view",title:"View Details"}," ðŸ‘ï¸ ",8,ve),a.payroll_status?(p(),c("button",{key:0,onClick:u=>n.toggleStatus(a.id),class:g(["action-btn",a.payroll_status.toLowerCase()]),title:a.payroll_status==="pending"?"Mark as Paid":"Mark as Pending"},d(a.payroll_status==="pending"?"âœ“":"â†»"),11,Se)):(p(),c("button",{key:1,onClick:u=>n.setInitialStatus(a.id),class:"action-btn unknown",title:"Set Status"}," âš™ï¸ ",8,we)),t("button",{onClick:u=>n.deleteEmployee(a.id),class:"action-btn delete",title:"Delete Employee"}," ðŸ—‘ï¸ ",8,Ce)])])],2))),128))])]),n.selectedCount>0?(p(),c("div",De,[t("span",Me,d(n.selectedCount)+" employee(s) selected",1),t("button",{onClick:e[11]||(e[11]=(...a)=>n.bulkMarkPaid&&n.bulkMarkPaid(...a)),class:"bulk-btn paid"},"Mark Selected as Paid"),t("button",{onClick:e[12]||(e[12]=(...a)=>n.bulkMarkPending&&n.bulkMarkPending(...a)),class:"bulk-btn pending"},"Mark Selected as Pending"),t("button",{onClick:e[13]||(e[13]=(...a)=>n.clearSelection&&n.clearSelection(...a)),class:"bulk-btn clear"},"Clear Selection")])):k("",!0)]))])])}const Te=B(j,[["render",Ne],["__scopeId","data-v-56f009e1"]]);export{Te as default};
